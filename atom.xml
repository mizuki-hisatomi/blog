<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Japan Exchange &amp; Outlook Support Blog</title>
  
  <subtitle>日本マイクロソフト Exchange &amp; Outlook サポート チームのブログです</subtitle>
  <link href="/blog/atom.xml" rel="self"/>
  
  <link href="https://jpmessaging.github.io/blog/"/>
  <updated>2020-06-03T03:06:34.759Z</updated>
  <id>https://jpmessaging.github.io/blog/</id>
  
  <author>
    <name>jpmessaging</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Exchange 2013 のメールボックス サーバー上で自己署名証明書の有効期限が切れた際の注意点
</title>
    <link href="https://jpmessaging.github.io/blog/Exchange%202013%20%E3%81%AE%E3%83%A1%E3%83%BC%E3%83%AB%E3%83%9C%E3%83%83%E3%82%AF%E3%82%B9%20%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E4%B8%8A%E3%81%A7%E8%87%AA%E5%B7%B1%E7%BD%B2%E5%90%8D%E8%A8%BC%E6%98%8E%E6%9B%B8%E3%81%AE%E6%9C%89%E5%8A%B9%E6%9C%9F%E9%99%90%E3%81%8C%E5%88%87%E3%82%8C%E3%81%9F%E9%9A%9B%E3%81%AE%E6%B3%A8%E6%84%8F%E7%82%B9/"/>
    <id>https://jpmessaging.github.io/blog/Exchange%202013%20%E3%81%AE%E3%83%A1%E3%83%BC%E3%83%AB%E3%83%9C%E3%83%83%E3%82%AF%E3%82%B9%20%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E4%B8%8A%E3%81%A7%E8%87%AA%E5%B7%B1%E7%BD%B2%E5%90%8D%E8%A8%BC%E6%98%8E%E6%9B%B8%E3%81%AE%E6%9C%89%E5%8A%B9%E6%9C%9F%E9%99%90%E3%81%8C%E5%88%87%E3%82%8C%E3%81%9F%E9%9A%9B%E3%81%AE%E6%B3%A8%E6%84%8F%E7%82%B9/</id>
    <published>2018-10-16T15:00:00.000Z</published>
    <updated>2020-06-03T03:06:34.759Z</updated>
    
    <content type="html"><![CDATA[<p>今回は Exchange 2013 のメールボックス サーバー (クライアント アクセスとメールボックスが共存するサーバーも含む) 上で自己署名証明書の有効期限が切れた際に発生してしまう問題についてご紹介いたします。<br>この問題は最近見つかった不具合となりますが、Exchange 2013 は既に延長サポート フェーズの製品であるため、残念ながら本問題に対する修正は見送られております。<br>なお、Exchange 2016 では内部動作が一部変更されていることから本問題は発生いたしません。</p><h2 id="現象"><a href="#現象" class="headerlink" title="現象"></a>現象</h2><p>メールボックスの役割がインストールされた Exchange 2013上で実施されている 2 つのプローブ (OutlookRpcSelfTestProve と OutlookRpcDeepTestProbe) が自己署名証明書の有効期限が切れた後からエラーで失敗するようになります。 具体的にはメールボックスの役割がインストールされた Exchange 2013 上で IIS の Web サイト (Exchange Back End) にバインドされている自己署名証明書の有効期限が切れた以降から 2 つのプローブが失敗するようになり、その結果として可能性管理の機能により該当サーバー上で以下の事象が発生してしまいます。</p><ul><li>アプリケーション プール MSExchangeRpcProxyAppPool のリサイクル</li><li>Microsoft Exchange RPC Client Access サービスの再起動</li></ul><p>なお、Exchange 2013 CU2-v2 など初期のバージョンでは上記以外にデータベースのフェールオーバーが実施される場合もございます。<br>ただし、Exchange 2013 CU3 以降では OutlookRpcSelfTestProve や OutlookRpcDeepTestProbe のプローブが失敗してもデータベースのフェールオーバーは実施されなくなっています。</p><p>- 補足<br>本不具合が発生している場合、ProbeResult に関するイベント ログにはそれぞれ以下の例外内容でエラーが記録されます。</p><p><img src="OutlookRpcSelfTestProbe.png" alt="OutlookRpcSelfTestProve のエラー"></p><p>[詳細] タブの ExecutionContext 項目には以下の例外が記録</p><blockquote><p>Exception = System.Net.WebException: 基礎になる接続が閉じられました: SSL/TLS のセキュリティで保護されているチャネルに対する信頼関係を確立できませんでした —&amp;gt; System.Security.Authentication.AuthenticationException: 検証プロシージャによると、リモート証明書は無効です。</p></blockquote><p><img src="OutlookRpcDeepTestProbe.png" alt=" OutlookRpcDeepTestProbe のエラー"></p><p>[詳細] タブの ExecutionContext 項目には以下の例外が記録</p><blockquote><p>Exception = Microsoft.Exchange.Rpc.ServerUnavailableException: Error 0x6ba (RPC サーバーを利用できません。) from ClientAsyncCallState.CheckCompletion: RpcAsyncCompleteCall</p></blockquote><h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><p>Exchange 2013 のメールボックス サーバーにインストールされる自己署名証明書は組織内の Exchange Server から自動的に信頼されるように設計されています。 ただし、Exchange 2013 のメールボックス サーバー上で実施される 2 つのプローブ (OutlookRpcSelfTestProbe および OutlookRpcDeepTestProbe) に関しては自己署名証明書を自動的に信頼できない不具合があり、この不具合により自己署名証明書の有効期限が切れたタイミングで該当のプローブが失敗するようになります。</p><p>なお、Exchange 2013 のインストール時に作成される自己署名証明書は [コンピュータ アカウント] の [信頼されたルート証明機関] に登録されていますが、自己署名証明書を更新しただけでは [コンピュータ アカウント] の [信頼されたルート証明機関] には自動的には登録されません。</p><p>そのため、Exchange 2013 のメールボックス サーバー上で自己署名証明書を更新して IIS の Web サイト (Exchange Back End) にバインドする作業を実施しても、[コンピュータ アカウント] の [信頼されたルート証明機関] に登録していない場合にも該当のプローブが失敗する現象が発生いたします。</p><h2 id="対処方法"><a href="#対処方法" class="headerlink" title="対処方法"></a>対処方法</h2><p>証明書の更新作業は一般的にはクライアントからの要求を受け付けるクライアント アクセス サーバーでのみ必要となります。 ただし、本不具合を回避するためにも、Exchange 2013 をご利用のお客様は後述の手順を参考にメールボックス サーバー上の自己署名証明書を更新してくださいますようお願いいたします。 なお、クライアント アクセスの役割とメールボックスの役割を共存させているサーバー上でも本作業を明示的に実施いただく必要がございますのでご注意ください。</p><p>-作業概要</p><ol><li>IIS の Web サイト (Exchange Back End) にバインドされている自己署名証明書の確認</li><li>自己署名証明書を新規に発行</li><li>新規に発行した自己署名証明書を [コンピュータ アカウント] の [信頼されたルート証明機関] に登録</li><li>新規に発行した自己署名証明書を IIS の Web サイト (Exchange Back End) にバインド</li><li>(必要に応じて) 他のサービスに割り当てている自己署名証明書を変更</li></ol><h3 id="1-IIS-の-Web-サイト-Exchange-Back-End-にバインドされている自己署名証明書の確認"><a href="#1-IIS-の-Web-サイト-Exchange-Back-End-にバインドされている自己署名証明書の確認" class="headerlink" title="1. IIS の Web サイト (Exchange Back End) にバインドされている自己署名証明書の確認"></a>1. IIS の Web サイト (Exchange Back End) にバインドされている自己署名証明書の確認</h3><p>以下の手順は更新対象のメールボックス サーバー上で実施してください。</p><ol><li>インターネット インフォメーション サービス (IIS) マネージャーを起動します。</li><li>[&lt;サーバー名&gt;] - [サイト] - [Exchange Back End] を右クリックして [バインドの編集] をクリックします。</li><li>“種類” が https で “ポート” が 444 のエントリを選択した状態で [編集] をクリックします。</li><li>[SSL 証明書] に設定されている証明書を確認します。(必要に応じて [表示] をクリックして証明書の詳細についても確認してください)</li></ol><h3 id="2-自己署名証明書を新規に発行"><a href="#2-自己署名証明書を新規に発行" class="headerlink" title="2. 自己署名証明書を新規に発行"></a>2. 自己署名証明書を新規に発行</h3><p>Exchange 管理シェルから以下のコマンドを実行して自己署名証明書を新規に発行します。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-ExchangeCertificate</span> <span class="literal">-Server</span> <span class="string">"&lt;MBX サーバー名&gt;"</span> <span class="literal">-Thumbprint</span> <span class="string">"&lt;更新対象の自己署名証明書の拇印&gt;"</span> | <span class="built_in">New-ExchangeCertificate</span> <span class="literal">-Service</span> None</span><br></pre></td></tr></table></figure><p>なお、更新対象の自己署名証明書の拇印 (Thumbprint) に関しては以下のコマンドを実行することでも確認することができます。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-ExchangeCertificate</span> <span class="literal">-Server</span> <span class="string">"&lt;MBX サーバー名&gt;"</span> | fl</span><br></pre></td></tr></table></figure><h3 id="3-新規に発行した自己署名証明書を-コンピュータ-アカウント-の-信頼されたルート証明機関-に登録"><a href="#3-新規に発行した自己署名証明書を-コンピュータ-アカウント-の-信頼されたルート証明機関-に登録" class="headerlink" title="3. 新規に発行した自己署名証明書を [コンピュータ アカウント] の [信頼されたルート証明機関] に登録"></a>3. 新規に発行した自己署名証明書を [コンピュータ アカウント] の [信頼されたルート証明機関] に登録</h3><p>以下の手順は更新対象のメールボックス サーバー上で実施してください。</p><ol><li>Microsoft 管理コンソールを起動します。([ファイル名を指定して実行] で “mmc” と入力して [OK] をクリックしてください)</li><li>[ファイル] メニューから [スナップインの追加と削除] を選択します。</li><li>[証明書] (コンピュータ アカウント) を追加して [OK] をクリックします。</li><li>左ペインから [証明書] - [個人] - [証明書] を選択します。</li><li>新規に発行した自己署名証明書を右クリックして [コピー] を選択します。</li><li>左ペインから [証明書] - [信頼されたルート証明機関] - [証明書] を選択します。</li><li>中央ペインの空白部分を右クリックして [貼り付け] を選択して該当の自己署名証明書をコピーします。</li></ol><p>[コンピュータ アカウント] の [信頼されたルート証明機関] に登録後は Get-ExchangeCertificate で該当の自己署名証明書を確認すると RootCAType パラメータは “Registry” と表示されます。</p><h3 id="4-新規に発行した自己署名証明書を-IIS-の-Web-サイト-Exchange-Back-End-にバインド"><a href="#4-新規に発行した自己署名証明書を-IIS-の-Web-サイト-Exchange-Back-End-にバインド" class="headerlink" title="4. 新規に発行した自己署名証明書を IIS の Web サイト (Exchange Back End) にバインド"></a>4. 新規に発行した自己署名証明書を IIS の Web サイト (Exchange Back End) にバインド</h3><p>以下の手順は更新対象のメールボックス サーバー上で実施してください。</p><ol><li>インターネット インフォメーション サービス (IIS) マネージャーを起動します。</li><li>[&lt;サーバー名&gt;] - [サイト] - [Exchange Back End] を右クリックして [バインドの編集] をクリックします。</li><li>“種類” が https で “ポート” が 444 のエントリを選択した状態で [編集] をクリックします。</li><li>[SSL 証明書] に新規に発行した自己署名証明書を設定して [OK] をクリックします。</li></ol><h3 id="5-必要に応じて-他のサービスに割り当てている自己署名証明書を変更"><a href="#5-必要に応じて-他のサービスに割り当てている自己署名証明書を変更" class="headerlink" title="5. (必要に応じて) 他のサービスに割り当てている自己署名証明書を変更"></a>5. (必要に応じて) 他のサービスに割り当てている自己署名証明書を変更</h3><p>メールボックスの役割のみをインストールしているサーバーなどでは以下の箇所も自己署名証明書のまま利用されている場合もあるかと存じます。</p><ul><li>IIS の Web サイト (Default Web Site) にバインドしている証明書</li><li>Transport サービスの内部トランスポート証明書</li></ul><p>上記に割り当てている自己署名証明書の有効期限が切れても特に問題はございませんが、これらの証明書も新規に発行した自己署名証明書に変更したい場合は Exchange 管理シェルから以下のコマンドを実行してください。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Enable-ExchangeCertificate</span> <span class="string">"&lt;MBX サーバー名&gt;"</span> <span class="literal">-Thumbprint</span> <span class="string">"&lt;新規に発行した自己署名証明書の拇印&gt;"</span> <span class="literal">-Service</span> IIS,SMTP</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;今回は Exchange 2013 のメールボックス サーバー (クライアント アクセスとメールボックスが共存するサーバーも含む) 上で自己署名証明書の有効期限が切れた際に発生してしまう問題についてご紹介いたします。&lt;br&gt;この問題は最近見つかった不具合となりますが、Exc
      
    
    </summary>
    
    
    
      <category term="Exchange" scheme="https://jpmessaging.github.io/blog/tags/Exchange/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD と Exchange Online 間の同期に関するエラーの事例集
</title>
    <link href="https://jpmessaging.github.io/blog/Azure%20AD%20%E3%81%A8%20Exchange%20Online%20%E9%96%93%E3%81%AE%E5%90%8C%E6%9C%9F%E3%81%AB%E9%96%A2%E3%81%99%E3%82%8B%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%AE%E4%BA%8B%E4%BE%8B%E9%9B%86/"/>
    <id>https://jpmessaging.github.io/blog/Azure%20AD%20%E3%81%A8%20Exchange%20Online%20%E9%96%93%E3%81%AE%E5%90%8C%E6%9C%9F%E3%81%AB%E9%96%A2%E3%81%99%E3%82%8B%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%AE%E4%BA%8B%E4%BE%8B%E9%9B%86/</id>
    <published>2018-08-09T15:00:00.000Z</published>
    <updated>2020-06-03T03:06:34.759Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Exchange サポートの渡辺です。</p><p><a href="/blog/Azure%20AD%20と%20Exchange%20Online%20の同期とトラブルシューティングの基本">先日公開したブログ</a>で、Azure AD と Exchange Online 間の同期の問題に関するトラブルシューティングの基本をご紹介させていただきました。<br>ただ、あまり事例の紹介ができていないので、今回はトラブルシューティングによって確認できたエラー内容毎に、いくつか詳細と対処方法をご紹介できればと思っています。</p><h2 id="事例を紹介するその前に、Exchange-Online-のメールボックスのおさらい"><a href="#事例を紹介するその前に、Exchange-Online-のメールボックスのおさらい" class="headerlink" title="事例を紹介するその前に、Exchange Online のメールボックスのおさらい"></a>事例を紹介するその前に、Exchange Online のメールボックスのおさらい</h2><p>先日のブログではオンプレミスのリモート メールボックスや Exchange Online のメールボックス等について説明しました。<br>今回の事例を紹介するにあたっては、他の種類のメールボックスもいくつか登場してくるので、改めて登場人物の整理からしていきます。</p><h3 id="アーカイブ-メールボックス-インプレース-アーカイブ"><a href="#アーカイブ-メールボックス-インプレース-アーカイブ" class="headerlink" title="アーカイブ メールボックス (インプレース アーカイブ)"></a>アーカイブ メールボックス (インプレース アーカイブ)</h3><p>※ここではいわゆる普通のメールボックスをプライマリ メールボックスと呼ぶことにします。</p><p>アーカイブ メールボックスはプライマリ メールボックスとは別にユーザーが利用できる追加のメールボックスです。<br>アーカイブ メールボックスが何なのか自体はここではあまり関係無いので詳細は割愛します。詳しくは以下の公開情報をご確認ください。</p><p>  Title : Exchange Online のアーカイブ メールボックス<br>  URL : <a href="https://technet.microsoft.com/ja-jp/library/dn922147(v=exchg.150).aspx" target="_blank" rel="noopener">https://technet.microsoft.com/ja-jp/library/dn922147(v=exchg.150).aspx</a></p><p>今回の話をするにあたって、アーカイブ メールボックスについて知っておいていただきたいのは、以下の 2 点です。</p><ul><li>オンプレミス側でアーカイブ メールボックスの有効/無効を管理する (※1)</li><li>あくまで、プライマリ メールボックスに紐付いた追加のメールボックスであること</li></ul><p>まず 1点目についてはそのままなのですが、Exchange Online でアーカイブ メールボックスを有効化したいときは、オンプレミスのリモート メールボックスに対して Enable-RemoteMailbox コマンドの Archive スイッチを使って有効化します。(逆に無効にするなら Disable-RemoteMailbox -Archive です)</p><p>※1 : 厳密にはハイブリッド環境であっても、オンプレミス側でメールユーザーとして作成して Exchange Online にメールボックスを作成している場合等、Exchange Online 側から Enable-Mailbox コマンドでアーカイブ メールボックスを有効化できる場合もあるのですが、ここではオンプレミス側がリモートメールボックスである前提とします。</p><p>2 点目については下の絵を見ていただいた方がもしかしたらわかりやすいのかもしれませんが、アーカイブ メールボックスも単に 1 人のユーザーに紐付いたメールボックスの 1 つであり、アーカイブ メールボックス用のユーザー (オブジェクト) ができるわけではありません。<br>Get-Mailbox や Get-RemoteMailbox で 1 人の情報を取得すれば、そこにはプライマリ メールボックスの情報 (ExchangeGuid) もアーカイブ メールボックスの情報 (ArchiveGuid) も含まれています</p><p><img src="081001.jpg" alt=""></p><h3 id="非アクティブ-メールボックスと-Soft-Deleted-Mailbox"><a href="#非アクティブ-メールボックスと-Soft-Deleted-Mailbox" class="headerlink" title="非アクティブ メールボックスと Soft-Deleted Mailbox"></a>非アクティブ メールボックスと Soft-Deleted Mailbox</h3><p>続いて、非アクティブ メールボックスと Soft-Deleted Mailbox (正しい日本語訳が見つからなかったのですが、オンプレミスで言うところの “切断されたメールボックス” や “削除済みメールボックス” などと呼ばれていたものと似たようなものです) についてです。<br>どちらも基本的には既に Azure AD 上のユーザーからは切り離されている (紐付いていない) 状態になっているメールボックスを指しており、違いと言えば 30 日で完全に削除されるか、それ以降も保持され続けるかの違いです。このあたりの違いについては以下の公開情報をご確認ください。</p><p>  Title : Office 365 の非アクティブなメールボックスの概要<br>  URL : <a href="https://support.office.com/ja-jp/article/overview-of-inactive-mailboxes-in-office-365-1fbd74e8-7a60-4157-afe8-fe79f05d2038" target="_blank" rel="noopener">https://support.office.com/ja-jp/article/overview-of-inactive-mailboxes-in-office-365-1fbd74e8-7a60-4157-afe8-fe79f05d2038</a></p><p>この 2 つのメールボックスについても今回に限って知っておいてもらいたいのは以下の 2 点だけです。</p><ul><li>Exchange Online にユーザー (オブジェクト) が残っている</li><li>Azure AD 上のユーザーは既に削除されている (Azure AD 上のユーザーが同名で存在していても別のオブジェクトになっている)</li></ul><p>よくあるシナリオとしては、対象のオンプレミスのユーザーを削除したり (あるいは AAD Connect の非同期の対象にする)、Azure AD 上のユーザーを直接削除すると作られます。<br>以下はオンプレミスのユーザーを AAD Connect の同期対象外として Azure AD のユーザーを削除 (削除済みユーザーとなる) したときと、完全削除 (削除済みユーザーからも削除) したときのイメージです。<br>削除済みユーザーの時点では Soft-Deleted Mailbox の ExternalDirectoryObject に Azure AD のユーザーの ObjectId が設定されていますが、Azure AD のユーザーが削除されると Soft-Deleted Mailbox からも削除されていることが確認できますね。</p><p>※ Azure AD 上のユーザーが削除済みユーザーとして残っている場合、Exchange Online 上では Soft-Deleted Mailbox になっていますが、実はまだメールボックスと紐付いた状態になっています。<br>なので、削除済みユーザーを復元すれば (ディレクトリ同期の対象に戻せば)、ユーザーに紐付いているメールボックスに再接続して引き続き利用可能になります。</p><p><img src="081002.jpg" alt=""></p><h2 id="Azure-AD-Exchange-Online-間の同期の問題でよくある事例"><a href="#Azure-AD-Exchange-Online-間の同期の問題でよくある事例" class="headerlink" title="Azure AD - Exchange Online 間の同期の問題でよくある事例"></a>Azure AD - Exchange Online 間の同期の問題でよくある事例</h2><p>それでは、Azure AD と Exchange Online 間の同期で発生する問題について、いくつかのパターンを紹介していこうと思います。</p><p>大抵の場合、目に見える事象としては、メールボックスが作成されない、設定変更したのに反映されない、メールボックスが削除されないのいずれかになりますが、その原因は様々です。<br>ここでは、<a href="/blog/Azure%20AD%20と%20Exchange%20Online%20の同期とトラブルシューティングの基本">先日のブログ</a>で紹介した Get-MsolUser コマンドを使って確認できるエラー毎にまとめていきます。</p><h3 id="1-訴訟ホールド、インプレース保持、保持ポリシー-SCC-が有効な場合のエラー"><a href="#1-訴訟ホールド、インプレース保持、保持ポリシー-SCC-が有効な場合のエラー" class="headerlink" title="1. 訴訟ホールド、インプレース保持、保持ポリシー(SCC) が有効な場合のエラー"></a>1. 訴訟ホールド、インプレース保持、保持ポリシー(SCC) が有効な場合のエラー</h3><p>まずはエラーの内容から確認しましょう。<br>といっても、Get-MsolUser コマンドでのトラブルシューティング方法を紹介したときに使用したものと同じで、ここで取り上げるのは以下のエラーです。</p><blockquote><p>ErrorDescription : Exchange can’t disable the mailbox “JPNPR01A004.PROD.OUTLOOK.COM/Microsoft Exchange Hosted Organizations/yowatana002.onmicrosoft.com/testuserA” because it is on In-Place Hold.</p></blockquote><p>基本的にはユーザーを削除した場合に非アクティブ メールボックスになるようなシナリオにおいて、ユーザーは削除せずにライセンスだけを剥奪したりすると発生します。<br>非アクティブ メールボックスになるシナリオはいくつかあるのですが、以下の 4 つのいずれかによる保持を有効にした状態でユーザーを削除すると作られます。<br>いずれもライセンスが必要な機能となるため、この状況下でライセンスだけを剥奪するとこのエラーが発生します。</p><ul><li>ExO の eDiscovery でインプレース保持を有効にする</li><li>ExO で訴訟ホールドを有効にする</li><li>SCC (セキュリティ/コンプライアンス センター) の eDiscovery でインプレース保持を適用する</li><li>SCC のアイテム保持ポリシーを適用する</li></ul><p>※ ExO の訴訟ホールドが有効な場合だけは少し違うメッセージになります。</p><blockquote><p>ErrorDescription : Exchange can’t disable the mailbox “JPNPR01A004.PROD.OUTLOOK.COM/Microsoft Exchange Hosted Organizations/yowatana002.onmicrosoft.com/testuserB” because it is <span style="color: red">on litigation hold</span></p></blockquote><p>これらの保持が有効かどうかについては、基本的には Get-Mailbox コマンドで確認できます。<br>LitigationHoldEnabled が True なら訴訟ホールドが有効で、InPlaceHolds に何かの値が入っていれば他の 3 つのうちのどれかの設定で保持が有効になっています。</p><p><img src="081003.jpg" alt=""></p><p>いずれの保持が有効であったとしても対処方法は以下の公開情報にあるとおりで、ライセンスを剥奪して削除するのではなく、同期元のオンプレミスのユーザーを AAD Connect の同期対象外にして Azure AD 上から削除し、Exchange Online 側で非アクティブ メールボックスに変換します。</p><p>  Title : 非アクティブなメールボックスを作成する際の注意点<br>  URL : <a href="https://answers.microsoft.com/ja-jp/msoffice/forum/msoffice_o365admin-mso_exchon-mso_o365b/非アクティ/e82edc4b-d65f-4089-be72-ddfc91a0240a" target="_blank" rel="noopener">https://answers.microsoft.com/ja-jp/msoffice/forum/msoffice_o365admin-mso_exchon-mso_o365b/非アクティ/e82edc4b-d65f-4089-be72-ddfc91a0240a</a></p><p>なお、Get-Mailbox の結果の LitigationHoldEnabled が False で InPlaceHolds が空の場合でも、同様のエラー メッセージが記録される場合も実はあります。<br>しかも2パターンあります。</p><p>1 つ目は、SCC のアイテム保持ポリシーを個別のメールボックスに対してではなく、組織レベルで適用している場合です。<br>組織レベルで適用されているかなどの詳細は以下のブログでご紹介しているので、もしいずれの保持も設定されていなそうなときはご確認ください。</p><p>  Title : セキュリティ コンプライアンス センターで設定する保持ポリシーのメールボックスへの適用状況を確認する方法<br>  URL : <a href="https://blogs.technet.microsoft.com/exchangeteamjp/2018/04/17/how-to-see-which-retention-policy-is-applied-to-your-mailbox/" target="_blank" rel="noopener">https://blogs.technet.microsoft.com/exchangeteamjp/2018/04/17/how-to-see-which-retention-policy-is-applied-to-your-mailbox/</a></p><p>2 つ目は、削除の直前までインプレース ホールドや訴訟ホールドが有効だった場合です。<br>このようなシナリオで削除を試みた場合は、Get-Mailbox の DelayHoldApplied の設定を確認してみてください。</p><p><img src="081004.jpg" alt=""></p><p>この画像のように DelayHoldApplied が True となっている場合は、意図的にメールボックスの削除が 30 日遅延される動作になり、Exchange Online 的にはその間はインプレース ホールドが有効な状態と判断するため、同じエラーが出ます。<br>これは、直前まで保持が有効なメールボックスであったので、誤操作などで本来は必要であったデータを間違って削除してしまうことがないように、Exchange Online が意図的に値を True に設定して削除を遅延させています。<br>もちろん、対象のメールボックスに誤りがなければ遅延させる必要はないので、以下のコマンドで DelayHoldApplied を False に変更してメールボックスが削除されるか確認していただければと思います。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set-Mailbox</span> <span class="literal">-Identity</span> &lt;対象のメールボックス&gt; <span class="literal">-RemoveDelayHoldApplied</span></span><br></pre></td></tr></table></figure><h3 id="2-ExchagneGuid-関連のエラー"><a href="#2-ExchagneGuid-関連のエラー" class="headerlink" title="2. ExchagneGuid 関連のエラー"></a>2. ExchagneGuid 関連のエラー</h3><p>続いてのエラーは、一度メールボックスを削除しようとしたものの、やはりメールボックスが必要だということになり、新しいメールボックスを作成しようとしたときに発生したものです。<br>実際はこのエラーにより新しいメールボックスは作成されていませんでした。</p><blockquote><p>ErrorDescription : The value “01855e55-d849-4631-b160-5c9c1ad491dc” of property “ExchangeGuid” is used by another recipient object. Please specify a unique value.</p></blockquote><p>エラーの内容通り、ExchangeGuid に設定されている値が、他の受信者オブジェクトと競合してしまっているために、エラーになっているようです。</p><p>下の絵を見ながら読んでもらえればと思うのですが、このユーザーは以前のメールボックスを削除する前からオンプレミスのリモート メールボックスに、Exchange Online のメールボックスと同じ ExchangeGuid が設定されていました。<br>オンプレミスのメールボックスを Exchange Online に移動すると自動的にこのような設定になりますね。<br>そしてメールボックスを削除するためにオンプレミスのリモート メールボックスを Azure AD の同期対象外として Azure AD 上のユーザーを削除したことで、Exchange Online のメールボックスは Soft-Deleted Mailbox になりましたが、引き続き ExchangeGuid は設定されたままになっています。</p><p>そして、今回メールボックスを再作成する必要がでてきたので、改めて AAD Connect によりオンプレミスのリモート メールボックスを Azure AD に同期し、新しい Azure AD 上のユーザーを作成しました。<br>ここでポイントになるのが、最初の Soft-Deleted Mailbox の説明に書いた、Azure AD のユーザーを削除しているため Soft-Deleted Mailbox の ExternalDirectoryObject は既に空になっている (どのユーザーとも紐付いていない) ということです。<br>つまり、新しく作成された Azure AD のユーザーと Soft-Deleted Mailbox は紐付いていない ≒ 別のオブジェクト であるため、別のオブジェクトと ExchangeGuid が競合していますよということでエラーになっています。</p><p><img src="081005.jpg" alt=""></p><p>じゃあどうするのかというと、対処は簡単で以下の手順を実施するだけで、オンプレミスのリモート メールボックスの ExchangeGuid を削除すれば Exchange Online に新しいメールボックスが作成されます。</p><ol><li>オンプレミスでリモート メールボックスの ExchangeGuid を削除して値の競合を回避 (<code>Set-RemoteMailbox -ExchangeGuid 00000000-0000-0000-0000-000000000000</code>)</li><li>AAD Connect によるディレクトリ同期を実行</li><li>作成された新規ユーザーにライセンスを付与</li><li>必要があれば (必須ではありません)、オンプレミスのリモート メールボックスに対して、Exchange Online のメールボックスに設定されている ExchangeGuid を付与 (<code>Set-RemoteMailbox -ExchangeGuid xxx</code>)</li></ol><p>補足:<br>上に書いたとおりオンプレミスのリモート メールボックスの ExchangeGuid を空にすることが正しい手順ですが、「じゃあ競合しない ExchangeGuid なら設定しててもいいの？」と思った方向けに補足します。<br>これの答えは「NO」です。<br>なぜかと言うと、最初から ExchangeGuid が設定されているユーザーはオンプレミスにメールボックスが存在していた場合のみを想定しており、そのようなユーザーに関しては Exchange Online 上でライセンスを付与しても、メールボックスが作成されない (オンプレミスのメールボックスを移動する必要がある) からです。<br>※ この場合は属性値の競合が発生しているわけではないので、Get-MsolUser 上は何もエラーは発生しません。メールボックスが作られない＋エラーもないときは、リモート メールボックスに ExchangeGuid が設定されていないか確認してみましょう。</p><h3 id="3-ArchiveGuid-関連のエラー"><a href="#3-ArchiveGuid-関連のエラー" class="headerlink" title="3. ArchiveGuid 関連のエラー"></a>3. ArchiveGuid 関連のエラー</h3><p>3 つ目のエラーですが、大抵の場合 2 で紹介した ExchagneGuid のエラーに対処した後に出てくることが多いです。<br>理由は後ほど、、、ということで、ひとまずエラーの内容を見てみましょう。</p><blockquote><p>ErrorDescription : The value “ecbdbf6a-de22-4464-b5a6-332a5c2396e2” of property “ArchiveGuid” is used by another recipient object. Please specify a unique value.</p></blockquote><p>先ほどの ExchangeGuid のエラーと同じように、今度は ArchiveGuid で競合が発生しているようです。<br>最初に ExchangeGuid を対処した後に出てくることが多いと書きましたが、発生原因は ExchangeGuid と同じで、オンプレミスに設定されている値と同じ値を持つ他の受信者オブジェクトが存在していることが原因なので、ExchangeGuid だけ対処しても今度は ArchiveGuid の競合でひっかかってしまうからというのがその理由です。<br>1 回の対処で ExchangeGuid と ArchiveGuid の競合両方に対処した方が手間も少ないので、ExchangeGuid のエラーが出たら Archive が有効なメールボックスでないか (このエラーが発生しうる状態でないか) も確認しておきましょう。</p><p>次は対処についてなのですが、ExxchangeGuid と同じようにオンプレミスのリモート メールボックスに設定された ArchiveGuid を削除すればいいよねと思った方、少しお待ち下さい。<br>実はこれをやると今度は下のエラーが発生します。</p><blockquote><p>ErrorDescription : Cannot validate argument on parameter ‘ArchiveGuid’. The argument is empty. Supply an argument that isn’t empty, and try the command again.</p></blockquote><p>残念ながら、ArchiveGuid は ExchangeGuid とは違って値を未設定にして同期を行うことができません。<br>最初にアーカイブ メールボックスはオンプレミスで有効/無効を管理すると説明しましたが、オンプレミス側で有効化しているのにオンプレミスの ArchiveGuid が未設定というのはそもそもおかしいのでエラーになっているというわけです。</p><p>では、どうすればいいのかと言うと、実は ArchiveGuid の競合の場合は ExchangeGuid とは違って、オンプレミスのリモート メールボックスに設定されている ArchiveGuid を競合しないものに変えるだけで問題ありません。<br>そのため、以下の手順で対処できます。</p><ol><li>オンプレミスでリモート メールボックスの ArchiveGuid を別の値に変更する (Set-RemoteMailbox -ArchiveGuid xxx)</li><li>AAD Connect によるディレクトリ同期を実行</li></ol><p>補足:<br>新しい ArchiveGuid を付与するときは、自動的に GUID を作成してくれる NewGuid メソッドを以下のように使うと便利です。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set-RemoteMailbox</span> userA <span class="literal">-ArchiveGUID</span> ([<span class="type">guid</span>]::NewGUID())</span><br></pre></td></tr></table></figure><p>- 参考<br>Title : Guid.NewGuid メソッド<br>URL : <a href="https://msdn.microsoft.com/ja-jp/library/system.guid.newguid(v=vs.110).aspx" target="_blank" rel="noopener">https://msdn.microsoft.com/ja-jp/library/system.guid.newguid(v=vs.110).aspx</a></p><h2 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h2><p>今回、いくつか Azure AD と Exchange Online の同期に関する内容を紹介しました。<br>すべてのエラーについて紹介するのはなかなか難しいですが、先日のブログで紹介した Error の確認方法と上で説明したような現在の状態・構成・動作さえ把握できていれば、対処方法などもイメージしやすいのではないかと思ってまとめたつもりではありますので、今後の運用に役立てていただけたら幸いです。</p><p>※本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;こんにちは、Exchange サポートの渡辺です。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;/blog/Azure%20AD%20と%20Exchange%20Online%20の同期とトラブルシューティングの基本&quot;&gt;先日公開したブログ&lt;/a&gt;で、Azure AD と Exchan
      
    
    </summary>
    
    
    
      <category term="Hybrid" scheme="https://jpmessaging.github.io/blog/tags/Hybrid/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD と Exchange Online の同期とトラブルシューティングの基本
</title>
    <link href="https://jpmessaging.github.io/blog/Azure%20AD%20%E3%81%A8%20Exchange%20Online%20%E3%81%AE%E5%90%8C%E6%9C%9F%E3%81%A8%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%81%AE%E5%9F%BA%E6%9C%AC/"/>
    <id>https://jpmessaging.github.io/blog/Azure%20AD%20%E3%81%A8%20Exchange%20Online%20%E3%81%AE%E5%90%8C%E6%9C%9F%E3%81%A8%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%81%AE%E5%9F%BA%E6%9C%AC/</id>
    <published>2018-07-25T15:00:00.000Z</published>
    <updated>2020-06-03T03:05:04.045Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Exchange サポートの渡辺です。<br>&nbsp;<br>Exchange Online をお使いいただいているお客様もかなり増えている中、これからオンプレミスの Exchange から移行を予定されている、あるいは今が移行の真っ最中というお客様もいらっしゃるかもしれません。<br>オンプレミスから移行頂く場合、Exchange のハイブリッド環境を構成いただくことが一般的ではありますが、ハイブリッド構成ではディレクトリ同期が必須のため、ユーザーやメールボックスの管理が少し複雑になります。<br>&nbsp;<br>例えば<a href="/blog/ハイブリッド環境でオンプレミスと%20Exchange%20Online%20の両方にメールボックスが作成される事象について">こちらのブログ</a>でご紹介したメールボックスがオンプレミスと Exchange Online の両方に作られてしまうようなシナリオや、逆にライセンスを付与したのに Exchange Online にメールボックスが作成されないことがあったり、一度メールボックスを削除したものの復元する必要が出てきたときにオンプレミス/Exchange Online で何をしたらいいのかわからないなど、ユーザーやメールボックスの管理で様々なお問い合わせをいただくことが多くあります。<br>そんなときの助けになればと思い、これから何回かに分けて、このあたりの動作の説明やよくあるお問い合わせの対処方法などをご紹介できればと思っています。<br>&nbsp;<br>まず、第一回の本記事では、ディレクトリ同期を行っている環境、特にハイブリッド環境のオブジェクトがどのように関連しているのかや、Exchange Online に設定が反映されない場合のトラブルシューティングの方法についてご紹介したいと思います。<br>&nbsp;<br><u><strong><h3>Exchange Online とディレクトリ同期の基本</h3></strong></u><br>最初に登場人物の紹介をさせていただくと、ハイブリッド環境では以下の 3 つのオブジェクトを意識する必要があります。<br>&nbsp;<br>・ オンプレミス上のオブジェクト (リモート メールボックス)<br>・ Azure AD 上のオブジェクト (MsolUser)<br>・ Exchange Online 上のオブジェクト (メールボックス)<br>&nbsp;<br>それぞれのオブジェクトの関係性としては以下のようなイメージになっています。</p><a href="media/2018/07/072601.jpg"><p><img src="072601.jpg" alt=""><br></a></p><p>どのオンプレミスのリモート メールボックスが、どの Azure AD の MsolUser と同期されていて、それがどの Exchange Online のメールボックスに紐付いている (同期されている) のかというと、実は上の図に含めた各値から判断することができるようになっています。<br>&nbsp;<br>まず、一番わかりやすいのは、Azure AD の MsolUser の ObjectId と Exchange Online のメールボックスの ExternalDirectoryObjectId が、同じ値になっている点でしょう。<br>非アクティブ メールボックスなどは Azure AD 上に紐づくオブジェクトが既に無いため、ExternalDirectoryObjectId が空になっていたりします。<br>&nbsp;<br>次に、オンプレミスのリモート メールボックスと Azure AD の MsolUser なのですが、これは多少変換などが必要になるのですが、既定ではリモート メールボックスの Guid と MsolUser の ImmutableId が同じになります。<br>上記の例では、オンプレミスのリモート メールボックスの Guid が d434369b-e7a3-4011-adcb-e72ad918dd45 なのですが、以下のように変換すると Azure AD の MsolUser の ImmutableId と同じ値である mzY01KPnEUCty+cq2RjdRQ== になります。</p><a href="media/2018/07/072602.jpg"><p><img src="072602.jpg" alt=""><br></a></p><p>この変換を簡単にやってくれるツールが以下のギャラリーでも公開されているので、必要があれば使ってみていただければと思います。<br>&nbsp;<br>Title : Convert DirSync/MS Online Directory Immutable ID to AD GUID (and vice versa)<br>URL : <a href="https://gallery.technet.microsoft.com/office/Covert-DirSyncMS-Online-5f3563b1" target="_blank" rel="noopener">https://gallery.technet.microsoft.com/office/Covert-DirSyncMS-Online-5f3563b1</a><br>&nbsp;<br>また、オンプレミスと Azure AD 間の同期 (AAD Connect による同期) については、Azure Identityサポート チームの以下のブログで詳細に紹介されています。<br>上記のツールの使い方なども紹介されていますので、こちらもご一読いただければと思います。<br>&nbsp;<br>Title : Azure AD Connect : ディレクトリ同期の基本的なポイント<br>URL : <a href="https://blogs.technet.microsoft.com/jpazureid/2018/05/09/synchronization-basic-point/" target="_blank" rel="noopener">https://blogs.technet.microsoft.com/jpazureid/2018/05/09/synchronization-basic-point/</a><br>&nbsp;<br>各オブジェクトの紐づけについてまとめると以下の図のようになります。<br>今回のブログの内容ではあまり意識するポイントはありませんが、特に Exchange Online ではユーザーとメールボックスの紐付きがわかっていると理解しやすい場合もあるので、最初にこちらを説明させていただきました。<br>&nbsp;</p><div align="center"><a href="media/2018/07/072603.jpg"><p><img src="072603.jpg" alt=""><br></a></div><br>&nbsp;<br><u></p><h3><strong>Azure AD と Exchange Online の同期とトラブルシューティングの基本</strong></h3></u>続いては Azure AD と Exchange Online の間の同期と基本的なトラブルシューティングの方法についてです。&nbsp;当然のことながら、オンプレミスのリモート メールボックスに設定した内容は AAD Connect を通して Azure AD に同期され、その後 Exchange Online に同期されます。オンプレミスのリモート メールボックスに設定された情報が Azure AD へ同期されるのは AAD Connect の同期タイミングによりますが、Azure AD から Exchange Online への同期については基本的には数分程度で行われるものの、場合によっては最大で 24 時間程を要することもあります。そのため、オンプレミスで設定した内容が Exchange Online に反映されない場合や、Azure AD でライセンスを付与したけど新しいメールボックスが作成されないといった場合も、まずは 24 時間を目安にお待ちいただき、万が一 24 時間が経過しても同期されない場合にはお手数ですが弊社までお問い合わせいただければと思います。&nbsp;しかし、単純に Azure AD から Exchange Online への同期待ちで Exchange Online への同期が行われないパターン以外にも、Exchange Online への同期が行われない場合が多々あります。原因さえわかればすぐに同期できることも多くあるので、24 時間をお待ちいただくその前に、何か別の要因で反映されていない状況ではないかを確認いただければと思います。&nbsp;というわけで、今回は以下のような状況を例にして、どういったポイントを確認してけばいいのかを説明させていただきます。&nbsp;<div style="width: 800px;height: 130px;text-align: left;padding: 10px;border: 1px solid #000000">例 :オンプレミスから同期を行っているユーザーでこれまで Exchange Online でメールボックスを使用していたが、業務が変わったため、一度 Exchange Online のメールボックスを削除する必要が出てきた。メールボックスを削除するために Office 365 管理センターから対象のユーザーのライセンスを剥奪したが、24 時間経過してもメールボックスが削除されずに残ったままの状態となっている。</div>&nbsp;一見メールボックスを削除するシナリオとしては問題無さそうですが、メールボックスが削除されずに残ってしまっているようです。では何が原因なのか、少し見ていきましょう。&nbsp;まず、最初に見ていただきたいのが、Office 365 管理センターです。ライセンス外したときにもう見たよとは言わず、10 分ほどしてから改めて見ていただけばと思うのですが、先ほどライセンスを外したユーザーの情報を確認してみると、エラーらしきものが表示されています。しかし、何が問題なのかこのメッセージからだけではわからないですね。<a href="media/2018/07/072604.jpg"><p><img src="072604.jpg" alt=""><br></a></p><p>ただし、Azure AD と Exchange Online 間で何らかの要因で同期されない状況が発生している場合は大抵このメッセージが出力されるので、これが出ていれば 24 時間待ってもダメな状態だと判断できます。<br>&nbsp;<br>では続いて Azure AD の MsolUser の情報をもう少し細かく見ていくために、PowerShell で Azure AD に接続してみます。<br>接続方法は以下にまとまっていますので、初めて接続する場合などには参考にしてください。<br>&nbsp;<br>Title : Office 365 PowerShell への接続<br>URL : <a href="https://docs.microsoft.com/ja-jp/office365/enterprise/powershell/connect-to-office-365-powershell" target="_blank" rel="noopener">https://docs.microsoft.com/ja-jp/office365/enterprise/powershell/connect-to-office-365-powershell</a><br>&nbsp;<br>Azure AD に PowerShell 接続して見ると、対象のユーザーの Errors に情報が含まれているようですが、これも何が問題なのかさっぱりわからないですね。</p><a href="media/2018/07/072605.jpg"><p><img src="072605.jpg" alt=""><br></a></p><p>PowerShell はオブジェクトで情報出力するので、意外と奥深くに情報が含まれていたりします。<br>なので、今度は Errors の中をもう少し深くまで見えるように実行してみたところ、ようやく ErrorDescription に原因と思われるものが見つかりました。<br>どうやら対象のメールボックスではインプレース ホールドが有効だったために無効化 (メールボックスの削除) に失敗していたようです。</p><a href="media/2018/07/072606.jpg"><p><img src="072606.jpg" alt=""><br></a></p><p>※ 実行したコマンドは以下です<br>(Get-MsolUser -SearchString testuserA).Errors.ErrorDetail.ObjectErrors.ErrorRecord | fl<br>&nbsp;<br>というわけで、このシナリオの場合は以下でもご紹介しているインプレース保持や訴訟ホールドが有効なメールボックスでは、メールボックスを削除するときにはライセンスを剥奪して削除するのではなく、同期元のオンプレミスのユーザーを AAD Connect の同期対象外にして Azure AD 上から削除し、Exchange Online 側では非アクティブ メールボックスとする必要があったという話でした。<br>&nbsp;<br>Title : 非アクティブなメールボックスを作成する際の注意点<br>URL : <a href="https://answers.microsoft.com/ja-jp/msoffice/forum/msoffice_o365admin-mso_exchon-mso_o365b/非アクティ/e82edc4b-d65f-4089-be72-ddfc91a0240a" target="_blank" rel="noopener">https://answers.microsoft.com/ja-jp/msoffice/forum/msoffice_o365admin-mso_exchon-mso_o365b/非アクティ/e82edc4b-d65f-4089-be72-ddfc91a0240a</a><br>&nbsp;<br>他にも様々な要因で Office 365 管理センター上にエラー メッセージが表示されるのですが、どれも同じ PowerShell のコマンドで詳細を確認することができるので、機会があればぜひ確認してみてください。<br>もちろん、エラー メッセージを見てもどうやって対処したらいいかわからないこともあるかと思うので、その際は弊社までお問い合わせいただければと思いますし、今後もブログ等でいくつかご紹介しようと思っているので、それらも参考にしていただけると幸いです。<br>&nbsp;<br>上記の方法で確認できる代表的なエラーについての解説や対処方法を以下のブログにまとめましたので、こちらも併せてご確認ください。</p><p>&nbsp;&nbsp;Title : Azure AD と Exchange Online 間の同期に関するエラーの事例集<br>&nbsp;&nbsp;URL : <a href="https://blogs.technet.microsoft.com/exchangeteamjp/2018/08/10/case-studies-of-synchronization-aad-exo/" target="_blank" rel="noopener">https://blogs.technet.microsoft.com/exchangeteamjp/2018/08/10/case-studies-of-synchronization-aad-exo/</a> </p><p>&nbsp;<br>※本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;こんにちは、Exchange サポートの渡辺です。&lt;br&gt;&amp;nbsp;&lt;br&gt;Exchange Online をお使いいただいているお客様もかなり増えている中、これからオンプレミスの Exchange から移行を予定されている、あるいは今が移行の真っ最中というお客様もいらっ
      
    
    </summary>
    
    
    
      <category term="Hybrid" scheme="https://jpmessaging.github.io/blog/tags/Hybrid/"/>
    
  </entry>
  
  <entry>
    <title>アカウントを乗っ取られた際の対応について
</title>
    <link href="https://jpmessaging.github.io/blog/%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88%E3%82%92%E4%B9%97%E3%81%A3%E5%8F%96%E3%82%89%E3%82%8C%E3%81%9F%E9%9A%9B%E3%81%AE%E5%AF%BE%E5%BF%9C%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6/"/>
    <id>https://jpmessaging.github.io/blog/%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88%E3%82%92%E4%B9%97%E3%81%A3%E5%8F%96%E3%82%89%E3%82%8C%E3%81%9F%E9%9A%9B%E3%81%AE%E5%AF%BE%E5%BF%9C%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6/</id>
    <published>2018-07-18T15:00:00.000Z</published>
    <updated>2020-06-03T03:06:34.759Z</updated>
    
    <content type="html"><![CDATA[<p>Office 365 をご利用いただいているお客様からよく寄せられるご質問のひとつとして、アカウントが乗っ取られた（ハッキングされた）際にどう対処すればよいかという質問があります。<br>最も一般的なシナリオは、組織のメンバーがフィッシング詐欺の被害者になり、攻撃者にアカウントのパスワードを取得されてしまったというものです。<br>このブログではアカウント乗っ取りの発覚から、乗っ取りが確定した場合の対応、そして再びアカウントを乗っ取られないようにするための予防策についてご紹介したいと思います。</p><h2 id="1-問題の発覚"><a href="#1-問題の発覚" class="headerlink" title="1. 問題の発覚"></a>1. 問題の発覚</h2><p>アカウントが乗っ取られた際によく見られるアクションとしては、例えば以下のようなものがあります。</p><ul><li>メッセージがなくなっている、もしくは削除されている</li><li>乗っとられたアカウントからメールを受け取ったユーザーがいるが、乗っ取られたアカウントの送信済みフォルダーには送信済みのメールがない</li><li>管理者やユーザーが設定した覚えのない受信トレイ ルールや転送ルールが設定されており、内容としては、見知らぬアドレスへ転送するものや、[メモ]/[迷惑メール]/[RSS フィード] フォルダーへアイテムを移動す- るようなルールが設定されている</li><li>Global Address List 上のユーザー名が変更されている</li><li>乗っ取られたユーザーの外部へのメール送信がブロックされており、メールを送信すると “550 5.1.8 Access denied, bad outbound sender AS(XXXXXXX)” という NDR を受信する</li></ul><h2 id="2-管理者による調査"><a href="#2-管理者による調査" class="headerlink" title="2. 管理者による調査"></a>2. 管理者による調査</h2><p>Security &amp; Compliance Center や Azure ポータルから、対象のアカウントのアクティビティの詳細を確認し、アカウントが想定していない動きをしていないかを確認します。 一般的な確認項目を以下に記載します。</p><h3 id="Azure-ポータル"><a href="#Azure-ポータル" class="headerlink" title="Azure ポータル"></a>Azure ポータル</h3><p>対象のアカウントにログインしているアクセス元 IP/サインインの場所<br>サインインに成功/失敗した回数</p><h3 id="O365-管理センター"><a href="#O365-管理センター" class="headerlink" title="O365 管理センター"></a>O365 管理センター</h3><p>ユーザー &gt; アクティブなユーザー で対象のアカウントを選択し、[メールの設定] に見覚えのない転送設定が作成されていないか確認<br>ユーザー &gt; アクティブなユーザー より、管理者アカウントが増えていないか確認</p><h3 id="Security-Compliance-センター"><a href="#Security-Compliance-センター" class="headerlink" title="Security/Compliance センター"></a>Security/Compliance センター</h3><p>統合監査ログ（UnifiedAuditLog) で対象アカウントのアクションを確認<br>※統合監査ログはあらかじめ有効化されている必要があり、事象が発生してから有効化しても遡ってログを確認することはできません。弊社では、来年の夏までにすべてのテナントで既定で統合監査ログが有効化されるように準備を進めています。</p><p>参考情報:<br>Title: Office 365 の監査ログの検索を有効または無効にする<br>Url: <a href="https://support.office.com/ja-jp/article/office-365-の監査ログの検索を有効または無効にする-e893b19a-660c-41f2-9074-d3631c95a014?ui=ja-JP&amp;rs=ja-JP&amp;ad=JP" target="_blank" rel="noopener">https://support.office.com/ja-jp/article/office-365-の監査ログの検索を有効または無効にする-e893b19a-660c-41f2-9074-d3631c95a014?ui=ja-JP&amp;rs=ja-JP&amp;ad=JP</a></p><p>※統合監査ログからメールボックス監査ログ（MailboxLogin/アイテムの Create/Delete 等のアクティビティ）を確認するためには、あらかじめ Exchange Online 側で対象のメールボックスの監査ログが有効化されており、かつ、監査対象に適切なアクティビティが定義されている必要があります。</p><p>参考情報:<br>Title: Office 365 でメールボックスの監査を有効にする<br>Url: <a href="https://support.office.com/ja-jp/article/office-365-でメールボックスの監査を有効にする-aaca8987-5b62-458b-9882-c28476a66918?ui=ja-JP&amp;rs=ja-JP&amp;ad=JP" target="_blank" rel="noopener">https://support.office.com/ja-jp/article/office-365-でメールボックスの監査を有効にする-aaca8987-5b62-458b-9882-c28476a66918?ui=ja-JP&amp;rs=ja-JP&amp;ad=JP</a></p><h2 id="3-対処および再発防止のためのアクション"><a href="#3-対処および再発防止のためのアクション" class="headerlink" title="3. 対処および再発防止のためのアクション"></a>3. 対処および再発防止のためのアクション</h2><p>再発防止策としては一般的に以下のアクションを実施いただくようご案内しております。</p><ul><li>対象のアカウントに設定されている不要な代理アクセスを削除する</li><li>外部ドメインへの転送を制限する</li><li>多要素認証（MFA) を有効化する</li><li>StrongPassword(複雑なパスワード)が設定されるよう強制する</li><li>メールボックス監査ログ/統合監査ログを有効化する</li></ul><p>各アクションの詳細については、以下のブログをご参照ください。</p><p>Title: How to fix a compromised (hacked) Microsoft Office 365 account<br>Section: Remediate affected account and improve your security posture<br>Url: <a href="https://blogs.technet.microsoft.com/office365security/how-to-fix-a-compromised-hacked-microsoft-office-365-account/" target="_blank" rel="noopener">https://blogs.technet.microsoft.com/office365security/how-to-fix-a-compromised-hacked-microsoft-office-365-account/</a></p><p>なお、管理者アカウントについては被害にあった場合の影響が大きいため、あらかじめ多要素認証の有効化を強く推奨させていただきます。<br>またIDのセキュリティ保護については以下の公開情報についても併せてご参照下さい。</p><p>Title: Azure AD でのハイブリッドおよびクラウド デプロイ用の特権アクセスをセキュリティで保護する<br>Url: <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/users-groups-roles/directory-admin-roles-secure?toc=%2fazure%2factive-directory%2fprivileged-identity-management%2ftoc.json" target="_blank" rel="noopener">https://docs.microsoft.com/ja-jp/azure/active-directory/users-groups-roles/directory-admin-roles-secure?toc=%2fazure%2factive-directory%2fprivileged-identity-management%2ftoc.json</a></p><p>Title: Azure Active Directory Identity Protection<br>Url: <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/active-directory-identityprotection" target="_blank" rel="noopener">https://docs.microsoft.com/ja-jp/azure/active-directory/active-directory-identityprotection</a></p><p>Title: Azure AD Privileged Identity Management とは<br>Url: <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/privileged-identity-management/pim-configure" target="_blank" rel="noopener">https://docs.microsoft.com/ja-jp/azure/active-directory/privileged-identity-management/pim-configure</a></p><h2 id="リンク集"><a href="#リンク集" class="headerlink" title="リンク集"></a>リンク集</h2><p>いずれも英語の記事となりますが、ご紹介したリンク以外にも、アカウント乗っ取りに対処する上で有用な記事を記載いたします。</p><p>Title: Finding Illicit Activity The Old Fashioned Way<br>Url: <a href="https://blogs.technet.microsoft.com/office365security/finding-illicit-activity-the-old-fashioned-way/" target="_blank" rel="noopener">https://blogs.technet.microsoft.com/office365security/finding-illicit-activity-the-old-fashioned-way/</a></p><p>Title: Responding to a Compromised Email Account in Office 365<br>Url: <a href="https://docs.microsoft.com/en-us/office365/enterprise/responding-to-a-compromised-email-account" target="_blank" rel="noopener">https://docs.microsoft.com/en-us/office365/enterprise/responding-to-a-compromised-email-account</a></p><p>以下のブログは O365 セキュリティ チームの公式ブログとなりますので、ご購読いただければ幸いです。</p><p>Title: Securing Office 365<br>Url: <a href="https://blogs.technet.microsoft.com/office365security/" target="_blank" rel="noopener">https://blogs.technet.microsoft.com/office365security/</a></p><p>今後とも Office 365 をよろしくお願いいたします。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Office 365 をご利用いただいているお客様からよく寄せられるご質問のひとつとして、アカウントが乗っ取られた（ハッキングされた）際にどう対処すればよいかという質問があります。&lt;br&gt;最も一般的なシナリオは、組織のメンバーがフィッシング詐欺の被害者になり、攻撃者にアカウ
      
    
    </summary>
    
    
    
      <category term="O365Identity" scheme="https://jpmessaging.github.io/blog/tags/O365Identity/"/>
    
  </entry>
  
  <entry>
    <title>Export-Office365LicenseStatus のご紹介
</title>
    <link href="https://jpmessaging.github.io/blog/Export-Office365LicenseStatus%20%E3%81%AE%E3%81%94%E7%B4%B9%E4%BB%8B/"/>
    <id>https://jpmessaging.github.io/blog/Export-Office365LicenseStatus%20%E3%81%AE%E3%81%94%E7%B4%B9%E4%BB%8B/</id>
    <published>2018-05-28T15:00:00.000Z</published>
    <updated>2020-06-03T03:05:04.062Z</updated>
    
    <content type="html"><![CDATA[<p>今回は Office 365 の管理者の皆様に、ライセンス付与状況を出力する PowerShell スクリプトをご紹介します。</p><p>Office 365 のライセンスを確認する場合、GUI ツールとしては Office 365 管理センターが利用できます。また、CUI ツールとしては MSOnline (Azure AD v1) モジュールの Get-MsolUser コマンドも利用できます。しかしながらどちらを利用しても、ライセンスに含まれる各サービス プランのステータスまで含めて一覧表示する機能が標準では用意されていません。</p><p>Get-MsolUser コマンドの出力内容を整形する PowerShell スクリプトを書くことで実現が可能ですが、Get-MsolUser コマンドの出力は複雑な構造となっているため、スクリプティングに慣れていないと実装が難しい状況です。例えば Get-MsolUser コマンドの Licenses 属性は、ユーザーに複数のライセンスが割り当てられていれば値が配列になっています。さらに Licenses 属性の子属性として ServiceStatus 属性があり、当該ライセンスに含まれている各サービス プランのステータスに関する情報が入れ子になっています。</p><p>このようなスクリプティングに関するお問い合わせを頻繁にお客様より頂くため、これまでのお問い合わせでのお客様のご要望を基に、私たちは <a target="_blank" href="https://github.com/Microsoft/Export-Office365LicenseStatus" rel="noopener">Export-Office365LicenseStatus</a> を GitHub に公開しました。この PowerShell スクリプトを使用すると、Office 365 の各ユーザーに割り当てられているライセンスや、ライセンスに含まれている各サービス プランのステータスを一覧表示することができます。CSV 出力機能も備えており、出力された CSV ファイルを Excel で開いてさらなる集計を行うことも可能です。</p><p>実行例を交えながら使い方をご紹介します。</p><h2 style="margin-top: 40px;margin-bottom: 20px">ダウンロード方法</h2>スクリプトは GitHub の <a target="_blank" href="https://github.com/Microsoft/Export-Office365LicenseStatus/releases" rel="noopener">releases</a> ページからダウンロードできます。最新の Export-Office365LicenseStatus.zip をダウンロードしてください。<h2 style="margin-top: 40px;margin-bottom: 20px">準備</h2><ol>     <li>スクリプトの実行には MSOnline (Azure AD v1) モジュールが必要です。インストールされていない場合は<a target="_blank" href="https://blogs.technet.microsoft.com/jpazureid/2017/12/04/aad-powershell/" rel="noopener">こちらのページ</a>を参考にしてインストールしてください。</li>     <li>ダウンロードした Export-Office365LicenseStatus.zip を展開します。</li>     <li>Export-Office365LicenseStatus.ps1 のプロパティをクリックします。</li>     <li>(Windows 10) [全般] タブの [セキュリティ] の [許可する] のチェックをオンにします。[許可する] が表示されていない場合は特に操作は必要ありません。(Windows 7) [全般] タブの [セキュリティ] の [ブロックの解除] をクリックします。[ブロックの解除] が表示されていない場合は特に操作は必要ありません。</li>     <li>[OK] をクリックしてプロパティを閉じます。</li>     <li>管理者権限で Windows PowerShell を起動します。</li>     <li>以下のコマンドを実行します。<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-ExecutionPolicy</span></span><br></pre></td></tr></table></figure></li>     <li>実行結果が RemoteSigned / Bypass / Unrestricted 以外の値だった場合は、以下のコマンドを実行します。確認が表示されたら「Y」を入力してください。<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set-ExecutionPolicy</span> RemoteSigned</span><br></pre></td></tr></table></figure></li></ol><h2 style="margin-top: 40px;margin-bottom: 20px">基本的な使い方</h2>用途に応じて複数の使い方がありますので、いくつかのパターンをご紹介します。まずは Windows PowerShell を起動して Export-Office365LicenseStatus.ps1 を保存したフォルダーに移動しておいてください。なお Windows PowerShell を Azure Active Directory に接続していない (Connect-MsolService コマンドを実行していない) 状態でスクリプトを実行すると、認証ウィンドウが表示されますので、Office 365 テナントの全体管理者ユーザーの資格情報を入力してください。<h3 style="margin-top: 30px;margin-bottom: 20px">全ユーザーの情報をコンソール出力する</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\<span class="built_in">Export-Office365LicenseStatus</span>.ps1 <span class="literal">-All</span> <span class="variable">$true</span></span><br></pre></td></tr></table></figure><h3 style="margin-top: 30px;margin-bottom: 20px">特定のユーザーの情報をコンソール出力する</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\<span class="built_in">Export-Office365LicenseStatus</span>.ps1 <span class="literal">-UserPrincipalName</span> User01@contoso.onmicrosoft.com</span><br></pre></td></tr></table></figure><h3 style="margin-top: 30px;margin-bottom: 20px">特定のユーザーの情報を CSV に出力する</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\<span class="built_in">Export-Office365LicenseStatus</span>.ps1 <span class="literal">-UserPrincipalName</span> User01@contoso.onmicrosoft.com <span class="literal">-CsvOutputPath</span> C:\temp\License.csv</span><br></pre></td></tr></table></figure><h3 style="margin-top: 30px;margin-bottom: 20px">ライセンスが割り当てられていないユーザーも含むすべてのユーザーの情報を CSV に出力し、指定されたパスにファイルが存在しても上書きする</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\<span class="built_in">Export-Office365LicenseStatus</span>.ps1 <span class="literal">-All</span> <span class="variable">$true</span> <span class="literal">-CsvOutputPath</span> C:\temp\License.csv <span class="literal">-ExportNoLicenseUser</span> <span class="literal">-Force</span></span><br></pre></td></tr></table></figure><h2 style="margin-top: 40px;margin-bottom: 20px">出力イメージ</h2>コンソール出力の場合は、以下のように出力されます。ここでは見やすいようにスクリプトの実行結果を ft (Format-List) で表示しています。ちなみに ProvisioningStatus が Disabled になっているサービス プランは無効化されており、それ以外のものは有効化されています。<a target="_blank" href="media/2018/05/2018052801b.png"><p><img src="2018052801b.png" alt=""><br></a></p><p>CSV 出力の場合は、Excel で表示すると以下のようになります。Excel のフィルタ機能もしくはピボット テーブル等で整形ください。<br><a target="_blank" href="media/2018/05/2018052802.png" rel="noopener"></p><p><img src="2018052802.png" alt=""><br></a></p><p>このほかにもパラメーターの組み合わせで異なる使い方が可能ですので、必要に応じてお試しください。</p><p>ライセンスの割り当てなどの管理を行う方法については<a target="_blank" href="https://blogs.technet.microsoft.com/exchangeteamjp/2018/04/02/office365-license-management/" rel="noopener">こちら</a>の記事をご参照ください。</p><p>なお Export-Office365LicenseStatus は弊社の製品・サービスではないため、スクリプト自体に関するサポートは弊社からは提供されません。スクリプト自体に対するフィードバックは GitHub の <a target="_blank" href="https://github.com/Microsoft/Export-Office365LicenseStatus/issues" rel="noopener">issues</a> に投稿していただくようお願いいたします。ベスト エフォートとはなりますが弊社のエンジニアや有志の GitHub ユーザーが対応します。Export-Office365LicenseStatus はオープン ソースのため、読者の皆様からのプル リクエストも歓迎します。</p><p>今後も当ブログおよびサポート チームをよろしくお願いいたします。<br>※ 本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</p><p><span style="color: #ff6600">小間 竜太郎</span></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;今回は Office 365 の管理者の皆様に、ライセンス付与状況を出力する PowerShell スクリプトをご紹介します。&lt;/p&gt;
&lt;p&gt;Office 365 のライセンスを確認する場合、GUI ツールとしては Office 365 管理センターが利用できます。また、C
      
    
    </summary>
    
    
    
      <category term="O365Identity" scheme="https://jpmessaging.github.io/blog/tags/O365Identity/"/>
    
  </entry>
  
  <entry>
    <title>Office 365 タイルの非表示方法
</title>
    <link href="https://jpmessaging.github.io/blog/Office%20365%20%E3%82%BF%E3%82%A4%E3%83%AB%E3%81%AE%E9%9D%9E%E8%A1%A8%E7%A4%BA%E6%96%B9%E6%B3%95/"/>
    <id>https://jpmessaging.github.io/blog/Office%20365%20%E3%82%BF%E3%82%A4%E3%83%AB%E3%81%AE%E9%9D%9E%E8%A1%A8%E7%A4%BA%E6%96%B9%E6%B3%95/</id>
    <published>2018-04-02T15:00:00.000Z</published>
    <updated>2020-06-03T03:06:34.759Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。いつも Office 365 を利用いただきまして、ありがとうございます。<br>今回は、Office 365 タイルの非表示方法について、ご紹介いたします。</p><p>Office 365 ポータルにアクセスしますと、トップページやアプリランチャーに各サービスのタイルが表示されます。<br>管理者側で指定したサービスのみユーザーに使用させるには、不要なタイルを非表示に設定することが有効です。</p><p><img src="20180403.png" alt=""></p><p>タイルを非表示にするには、基本的には、ユーザーに付与されたライセンスの中でサービスプランを無効化する方法となりますが、「ストア」のみ Office 365 管理センターのメニュー（サービスとアドイン）にて設定を行います。</p><p>下記では、2018/4/3時点の Office 365 Enterprise E5 を使用している環境を元に手順をご案内いたします。<br>各サービスごとにブログが公開しておりますので、今回の投稿は、まとめページとして参照いただけますと幸いです。</p><h2 id="Exchange-Online-関連"><a href="#Exchange-Online-関連" class="headerlink" title="Exchange Online 関連"></a>Exchange Online 関連</h2><h3 id="Outlook、予定表、連絡先、タスク、MyAnalytics"><a href="#Outlook、予定表、連絡先、タスク、MyAnalytics" class="headerlink" title="Outlook、予定表、連絡先、タスク、MyAnalytics"></a>Outlook、予定表、連絡先、タスク、MyAnalytics</h3><p>Exchange Online 製品群である上記のタイルは Exchange Online 製品のライセンスを削除することで、非表示にすることが可能です。</p><p>※下記のサービスは、Exchange Online と依存関係があるため、サービスプランの追加 / 削除を行う際は、一緒に操作する必要があります。</p><ul><li>MyAnalytics（EXCHANGE_ANALYTICS）</li><li>Office 365 Threat Intelligence（THREAT_INTELLIGENCE）</li></ul><hr><h2 id="Platform-関連"><a href="#Platform-関連" class="headerlink" title="Platform 関連"></a>Platform 関連</h2><h3 id="ストア"><a href="#ストア" class="headerlink" title="ストア"></a>ストア</h3><p>Office 365 管理センターの設定メニュー [サービスとアドイン] - [ユーザーが所有するアプリとサービス ] からタイルの非表示が可能です。すべてのユーザーが非表示の対象となります。</p><hr><h2 id="SharePoint-Online-関連-1"><a href="#SharePoint-Online-関連-1" class="headerlink" title="SharePoint Online 関連 1"></a>SharePoint Online 関連 1</h2><h3 id="SharePoint、OneDrive"><a href="#SharePoint、OneDrive" class="headerlink" title="SharePoint、OneDrive"></a>SharePoint、OneDrive</h3><p>SharePoint 管理センターの設定メニュー (オプションの表示または非表示) からタイルの非表示が可能です。すべてのユーザーが非表示の対象となります。<br>ただし、URL &lt;例. <a href="https://contoso.sharepoint.com/_layouts/15/sharepoint.aspx&gt;" target="_blank" rel="noopener">https://contoso.sharepoint.com/_layouts/15/sharepoint.aspx&gt;</a> および &lt;例. <a href="https://contoso-my.sharepoint.com/_layouts/15/MySite.aspx?MySiteRedirect=AllDocuments&gt;" target="_blank" rel="noopener">https://contoso-my.sharepoint.com/_layouts/15/MySite.aspx?MySiteRedirect=AllDocuments&gt;</a> より直接 SharePoint ホーム ページおよび OneDrive for Business にアクセスすることは可能です。</p><p>参考情報<br>OneDrive および SharePoint アプリのタイルを非表示にする<br><a href="https://support.office.com/ja-jp/article/d5e8dc9a-73f8-45e4-93b4-8e55b546a5af" target="_blank" rel="noopener">https://support.office.com/ja-jp/article/d5e8dc9a-73f8-45e4-93b4-8e55b546a5af</a></p><h3 id="ニュースフィード"><a href="#ニュースフィード" class="headerlink" title="ニュースフィード"></a>ニュースフィード</h3><p>SharePoint 管理センターの設定メニュー (エンタープライズ イベントのグループ作業) からタイルの非表示が可能です。すべてのユーザーが非表示の対象となります。<br>ただし、URL &lt;例. <a href="https://contoso-my.sharepoint.com/default.aspx&gt;" target="_blank" rel="noopener">https://contoso-my.sharepoint.com/default.aspx&gt;</a> より直接 Newsfeed にアクセスすることは可能です。</p><h3 id="Delve"><a href="#Delve" class="headerlink" title="Delve"></a>Delve</h3><p>SharePoint 管理センターの設定メニュー (Office Graph) からタイルの非表示が可能です。すべてのユーザーが非表示の対象となります。<br>ただし、URL <a href="https://jpn.delve.office.com" target="_blank" rel="noopener">https://jpn.delve.office.com</a> より直接 Delve にアクセスすることは可能ですが、Office Graph 機能により表示されていたコンテンツは非表示となります。</p><h3 id="Video"><a href="#Video" class="headerlink" title="Video"></a>Video</h3><p>SharePoint 管理センターの設定メニュー (ストリーミング ビデオ サービス) からのタイルの非表示が可能です。すべてのユーザーが非表示の対象となります。<br>Office 365 Video にアクセスできなくなる動作となります。</p><h3 id="Stream"><a href="#Stream" class="headerlink" title="Stream"></a>Stream</h3><p>Stream 製品については、Stream のユーザーからライセンスを削除することで、タイルの非表示が可能です。<br>ただし、URL <a href="https://web.microsoftstream.com/" target="_blank" rel="noopener">https://web.microsoftstream.com/</a> より直接 Stream にアクセスし会社全体に公開されたビデオの閲覧を行うことが可能です。</p><p>参考情報<br>Microsoft Stream を PowerShell を使用して一括で有効化、無効化する方法について<br><a href="https://blogs.technet.microsoft.com/sharepoint_support/2017/06/21/microsoft-stream-を-powershell-を使用して一括で有効化、無効化する方/" target="_blank" rel="noopener">https://blogs.technet.microsoft.com/sharepoint_support/2017/06/21/microsoft-stream-を-powershell-を使用して一括で有効化、無効化する方/</a></p><h3 id="Yammer"><a href="#Yammer" class="headerlink" title="Yammer"></a>Yammer</h3><p>Yammer 製品については、Yammer のライセンスをユーザーから削除することで、タイルの非表示が可能です。<br>ただし、Yammer ネットワーク上でライセンスを保持していないユーザーのログインをブロックしていない場合、URL を直接入力することで Yammer にログインすることが可能です。</p><p>参考情報<br>Office 365 での Yammer ユーザー ライセンスの管理<br><a href="https://support.office.com/ja-jp/article/office-365-での-yammer-ユーザー-ライセンスの管理-34a67e3a-3fd8-4e54-bffb-dd5ad0e48590" target="_blank" rel="noopener">https://support.office.com/ja-jp/article/office-365-での-yammer-ユーザー-ライセンスの管理-34a67e3a-3fd8-4e54-bffb-dd5ad0e48590</a></p><hr><h2 id="SharePoint-Online-関連-2"><a href="#SharePoint-Online-関連-2" class="headerlink" title="SharePoint Online 関連 2"></a>SharePoint Online 関連 2</h2><h3 id="Planner"><a href="#Planner" class="headerlink" title="Planner"></a>Planner</h3><p>Planner 製品については、Planner のライセンスをユーザーから削除することで、タイルの非表示が可能です。<br>ライセンスを無効化した場合でも、URL直接アクセスを行うことで、Planner の機能は利用可能です。<br>ライセンスが無効化されている状態であっても、直接 <a href="https://tasks.office.com" target="_blank" rel="noopener">https://tasks.office.com</a> に直接アクセスすることで、Planner 機能を使用することが可能です。</p><p>参考情報<br>Microsoft Planner を PowerShell を使用して一括で有効化、無効化する方法について<br><a href="https://blogs.technet.microsoft.com/sharepoint_support/2016/05/27/office-365-planner-powershell-enable-disable/" target="_blank" rel="noopener">https://blogs.technet.microsoft.com/sharepoint_support/2016/05/27/office-365-planner-powershell-enable-disable/</a></p><p>Microsoft Planner にて一般ユーザーによるプラン作成を制限する方法について (V2)<br><a href="https://blogs.technet.microsoft.com/sharepoint_support/2017/03/27/microsoft-planner-plan-creation-restriction-v2/" target="_blank" rel="noopener">https://blogs.technet.microsoft.com/sharepoint_support/2017/03/27/microsoft-planner-plan-creation-restriction-v2/</a></p><h3 id="Sway"><a href="#Sway" class="headerlink" title="Sway"></a>Sway</h3><p>Sway 製品については、Sway のライセンスをユーザーから削除することで、タイルの非表示が可能です。<br>ライセンスを無効化されたユーザーは Sway にアクセスできなくなる動作となります。</p><p>参考情報<br>Office 365 Sway を PowerShell を使用して一括で有効化、無効化 (停止) する方法について<br><a href="https://blogs.technet.microsoft.com/officesupportjp/2016/06/08/office-365-sway-enable-disable/" target="_blank" rel="noopener">https://blogs.technet.microsoft.com/officesupportjp/2016/06/08/office-365-sway-enable-disable/</a></p><h3 id="Forms"><a href="#Forms" class="headerlink" title="Forms"></a>Forms</h3><p>Forms 製品については、Forms のライセンスをユーザーから削除することで、タイルの非表示が可能です。</p><p>参考情報<br>Office 365 の Microsoft Forms を PowerShell を使用して一括で有効化、無効化 (停止) する方法について<br><a href="https://blogs.technet.microsoft.com/officesupportjp/2016/06/29/office-365-forms-enable-disable/" target="_blank" rel="noopener">https://blogs.technet.microsoft.com/officesupportjp/2016/06/29/office-365-forms-enable-disable/</a></p><h3 id="Office-Online-関連"><a href="#Office-Online-関連" class="headerlink" title="Office Online 関連"></a>Office Online 関連</h3><h3 id="Word、Excel、PowerPoint、OneNote"><a href="#Word、Excel、PowerPoint、OneNote" class="headerlink" title="Word、Excel、PowerPoint、OneNote"></a>Word、Excel、PowerPoint、OneNote</h3><p>Office Online 製品の関連タイルである、Excel、Word、PowerPoint、OneNote の 4 点については、SharePoint Online および Office Online のライセンスを両方削除ことで、アプリケーション ランチャー上のタイルが非表示となります。</p><hr><h2 id="Data-Platform-関連"><a href="#Data-Platform-関連" class="headerlink" title="Data Platform 関連"></a>Data Platform 関連</h2><h3 id="PowerApps、Flow、PowerBI"><a href="#PowerApps、Flow、PowerBI" class="headerlink" title="PowerApps、Flow、PowerBI"></a>PowerApps、Flow、PowerBI</h3><p>それぞれの製品ライセンスを削除することで、タイルの非表示が可能です。</p><h3 id="Dynamics-365"><a href="#Dynamics-365" class="headerlink" title="Dynamics 365"></a>Dynamics 365</h3><p>Dynamics 365 製品については、同じ製品群に属する PowerApps と Microsoft Flow のライセンスを合わせて削除する必要があります。</p><p>参考情報<br>Microsoft Flow/PowerApps （Dynamics 365）の非表示について<br><a href="https://blogs.msdn.microsoft.com/jpsql/2016/11/21/microsoft-flowpowerapps-の非表示について/" target="_blank" rel="noopener">https://blogs.msdn.microsoft.com/jpsql/2016/11/21/microsoft-flowpowerapps-の非表示について/</a></p><p>How to remove Dynamics 365 app in applauncher<br><a href="https://answers.microsoft.com/en-us/msoffice/forum/msoffice_o365admin-mso_dep365/how-to-remove-dynamics-365-app-in-applauncher/712ecca2-0652-4beb-bb6b-d680d825d597?auth=1" target="_blank" rel="noopener">https://answers.microsoft.com/en-us/msoffice/forum/msoffice_o365admin-mso_dep365/how-to-remove-dynamics-365-app-in-applauncher/712ecca2-0652-4beb-bb6b-d680d825d597?auth=1</a></p><hr><h2 id="Skype-for-Business-関連"><a href="#Skype-for-Business-関連" class="headerlink" title="Skype for Business 関連"></a>Skype for Business 関連</h2><h3 id="Teams"><a href="#Teams" class="headerlink" title="Teams"></a>Teams</h3><p>Teams 製品については、Teams のライセンスを削除することで、タイルの非表示が可能です。</p><p>参考情報<br>はじめよう Microsoft Teams 第2回<br><a href="https://blogs.technet.microsoft.com/teamsjp/2017/09/27/start-teams-2/" target="_blank" rel="noopener">https://blogs.technet.microsoft.com/teamsjp/2017/09/27/start-teams-2/</a></p><hr><h2 id="その他"><a href="#その他" class="headerlink" title="その他"></a>その他</h2><h3 id="StaffHub、To-Do"><a href="#StaffHub、To-Do" class="headerlink" title="StaffHub、To-Do"></a>StaffHub、To-Do</h3><p>それぞれの製品ライセンスを削除することで、タイルの非表示が可能です。</p><p>参考情報<br>ユーザーのライセンス（サービスプラン）変更方法につきましては、下記のブログも合わせて参照ください。</p><p>Office 365 のライセンス管理<br><a href="https://blogs.technet.microsoft.com/exchangeteamjp/2018/04/02/office365-license-management/" target="_blank" rel="noopener">https://blogs.technet.microsoft.com/exchangeteamjp/2018/04/02/office365-license-management/</a></p><hr><p>今後も Office 365 サービスに関する有益な情報を発信してまいりますので、弊社サポート ブログをよろしくお願いいたします。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;こんにちは。いつも Office 365 を利用いただきまして、ありがとうございます。&lt;br&gt;今回は、Office 365 タイルの非表示方法について、ご紹介いたします。&lt;/p&gt;
&lt;p&gt;Office 365 ポータルにアクセスしますと、トップページやアプリランチャーに各サー
      
    
    </summary>
    
    
    
      <category term="O365Identity" scheme="https://jpmessaging.github.io/blog/tags/O365Identity/"/>
    
  </entry>
  
  <entry>
    <title>Office 365 のライセンス管理
</title>
    <link href="https://jpmessaging.github.io/blog/Office%20365%20%E3%81%AE%E3%83%A9%E3%82%A4%E3%82%BB%E3%83%B3%E3%82%B9%E7%AE%A1%E7%90%86/"/>
    <id>https://jpmessaging.github.io/blog/Office%20365%20%E3%81%AE%E3%83%A9%E3%82%A4%E3%82%BB%E3%83%B3%E3%82%B9%E7%AE%A1%E7%90%86/</id>
    <published>2018-04-01T15:00:00.000Z</published>
    <updated>2020-06-03T03:05:04.069Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。いつも Office 365 を利用いただきまして、ありがとうございます。<br>今回は、Office 365 のライセンス管理について、ご紹介いたします。</p><p>&nbsp;</p><p>Office 365 でユーザーにライセンスを付与するには、GUI（Office 365 管理センター）で操作する方法と、PowerShell で操作する方法があります。<br>少人数の作業であれば前者で問題ありませんが、ユーザーが多い場合や、スクリプトとして実行したいような場合は後者の方法が有効です。</p><p>&nbsp;</p><p>よくあるお問い合わせのシナリオに沿って、ライセンス管理の PowerShell コマンドをご案内いたします。<br>ライセンス名やサービスプランを変更することによって応用が可能です。</p><p>&nbsp;</p><h2 id="事前準備（必須）"><a href="#事前準備（必須）" class="headerlink" title="事前準備（必須）"></a>事前準備（必須）</h2><p>下記の作業は、どのシナリオにおいても共通です。</p><p>▼Office 365 に PowerShell 接続します。<br>下記の公開情報に従って Azure Active Directory の PowerShell モジュール（MSOnline）をインストールします。</p><p>Azure Active Directory の PowerShell モジュール<br><a href="https://blogs.technet.microsoft.com/jpazureid/2017/12/04/aad-powershell/" target="_blank" rel="noopener">https://blogs.technet.microsoft.com/jpazureid/2017/12/04/aad-powershell/</a></p><p>Office 365 PowerShell への接続<br><a href="https://docs.microsoft.com/ja-jp/office365/enterprise/powershell/connect-to-office-365-powershell" target="_blank" rel="noopener">https://docs.microsoft.com/ja-jp/office365/enterprise/powershell/connect-to-office-365-powershell</a></p><p>その後、Connect-MsolService コマンドを実行し、管理者権限で Office 365 に接続します。</p><p>▼Office 365 テナントに紐づくライセンスの情報を確認します。<br>Get-MsolAccountSku コマンドを実行し、ライセンスの AccountSkuId を確認します。</p><p>コマンド実行例：</p><table width="700" border="0"><tbody><tr><th><span style="color: #808080">AccountSkuId</span></th><th><span style="color: #808080">ActiveUnits</span></th><th><span style="color: #808080">WarningUnits</span></th><th><span style="color: #808080">ConsumedUnits</span></th><th></th></tr><tr><th><span style="color: #808080">------------</span></th><th><span style="color: #808080">-----------</span></th><th><span style="color: #808080">------------</span></th><th><span style="color: #808080">-------------</span></th><th></th></tr><tr><th><span style="color: #808080">contoso:STANDARDPACK</span></th><th><span style="color: #808080">100</span></th><th><span style="color: #808080">0</span></th><th><span style="color: #808080">10</span></th><th><span style="color: #808080">＜＜＜Office 365 Enterprise E1</span></th></tr><tr><th><span style="color: #808080">contoso:ENTERPRISEPACK</span></th><th><span style="color: #808080">100</span></th><th><span style="color: #808080">0</span></th><th><span style="color: #808080">10</span></th><th><span style="color: #808080">＜＜＜Office 365 Enterprise E3</span></th></tr><tr><th><span style="color: #808080">contoso:ENTERPRISEPREMIUM</span></th><th><span style="color: #808080">100</span></th><th><span style="color: #808080">0</span></th><th><span style="color: #808080">10</span></th><th><span style="color: #808080">＜＜＜Office 365 Enterprise E5</span></th></tr></tbody></table><strong>・・・</strong><p>▼ユーザーの UsageLocation を設定します。<br>ライセンスを割り当てるユーザーは、事前に UsageLocation が設定されている必要があります。設定されていない場合にはライセンス割り当てに失敗します。<br>そのため、はじめてライセンス割り当てを行うユーザーの場合は、事前に次のコマンドで UsageLocation を設定します。</p><p>下記のコマンドを実行し、特定のユーザーの UsageLocation を ”JP” に設定します。</p><p>Set-MsolUser -UserPrincipalName &lt;対象ユーザーの UPN&gt; -UsageLocation “JP”</p><p>下記のコマンドを実行し、csv ファイル（後述）に記載されたユーザーの UsageLocation を ”JP” に一括設定します。</p><p>  Import-Csv &lt;csv ファイル名&gt; | ForEach-Object {Set-MsolUser -UserPrincipalName $_.UserPrincipalName -UsageLocation “JP”}</p><p>- 参考情報<br>UsageLocation は、ISO 3166-1 alpha-2 (A2) の 2 文字の国/地域コードを指定します。<br><a href="https://www.iso.org/obp/ui/#search/code/" target="_blank" rel="noopener">https://www.iso.org/obp/ui/#search/code/</a></p><h2 id="事前準備（任意）"><a href="#事前準備（任意）" class="headerlink" title="事前準備（任意）"></a>事前準備（任意）</h4></h2><p>csv ファイルを使用してライセンスの一括割当・変更を行う場合は、下記を事前準備として実施ください。</p><p>▼全ユーザーの UserPrincipalName 一覧を csv ファイルに出力します。</p><p>Get-MsolUser -all | Select-Object UserPrincipalName | export-csv &lt;出力先の csv ファイル&gt; -Encoding UTF8 -NoTypeInformation</p><p>▼特定ライセンスが付与されているユーザーの UserPrincipalName 一覧を csv ファイルに出力します。</p><p>Get-MsolUser | where {$_.Licenses.AccountSkuID -contains “&lt;対象ライセンスの AccountSkuId&gt;”} | Select-Object UserPrincipalName | export-csv &lt;出力先の csv ファイル&gt; -Encoding UTF8 -NoTypeInformation</p><p>コマンド実行例：※E1 ライセンスが付与されているユーザーの一覧を c:\temp\users.csv ファイルに出力する場合</p><p><span style="color: #000000">Get-MsolUser | where {$_.Licenses.AccountSkuID -contains “contoso:STANDARDPACK”} | Select-Object UserPrincipalName | Export-Csv “C:\Temp\users.csv” -encoding UTF8 -NoTypeInformation</span></p><p>csv ファイルは、下記の形式で作成されます。<br>ライセンス割当・変更を行う対象ユーザーが事前に分かっている場合は、手動作成でも問題ありません。</p><hr><p>UserPrincipalName<br><a href="mailto:testuser01@contoso.onmicrosoft.com">testuser01@contoso.onmicrosoft.com</a><br><a href="mailto:testuser02@contoso.onmicrosoft.com">testuser02@contoso.onmicrosoft.com</a><br>・・・</p><hr><p>ユーザーにライセンスを付与する際、特定のサービスプランのみ有効化する場合は、下記を事前準備として実施ください。</p><p>▼作業対象ライセンスに含まれるサービスプランの情報を確認します。</p><p>(Get-MsolAccountSku | where {$_.AccountSkuId -eq “&lt;確認したいライセンスの AccountSkuId&gt;”}).ServiceStatus</p><p>コマンド実行例：　※Office 365 Enterprise E3 の場合（サービスプランは、2018/03/28 時点の情報です）</p><p>(Get-MsolAccountSku | where {$_.AccountSkuId -eq “contoso:ENTERPRISEPACK”}).ServiceStatus</p><p>&nbsp;</p><table width="699" border="0"><tbody><tr><th><span style="color: #808080">ServicePlan</span></th><th><span style="color: #808080">ProvisioningStatus</span></th></tr><tr><th><span style="color: #808080">-----------</span></th><th><span style="color: #808080">------------------</span></th></tr><tr><th><span style="color: #808080">RMS_S_ENTERPRISE</span></th><th><span style="color: #808080">Success ＜＜＜Azure Rights Management</span></th></tr><tr><th><span style="color: #808080">EXCHANGE_S_ENTERPRISE</span></th><th><span style="color: #808080">Success ＜＜＜Exchange Online (Plan 2)</span></th></tr><tr><th><span style="color: #808080">FLOW_O365_P2</span></th><th><span style="color: #808080">Success ＜＜＜Flow for Office 365 Plan 2</span></th></tr><tr><th><span style="color: #808080">FORMS_PLAN_E3</span></th><th><span style="color: #808080">Success ＜＜＜Microsoft Forms (Plan E3)</span></th></tr><tr><th><span style="color: #808080">PROJECTWORKMANAGEMENT</span></th><th><span style="color: #808080">Success ＜＜＜Microsoft Planner</span></th></tr><tr><th><span style="color: #808080">Deskless</span></th><th><span style="color: #808080">Success ＜＜＜Microsoft StaffHub</span></th></tr><tr><th><span style="color: #808080">STREAM_O365_E3</span></th><th><span style="color: #808080">Success ＜＜＜Microsoft Stream for O365 E3 SKU</span></th></tr><tr><th><span style="color: #808080">TEAMS1</span></th><th><span style="color: #808080">Success ＜＜＜Microsoft Teams</span></th></tr><tr><th><span style="color: #808080">INTUNE_O365/th&gt;</span></th><th><span style="color: #808080">Success ＜＜＜Mobile Device Management for Office 365</span></th></tr><tr><th><span style="color: #808080">OFFICESUBSCRIPTION</span></th><th><span style="color: #808080">Success ＜＜＜Office 365 ProPlus</span></th></tr><tr><th><span style="color: #808080">SHAREPOINTWAC</span></th><th><span style="color: #808080">Success ＜＜＜Office Online</span></th></tr><tr><th><span style="color: #808080">POWERAPPS_O365_P2</span></th><th><span style="color: #808080">Success ＜＜＜PowerApps for Office 365 Plan 2</span></th></tr><tr><th><span style="color: #808080">SHAREPOINTENTERPRISE</span></th><th><span style="color: #808080">Success ＜＜＜SharePoint Online (Plan 2)</span></th></tr><tr><th><span style="color: #808080">MCOSTANDARD</span></th><th><span style="color: #808080">Success ＜＜＜Skype for Business Online (Plan 2)</span></th></tr><tr><th><span style="color: #808080">SWAY</span></th><th><span style="color: #808080">Success ＜＜＜Sway</span></th></tr><tr><th><span style="color: #808080">BPOS_S_TODO_2</span></th><th><span style="color: #808080">Success ＜＜＜To-Do (Plan 2)</span></th></tr><tr><th><span style="color: #808080">YAMMER_ENTERPRISE</span></th><th><span style="color: #808080">Success ＜＜＜Yammer Enterprise</span></th></tr></tbody></table>&nbsp;<p>▼PowerShell 上で変数 disabledplans を作成し、無効とするサービス プランの情報を変数に格納します。<br>下記のコマンドを実行し、割り当てるライセンスのうち、無効にするサービスを指定し、変数 disabledplans に格納します。<br>$disabledplans = New-Object System.Collections.Generic.List[string]<br>$disabledplans.Add(“&lt;無効にする ServicePlan&gt;”)<br>$disabledplans.Add(“&lt;無効にする ServicePlan&gt;”)<br>・・・<br>$licenses = New-MsolLicenseOptions -AccountSkuId “&lt;割り当てるライセンスの AccountSkuId&gt;” -DisabledPlans $disabledplans</p><p>コマンド実行例：<br>※contoso:ENTERPRISEPACK ライセンスを割り当てる際に、Microsoft Teams、Sway、Yammer Enterprise を無効にする場合<br><span style="color: #000000">$disabledplans = New-Object System.Collections.Generic.List[string]<br>$disabledplans.Add(“TEAMS”)<br>$disabledplans.Add(“SWAY”)<br>$disabledplans.Add(“YAMMER_ENTERPRISE”)<br>$licenses = New-MsolLicenseOptions -AccountSkuId “contoso:ENTERPRISEPACK” -DisabledPlans $disabledplans</span></p><h2 id="シナリオ-A-新規ユーザーにライセンスを割り当てます。"><a href="#シナリオ-A-新規ユーザーにライセンスを割り当てます。" class="headerlink" title="シナリオ A. 新規ユーザーにライセンスを割り当てます。"></a>シナリオ A. 新規ユーザーにライセンスを割り当てます。</h2><p>▼特定のユーザーに対して、全てのサービスプランを有効化してライセンスを付与します。</p><p>Set-MsolUserLicense -UserPrincipalName &lt;UPN&gt; -AddLicenses “&lt;付与ライセンスの AccountSkuId&gt;”</p><p>▼csv ファイルで指定したユーザーに対して、一括で処理するには、下記のコマンドを実行します。</p><p>Import-Csv -Path &lt;csv ファイルのパス名&gt; | ForEach-Object {Set-MsolUserLicense -UserPrincipalName $_.UserPrincipalName -AddLicenses “&lt;付与ライセンスの AccountSkuId&gt;”}</p><p>▼一部のサービスのみ有効化してライセンスを付与します。</p><p>Set-MsolUserLicense -UserPrincipalName &lt;UPN&gt; -AddLicenses “&lt;付与ライセンスの AccountSkuId&gt;” -LicenseOptions $licenses</p><p>▼csv ファイルで指定したユーザーに対して、一括で処理するには、下記のコマンドを実行します。</p><p>Import-Csv -Path &lt;csv ファイルのパス名&gt; | ForEach-Object {Set-MsolUserLicense -UserPrincipalName $_.UserPrincipalName -AddLicenses “&lt;付与ライセンスの AccountSkuId&gt;” -LicenseOptions $licenses}</p><h2 id="シナリオ-B-ユーザーからライセンスを削除します。"><a href="#シナリオ-B-ユーザーからライセンスを削除します。" class="headerlink" title="シナリオ B. ユーザーからライセンスを削除します。"></a>シナリオ B. ユーザーからライセンスを削除します。</h2><p>▼特定のユーザーに対して、ライセンスを削除します。</p><p>Set-MsolUserLicense -UserPrincipalName &lt;UPN&gt; -RemoveLicenses &lt;”削除ライセンスの AccountSkuId”&gt;</p><p>▼csv ファイルで指定したユーザーに対して、一括で処理するには、下記のコマンドを実行します。</p><p>Import-Csv -Path &lt;csv ファイルのパス名&gt; | ForEach-Object {Set-MsolUserLicense -UserPrincipalName $_.UserPrincipalName -RemoveLicenses “&lt;削除ライセンスの AccountSkuId&gt;”}</p><h2 id="シナリオ-C-同一ライセンス内で、有効にするサービスプランを変更します。"><a href="#シナリオ-C-同一ライセンス内で、有効にするサービスプランを変更します。" class="headerlink" title="シナリオ C. 同一ライセンス内で、有効にするサービスプランを変更します。"></a>シナリオ C. 同一ライセンス内で、有効にするサービスプランを変更します。</h2><p>▼特定のユーザーに対して、サービスプランを変更します。　※AddLicenses オプションは使用しません。</p><p>Set-MsolUserLicense -UserPrincipalName &lt;UPN&gt; -LicenseOptions $licenses</p><p>▼csv ファイルで指定したユーザーに対して、一括で処理するには、下記のコマンドを実行します。</p><p>Import-Csv -Path &lt;csv ファイルのパス名&gt; | ForEach-Object {Set-MsolUserLicense -UserPrincipalName $_.UserPrincipalName -LicenseOptions $licenses}</p><h2 id="シナリオ-D-ライセンス変更を行います。"><a href="#シナリオ-D-ライセンス変更を行います。" class="headerlink" title="シナリオ D. ライセンス変更を行います。"></a>シナリオ D. ライセンス変更を行います。</h2><p>▼特定のユーザーに対して、ライセンス変更を行います（変更後は、全てのサービスプランを有効化）</p><p>Set-MsolUserLicense -UserPrincipalName &lt;UPN&gt; -RemoveLicenses “&lt;変更前の AccountSkuId&gt;” -AddLicenses “&lt;変更後の AccountSkuId&gt;”</p><p>▼csv ファイルで指定したユーザーに対して、一括で処理するには、下記のコマンドを実行します。</p><p>Import-Csv -Path &lt;csv ファイルのパス名&gt; | ForEach-Object {Set-MsolUserLicense -UserPrincipalName $_.UserPrincipalName -RemoveLicenses “&lt;変更前の AccountSkuId&gt;” -AddLicenses “&lt;変更後の AccountSkuId&gt;”}</p><p>▼特定のユーザーに対して、ライセンス変更を行います（変更後は、一部のサービスのみ有効化）</p><p>Set-MsolUserLicense -UserPrincipalName &lt;UPN&gt; -RemoveLicenses “&lt;変更前の AccountSkuId&gt;” -AddLicenses “&lt;変更後の AccountSkuId&gt;” -LicenseOptions $licenses</p><p>▼csv ファイルで指定したユーザーに対して、一括で処理するには、下記のコマンドを実行します。</p><p>Import-Csv -Path &lt;csv ファイルのパス名&gt; | ForEach-Object {Set-MsolUserLicense -UserPrincipalName $_.UserPrincipalName -RemoveLicenses “&lt;変更前の AccountSkuId&gt;” -AddLicenses “&lt;変更後の AccountSkuId&gt;” -LicenseOptions $licenses}</p><h2 id="事後確認"><a href="#事後確認" class="headerlink" title="事後確認"></a>事後確認</h2><p>▼作業対象ユーザーのライセンス付与状況を確認します。</p><p>Get-MsolUser -UserPrincipalName &lt;UPN&gt; | Select-Object -ExpandProperty Licenses</p><p>▼サービスプランまで確認するには、下記のコマンドを実行します。</p><p>Get-MsolUser -UserPrincipalName &lt;UPN&gt; | Select-Object -ExpandProperty Licenses | Select-Object -ExpandProperty ServiceStatus</p><p>ユーザーのライセンス保持状況を確認するには、[Office 365 管理センター] - [アクティブなユーザー] にて csv ファイルをエクスポートする方法が有効です。</p><p><a href="/blog/Export-Office365LicenseStatus%20のご紹介">サンプルスクリプト</a>も公開しておりますので、ご活用ください。</p><h2 id="参考情報"><a href="#参考情報" class="headerlink" title="参考情報"></a>参考情報</h2><p>Office 365 PowerShell を使用してライセンスをユーザー アカウントに割り当てる<br><a href="https://technet.microsoft.com/ja-jp/library/dn771770.aspx" target="_blank" rel="noopener">https://technet.microsoft.com/ja-jp/library/dn771770.aspx</a></p><p>Office 365 PowerShell を使ったサービスへのアクセスを無効にする<br><a href="https://technet.microsoft.com/ja-jp/library/dn771769.aspx" target="_blank" rel="noopener">https://technet.microsoft.com/ja-jp/library/dn771769.aspx</a></p><p>Windows PowerShell コマンドでの新規ユーザー一括作成手順 (ライセンス付与、パスワード同時設定)<br><a href="https://answers.microsoft.com/ja-jp/msoffice/forum/msoffice_o365admin-mso_manage/windows-powershell/b0dbbafd-ec0d-401f-9d88-b6b4fc72f6f6" target="_blank" rel="noopener">https://answers.microsoft.com/ja-jp/msoffice/forum/msoffice_o365admin-mso_manage/windows-powershell/b0dbbafd-ec0d-401f-9d88-b6b4fc72f6f6</a></p><p>今後も Office 365 サービスに関する有益な情報を発信してまいりますので、弊社サポート ブログをよろしくお願いいたします。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;こんにちは。いつも Office 365 を利用いただきまして、ありがとうございます。&lt;br&gt;今回は、Office 365 のライセンス管理について、ご紹介いたします。&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;p&gt;Office 365 でユーザーにライセンスを付与するには、G
      
    
    </summary>
    
    
    
      <category term="O365Identity" scheme="https://jpmessaging.github.io/blog/tags/O365Identity/"/>
    
  </entry>
  
  <entry>
    <title>コネクタ設定における 3 つのポイント (送信元  組織のメール サーバー)
</title>
    <link href="https://jpmessaging.github.io/blog/%E3%82%B3%E3%83%8D%E3%82%AF%E3%82%BF%E8%A8%AD%E5%AE%9A%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8B%203%20%E3%81%A4%E3%81%AE%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88%20(%E9%80%81%E4%BF%A1%E5%85%83%20%20%E7%B5%84%E7%B9%94%E3%81%AE%E3%83%A1%E3%83%BC%E3%83%AB%20%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC)/"/>
    <id>https://jpmessaging.github.io/blog/%E3%82%B3%E3%83%8D%E3%82%AF%E3%82%BF%E8%A8%AD%E5%AE%9A%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8B%203%20%E3%81%A4%E3%81%AE%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88%20(%E9%80%81%E4%BF%A1%E5%85%83%20%20%E7%B5%84%E7%B9%94%E3%81%AE%E3%83%A1%E3%83%BC%E3%83%AB%20%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC)/</id>
    <published>2017-12-06T15:00:00.000Z</published>
    <updated>2020-06-03T03:05:04.077Z</updated>
    
    <content type="html"><![CDATA[<p>今回は Exchange Online のメール フローにおいて、お客様からしばしばお問い合わせをいただいておりますオンプレミスのサーバー向けにコネクタ設定を行う際の注意点をお伝えします。</p><p>Exchange Online は特定の送信元 IP から急激なメール受信量の増加を検知すると、サービスを保護するために当該 IP からのメール受信を自動的に制限し、遅延受信させます。<br>これは以下の blog でご案内の IP スロットリングの機能ですが、この特定の IP がお客様にて運用されている問題のないサーバーである場合には本機能の動作は不要であり、回避するためには送信元を組織のメール サーバー、送信先を Office 365 とするコネクタの設定が有効です。<br>&nbsp;<br>Title: IP スロットリングについて<br>URL: <a href="https://blogs.technet.microsoft.com/exchangeteamjp/2015/03/23/ip/" target="_blank" rel="noopener">https://blogs.technet.microsoft.com/exchangeteamjp/2015/03/23/ip/</a><br>&nbsp;<br>送信元を組織のメール サーバーとするコネクタを設定すると、特定の送信元サーバーからのメールをコネクタが作成されている Office 365 テナントへメールをルーティングする動作となります。<br>このようなコネクタを作成するときには以下の点について予めご留意いただきますようお願い申し上げます。</p><p>&nbsp;<br><u><strong>&lt;&lt; Point 1 &gt;&gt; 他テナント宛てのメールも自テナントで受信する</strong></u><br>前述のようにコネクタを作成することで対象となるメール サーバーから送信されたメールを Office 365 が受信すると、コネクタのあるテナントへまずメールをルーティングします (後述の Point 2 および 3 でご案内の、コネクタが使用される条件を満たしていることが前提となります)。<br>そのため、宛先が別の Office 365 テナントのメール (別のお客様にご登録いただいているドメインを含むメール) である場合にも、コネクタのあるテナントでまず受信します。<br>その後、実際に宛先ドメインが登録されているテナントへメールが中継されます。<br>これは特別なことではなく、組織のメール サーバーからのメールを受信するように設定されたコネクタが適切に動作した結果です。</p><p>そこで注意が必要となるのは、Exchange Online には各テナントごとにメール フローのルール設定 (トランスポート ルール) を行うことができるため、例えば自テナントに登録されていないドメイン宛てのメールはブロックするような設定を行っていると、組織のメール サーバーから他テナント宛てのメールも最終的にブロックされ届かない問題が起きます。<br>コネクタを設定する際は組織のメール サーバーからのメールは一度、自テナントにて受信し他テナントへ中継される動作となることにご注意ください。</p><p>&nbsp;<br><u><strong>&lt;&lt; Point 2 &gt;&gt; 証明書ベースのコネクタが効かない場合がある</strong></u><br>組織のメール サーバーを送信元とするコネクタには、送信元を識別する方法として送信元メール サーバーが提示する証明書のサブジェクト名 (別名) または送信元 IP アドレスを選ぶことができます。<br>弊社としては前者の証明書ベースのコネクタを推奨しております。これは以下の Web サイトでご案内のように後者の IP アドレス ベースのコネクタの場合には Office 365 がメールの中継を拒否する場合があるためです。<br>&nbsp;<br> Title: Office 365 の電子メールでコネクタを構成しているお客様への重要なお知らせ<br>  URL: <a href="https://support.microsoft.com/ja-jp/help/3169958/important-notice-for-office-365-email-customers-who-have-configured-co" target="_blank" rel="noopener">https://support.microsoft.com/ja-jp/help/3169958/important-notice-for-office-365-email-customers-who-have-configured-co</a><br>&nbsp;<br>Office 365 は外部からメールを受信すると、全テナントのコネクタに設定されている証明書のサブジェクト名と、送信元メール サーバーが提示した証明書のサブジェクト名 (別名) を照らし合わせ、合致するコネクタを抽出します。<br>合致するコネクタがあると、そのコネクタに設定されているサブジェクト名がそもそもコネクタのあるテナントに登録されているドメインであるかチェックします (※ 1)。<br>証明書のサブジェクト名がテナントに登録されていないドメインである場合は、代わりに送信者 (差出人) もしくは受信者のメール ドメインがテナントに登録されているドメインかをチェックします。<br>チェックを通過したメールはコネクタ設定のあるテナントへルーティングされます。</p><p>(※ 1) ワイルドカードも考慮されるため、例えばコネクタの設定が *.contoso.com であり、テナントに登録されているドメインが contoso.com や jpn.contoso.com といった場合も有効です。</p><p>コネクタのサブジェクト名と証明書のサブジェクト名だけを合わせテナントに登録されているドメインとは合致しない場合には、送信者 (差出人) または受信者のメール ドメインも登録されていないドメインであると、コネクタが使用されないことをご注意ください。</p><p>この点につきましては、下記 TechNet でもご案内しております。<br>&nbsp;<br>Title: Office 365 と独自の電子メール サーバーの間のメールをルーティングするようにコネクタを設定する<br>URL: <a href="https://technet.microsoft.com/ja-jp/library/dn751020(v=exchg.150).aspx" target="_blank" rel="noopener">https://technet.microsoft.com/ja-jp/library/dn751020(v=exchg.150).aspx</a></p><ul><li>パート 1:Office 365 から電子メール サーバーにメールが流れるように構成する (該当箇所を以下に抜粋)<br>Office 365 の承認済みドメインと一致するサブジェクト名で構成されている証明書を使用する。証明書の共通名、またはサブジェクトの別名を組織のプライマリ SMTP ドメインと一致させることをお勧めします。</li></ul><p>&nbsp;<br><u><strong>&lt;&lt; Point 3 &gt;&gt; コネクタがあってもメールが届かない場合がある</strong></u><br>送信元を組織のメール サーバーとするコネクタを設定すると、これまで述べてきたようにコネクタのあるテナントでまずメールを受信します。<br>証明書ベースのコネクタの場合には、Point 2 でご案内の動作により証明書のサブジェクト名 (別名)、コネクタのサブジェクト名、テナントのドメインの 3 つの条件にすべて合致することで、送受信者のメール ドメインがテナントのドメインに登録されていない場合にも有効にコネクタが動作することを説明しました。</p><p>一方、IP アドレス ベースのコネクタの場合には証明書のサブジェクト名による情報がないため、全テナントから送信元 IP の設定と合致するコネクタが抽出された後、送信者 (差出人) または受信者のメール ドメインがコネクタのあるテナントに登録されているドメインかどうかのみチェックされます。</p><p>ここで注意が必要となるのが、送信者 (差出人) のドメインがテナントに登録されていないケースです。<br>その場合は受信者のメール ドメインがコネクタのあるテナントに登録されているドメインかどうかがチェックされますが、送信元メール サーバーが単一の SMTP セッションの中で複数のメール ドメインを受信者として送信 (※ 2) すると、Office 365 はどのドメインをコネクタの検証用に使用すればよいか判断できず中継が拒否されます。</p><p>本記事執筆時点 (2017 年 12 月 6 日) では、複数の宛先メール ドメインが、同じコネクタのあるテナントにいずれも登録されており複数テナントにまたがっていなかったとしても中継が拒否されることをご注意ください。</p><p>(※ 2) 例えば以下のように RCPT TO コマンドで複数のメール ドメインが受信者として指定される場合です。<br>MAIL FROM: <a href="mailto:user01@contoso.com">user01@contoso.com</a><br>RCPT TO: <a href="mailto:user01@adatum.com">user01@adatum.com</a><br>RCPT TO: <a href="mailto:user01@fabrikam.com">user01@fabrikam.com</a></p><p>&nbsp;<br>今回のご案内は以上となります。<br>Office 365 とお客様のメール サーバーとを円滑にご連携いただく際の注意点としてお役に立てていただけますと幸いです。<br>&nbsp;<br>※本情報の内容は作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;今回は Exchange Online のメール フローにおいて、お客様からしばしばお問い合わせをいただいておりますオンプレミスのサーバー向けにコネクタ設定を行う際の注意点をお伝えします。&lt;/p&gt;
&lt;p&gt;Exchange Online は特定の送信元 IP から急激なメール
      
    
    </summary>
    
    
    
      <category term="EXO" scheme="https://jpmessaging.github.io/blog/tags/EXO/"/>
    
  </entry>
  
  <entry>
    <title>Office 365 グループの制御方法について
</title>
    <link href="https://jpmessaging.github.io/blog/Office%20365%20%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%AE%E5%88%B6%E5%BE%A1%E6%96%B9%E6%B3%95%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6/"/>
    <id>https://jpmessaging.github.io/blog/Office%20365%20%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%AE%E5%88%B6%E5%BE%A1%E6%96%B9%E6%B3%95%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6/</id>
    <published>2017-10-02T15:00:00.000Z</published>
    <updated>2020-06-03T03:05:04.072Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。いつも Office 365 を利用いただきまして、ありがとうございます。<br>今回は、Office 365 グループの制御方法について、ご紹介いたします。</p><p>&nbsp;</p><p><u><strong><span style="font-size: x-large">Offce365 グループとは</span></strong></u><br>Office 365 グループは、社内外のメンバーと予定を共有したり、SharePoint Online 上のドキュメントを共有したり、共同作業を行うのに大変便利な機能です。</p><p>Office 365 グループの概要<br><a href="https://support.office.com/ja-jp/article/b565caa1-5c40-40ef-9915-60fdb2d97fa2" target="_blank" rel="noopener">https://support.office.com/ja-jp/article/b565caa1-5c40-40ef-9915-60fdb2d97fa2</a><br>※Office 365 グループを使用するには、Exchange Online（Plan 1 以上）のサービスを含むサブスクリプションがテナントにて有効になっている必要があります。</p><p>Office 365 グループに関する設定の既定値は下記の通りです。<br>a. 一般ユーザーであっても、Offce365 グループを作成可能<br>b. 一般ユーザーであっても、グループ保有者となり Offce365 グループにゲストユーザーを追加可能<br>c. ゲストユーザーは、招待された Office 365 グループのリソースにアクセス可能</p><p>&nbsp;</p><p><u><strong><span style="font-size: x-large">便利だからこその懸念点</span></strong></u><br>一般ユーザーの自由度が高いため、Office 365 のテナント管理者（情報システム部門など）としては、下記のような点を懸念するというお問い合わせを多くいただきます。</p><p>a. テナント管理者が知らないところで、Office 365 グループが作成される<br>&gt; Office 365 グループは、Outlook / Teams 等から簡単に作成することが可能です。<br>ユーザーが作成したグループは、使用が終了しても削除されずに残るため、テナント管理者が把握していないグループが増えることになります。<br>※定期的に棚卸している環境であれば問題ないと思います。</p><p>b. テナント管理者が知らないところで、ゲストユーザーが追加される<br>&gt; Office 365 グループにゲストユーザーを追加・招待しますと、テナント管理者が把握していない下記のようなゲストユーザーが追加されます。<br>例：<u>testuser_outlook.jp#EXT#@contoso.onmicrosoft.com</u><br>※こちらも、定期的に棚卸している環境であれば問題ないと思います。</p><p>c. テナント管理者が知らないところで追加されたゲストユーザーが、当該 Office 365 テナントのリソースにアクセス可能となる<br>&gt; ゲストユーザーが社内のリソースに自由にアクセス可能となることをセキュリティの問題を懸念されるお客様が多くいらっしゃいます。</p><p>&nbsp;</p><p><u><strong><span style="font-size: x-large">各シナリオの制御方法</span></strong></u><br>それぞれのシナリオについて、制御方法をご案内いたします。<br>各作業を行うには、Azure AD PowerShell V2 Preview のバージョン 2.0.0.137 以上をインストールする必要があります。<br>公開情報の中にインストール手順も記載していますので、合わせてご確認ください。</p><p><strong>a. Office 365 グループの作成を制御する</strong><br>テナント全体で Office 365 グループの作成ができないように設定する方法は、下記の通りです。</p><p>Office 365 グループを作成できるユーザーを管理します。<br><a href="https://support.office.com/ja-jp/article/4c46c8cb-17d0-44b5-9776-005fced8e618" target="_blank" rel="noopener">https://support.office.com/ja-jp/article/4c46c8cb-17d0-44b5-9776-005fced8e618</a><br><span style="color: #ff0000"><br></span></p><p>この設定を行いますと、(Get-AzureADDirectorySetting).values コマンド結果で EnableGroupCreation：False となります。</p><p>コマンド実行例：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">(Get-AzureADDirectorySetting).Values</span><br><span class="line"></span><br><span class="line">Name Value</span><br><span class="line">---- -----</span><br><span class="line">CustomBlockedWordsList</span><br><span class="line">EnableMSStandardBlockedWords False</span><br><span class="line">ClassificationDescriptions</span><br><span class="line">DefaultClassification</span><br><span class="line">PrefixSuffixNamingRequirement</span><br><span class="line">AllowGuestsToBeGroupOwner False</span><br><span class="line">AllowGuestsToAccessGroups True</span><br><span class="line">GuestUsageGuidelinesUrl</span><br><span class="line">GroupCreationAllowedGroupId</span><br><span class="line">AllowToAddGuests True</span><br><span class="line">UsageGuidelinesUrl</span><br><span class="line">ClassificationList</span><br><span class="line">EnableGroupCreation False　&lt;&lt;&lt; テナント全体で Office 365 グループの作成を禁止。</span><br></pre></td></tr></table></figure><p>特定のセキュリティ グループに所属しているユーザーのみ、Office 365 グループを作成できるように設定することも可能です。<br>この設定を行いますと、(Get-AzureADDirectorySetting).values コマンド結果で EnableGroupCreation：False / GroupCreationAllowedGroupId：＜対象グループの objected＞となります。</p><p>※ 特定のグループのみ Office 365 グループの作成を許可する場合、作業者の全体管理者および対象グループに所属しているユーザーに対して Azure AD Premium P1 以上のライセンスが必要です。</p><p>コマンド実行例：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">(Get-AzureADDirectorySetting).Values</span><br><span class="line"></span><br><span class="line">Name Value</span><br><span class="line">---- -----</span><br><span class="line">CustomBlockedWordsList</span><br><span class="line">EnableMSStandardBlockedWords False</span><br><span class="line">ClassificationDescriptions</span><br><span class="line">DefaultClassification</span><br><span class="line">PrefixSuffixNamingRequirement</span><br><span class="line">AllowGuestsToBeGroupOwner False</span><br><span class="line">AllowGuestsToAccessGroups True</span><br><span class="line">GuestUsageGuidelinesUrl</span><br><span class="line">GroupCreationAllowedGroupId 98be3e95-aac6-XXXX　&lt;&lt;&lt; このグループだけはグループ作成を許可。</span><br><span class="line">AllowToAddGuests True</span><br><span class="line">UsageGuidelinesUrl</span><br><span class="line">ClassificationList</span><br><span class="line">EnableGroupCreation False　&lt;&lt;&lt; テナント全体で Office 365 グループの作成を禁止。</span><br></pre></td></tr></table></figure><p>SharePoint / Yammer チームの Blog でも詳細な手順を記載していますので、合わせてご参照ください。</p><p>SharePoint Online/OneDrive for Business で Office 365 グループの作成を制限する<br><a href="https://blogs.technet.microsoft.com/sharepoint_support/2017/06/02/spo-odb-restrict-365group/" target="_blank" rel="noopener">https://blogs.technet.microsoft.com/sharepoint_support/2017/06/02/spo-odb-restrict-365group/</a></p><p>Yammer グループと Office 365 グループの統合について (V2)<br><a href="https://blogs.technet.microsoft.com/sharepoint_support/2017/04/06/manage-yammer-suite-connected-office-365-group-creation-v2/" target="_blank" rel="noopener">https://blogs.technet.microsoft.com/sharepoint_support/2017/04/06/manage-yammer-suite-connected-office-365-group-creation-v2/</a></p><p><strong>b. Offce365 グループへのゲストユーザー追加を制御する</strong><br>Offce365 グループの所有者がゲストユーザー追加できないようにするには、[Office 365 管理センター] – [サービスとアドイン] – [Office 365 グループ] にて下記のオプションを「オフ」に設定します。</p><a href="media/2017/10/2017100301.jpg"><p><img src="2017100301.jpg" alt=""><br></a></p><p>この設定を行いますと、(Get-AzureADDirectorySetting).values コマンド結果で AllowToAddGuests：False となります。</p><p>コマンド実行例：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">(Get-AzureADDirectorySetting).Values</span><br><span class="line"></span><br><span class="line">Name Value</span><br><span class="line">---- -----</span><br><span class="line">CustomBlockedWordsList</span><br><span class="line">EnableMSStandardBlockedWords False</span><br><span class="line">ClassificationDescriptions</span><br><span class="line">DefaultClassification</span><br><span class="line">PrefixSuffixNamingRequirement</span><br><span class="line">AllowGuestsToBeGroupOwner False</span><br><span class="line">AllowGuestsToAccessGroups True</span><br><span class="line">GuestUsageGuidelinesUrl</span><br><span class="line">GroupCreationAllowedGroupId</span><br><span class="line">AllowToAddGuests False　&lt;&lt;&lt; ゲストユーザーの追加を禁止。</span><br><span class="line">UsageGuidelinesUrl</span><br><span class="line">ClassificationList</span><br><span class="line">EnableGroupCreation True</span><br></pre></td></tr></table></figure><p>特定のグループのみゲストユーザーの追加を許可 / 拒否する方法は、下記の通りです。</p><p>Office 365 グループのゲスト アクセス<br><a href="https://support.office.com/ja-jp/article/bfc7a840-868f-4fd6-a390-f347bf51aff6#PickTab=管理" target="_blank" rel="noopener">https://support.office.com/ja-jp/article/bfc7a840-868f-4fd6-a390-f347bf51aff6#PickTab=管理</a><br>PowerShell を使用してゲスト アクセスを制御する<br>特定のグループからのゲスト ユーザーを許可またはブロックする</p><p>&nbsp;</p><p>※本機能の使用するには、テナント全体では Office 365 グループへのゲストユーザー追加を有効にし、特定のグループのみゲストユーザーの追加を拒否する設定とします。<br>・テナント全体<br>AllowToAddGuests：True<br>・特定グループ<br>AllowToAddGuests：False</p><p>&nbsp;</p><p><strong>c. ゲストユーザーによるリソースのアクセスを制御する</strong><br>ゲストユーザーが Office 365 グループのリソースにアクセスできないようにするには、[Office 365 管理センター] – [サービスとアドイン] – [Office 365 グループ] にて下記のオプションを「オフ」に設定します。</p><a href="media/2017/10/2017100302.jpg"><p><img src="2017100302.jpg" alt=""><br></a></p><p>この設定を行いますと、(Get-AzureADDirectorySetting).values コマンド結果で AllowGuestsToAccessGroups：False となります。</p><p>コマンド実行例：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">(Get-AzureADDirectorySetting).Values</span><br><span class="line"></span><br><span class="line">Name Value</span><br><span class="line">---- -----</span><br><span class="line">CustomBlockedWordsList</span><br><span class="line">EnableMSStandardBlockedWords False</span><br><span class="line">ClassificationDescriptions</span><br><span class="line">DefaultClassification</span><br><span class="line">PrefixSuffixNamingRequirement</span><br><span class="line">AllowGuestsToBeGroupOwner False</span><br><span class="line">AllowGuestsToAccessGroups False　&lt;&lt;&lt; ゲストユーザーからのアクセスを禁止。</span><br><span class="line">GuestUsageGuidelinesUrl</span><br><span class="line">GroupCreationAllowedGroupId</span><br><span class="line">AllowToAddGuests True</span><br><span class="line">UsageGuidelinesUrl</span><br><span class="line">ClassificationList</span><br><span class="line">EnableGroupCreation True</span><br></pre></td></tr></table></figure><p>&nbsp;</p><p>今後も Office 365 サービスに関する有益な情報を発信してまいりますので、弊社サポート ブログをよろしくお願いいたします。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;こんにちは。いつも Office 365 を利用いただきまして、ありがとうございます。&lt;br&gt;今回は、Office 365 グループの制御方法について、ご紹介いたします。&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;p&gt;&lt;u&gt;&lt;strong&gt;&lt;span style=&quot;font-s
      
    
    </summary>
    
    
    
      <category term="O365Identity" scheme="https://jpmessaging.github.io/blog/tags/O365Identity/"/>
    
  </entry>
  
  <entry>
    <title>セルフサービス サインアップで登録されたドメインの対処方法
</title>
    <link href="https://jpmessaging.github.io/blog/%E3%82%BB%E3%83%AB%E3%83%95%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%20%E3%82%B5%E3%82%A4%E3%83%B3%E3%82%A2%E3%83%83%E3%83%97%E3%81%A7%E7%99%BB%E9%8C%B2%E3%81%95%E3%82%8C%E3%81%9F%E3%83%89%E3%83%A1%E3%82%A4%E3%83%B3%E3%81%AE%E5%AF%BE%E5%87%A6%E6%96%B9%E6%B3%95/"/>
    <id>https://jpmessaging.github.io/blog/%E3%82%BB%E3%83%AB%E3%83%95%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%20%E3%82%B5%E3%82%A4%E3%83%B3%E3%82%A2%E3%83%83%E3%83%97%E3%81%A7%E7%99%BB%E9%8C%B2%E3%81%95%E3%82%8C%E3%81%9F%E3%83%89%E3%83%A1%E3%82%A4%E3%83%B3%E3%81%AE%E5%AF%BE%E5%87%A6%E6%96%B9%E6%B3%95/</id>
    <published>2017-09-26T15:00:00.000Z</published>
    <updated>2020-06-03T03:05:04.077Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。いつも Office 365 を利用いただきまして、ありがとうございます。</p><p>Office 365 にカスタムドメイン登録しようとしたときに、「ワンポイント アドバイス」といったメッセージが表示されることがあります。<br>多くのお客様よりお問い合わせをいただきますので、今回は、このときの対象方法についてご紹介いたします。<br>※画面は、2017 年 9 月時点のものです。</p><a href="media/2017/09/2017092701.jpg"><p><img src="2017092701.jpg" alt=""><br></a></p><p>&nbsp;</p><p><u><strong>原因</strong></u><br>上記メッセージが表示される場合、登録しようとしているドメインのメールアドレスを使用しているユーザーによって、<br>「セルフサービス サインアップ」が実施されたことにより、管理者が不在の Office 365 テナント（非管理テナント）が存在している状況となります。</p><p>セルフサービス サインアップ（Self Service Sign-up）とは、ユーザーがクラウド サービスを使用するためにメールアドレスを入力してサインアップすることができ、<br>電子メール ドメインに基づいたユーザー ID が、そのドメインに紐づく Office 365 テナントにて自動作成される機能です。<br>当該機能および対応している Office 365 サービスについて記述している公開情報がございますので、下記にご紹介いたします。</p><p>Azure のセルフサービス サインアップについて<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/active-directory-self-service-signup" target="_blank" rel="noopener">https://docs.microsoft.com/ja-jp/azure/active-directory/active-directory-self-service-signup</a></p><p>組織でのセルフサービス サインアップの使用<br><a href="https://support.office.com/ja-jp/article/4f8712ff-9346-4c6c-bb63-a21ad7a62cbd" target="_blank" rel="noopener">https://support.office.com/ja-jp/article/4f8712ff-9346-4c6c-bb63-a21ad7a62cbd</a></p><p>&nbsp;</p><p><u><strong>対処方法</strong></u><br>「セルフサービス サインアップ」によって作成された非管理テナントからドメインを切り離し、管理テナントに登録し直す必要があります。<br>具体的には下記の作業を行います。<br>（作業ドメイン：test.work、非管理テナント：testwork.onmicrosoft.com、管理テナント：contoso.onmicrosoft.com とします）</p><p>&nbsp;</p><ol><li>test.work のメールアドレスを使用しているユーザー（<a href="mailto:admin@test.work">admin@test.work</a>）を使用して、セルフサービス サインアップを行います。</li></ol><p>個人として Power BI にサインアップする<br><a href="https://powerbi.microsoft.com/ja-jp/documentation/powerbi-service-self-service-signup-for-power-bi/" target="_blank" rel="noopener">https://powerbi.microsoft.com/ja-jp/documentation/powerbi-service-self-service-signup-for-power-bi/</a><br>&gt; こちらは、PoweBI にセルフサービス サインアップする手順になりますが、対応しているサービスであれば、どれでも問題ありません。</p><a href="media/2017/09/2017092702.jpg"><p><img src="2017092702.jpg" alt=""><br></a></p><p>&nbsp;</p><ol start="2"><li>PoweBI の画面にて左上のワッフル メニューをクリックし、「Admin」をクリックします。</li></ol><a href="media/2017/09/2017092703.jpg"><p><img src="2017092703.jpg" alt=""><br></a></p><p>&nbsp;</p><ol start="3"><li>「管理者になる」メニューを実行します。　※途中、TXT もしくは MX レコードによるドメインの所有確認が必要です。</li></ol><a href="media/2017/09/2017092704.png"><p><img src="2017092704.png" alt=""><br></a></p><p>&nbsp;</p><ol start="4"><li>Office 365 管理センターにて、新規の全体管理者（admin@<span style="float: none;background-color: transparent;color: #333333;cursor: text;font-family: Georgia,'Times New Roman','Bitstream Charter',Times,serif;font-size: 16px;font-style: normal;font-variant: normal;font-weight: 400;letter-spacing: normal;line-height: 24px;text-align: left;text-decoration: none;text-indent: 0px">testwork.onmicrosoft.com</span>）を作成します。</li></ol><p>Office 365 にユーザーを個別に、またはまとめて追加する - 管理者向けヘルプ<br><a href="https://support.office.com/ja-jp/article/1970f7d6-03b5-442f-b385-5880b9c256ec" target="_blank" rel="noopener">https://support.office.com/ja-jp/article/1970f7d6-03b5-442f-b385-5880b9c256ec</a></p><p>&nbsp;</p><ol start="5"><li>登録済のユーザーを確認し、UPN を @test.work から @testwork.onmicrosoft.com に変更もしくは、ユーザーの削除を行います。</li></ol><p>※UPN を変更するには、<a href="mailto:admin@testwork.onmicrosoft.com">admin@testwork.onmicrosoft.com</a> ユーザーにて Office 365 へ PowerShell 接続し、<br>下記のコマンドを実行します。<br>Set-MsolUserPrincipalName -UserPrincipalName <a href="mailto:username@test.work">username@test.work</a> -NewUserPrincipalName <a href="mailto:username@testwork.onmicrosoft.com">username@testwork.onmicrosoft.com</a></p><ul><li>参考情報<br>Office 365 PowerShell への接続<br><a href="https://docs.microsoft.com/ja-jp/office365/enterprise/powershell/connect-to-office-365-powershell" target="_blank" rel="noopener">https://docs.microsoft.com/ja-jp/office365/enterprise/powershell/connect-to-office-365-powershell</a></li></ul><p>&nbsp;</p><ol start="6"><li>非管理テナント：testwork.onmicrosoft.com に紐づくドメインを削除します。</li></ol><p>Office 365 からドメインを削除する<br><a href="https://support.office.com/ja-jp/article/f09696b2-8c29-4588-a08b-b333da19810c" target="_blank" rel="noopener">https://support.office.com/ja-jp/article/f09696b2-8c29-4588-a08b-b333da19810c</a></p><p>&nbsp;</p><ol start="7"><li>管理テナント：contoso.onmicrosoft.com に <span style="float: none;background-color: transparent;color: #333333;cursor: text;font-family: Georgia,'Times New Roman','Bitstream Charter',Times,serif;font-size: 16px;font-style: normal;font-variant: normal;font-weight: 400;letter-spacing: normal;line-height: 24px;text-align: left;text-decoration: none;text-indent: 0px">test.work </span>ドメインを登録します。</li></ol><p>Office 365 に複数のドメインを追加する<br><a href="https://support.office.com/ja-jp/article/2d2fa996-b760-411d-a5cc-190d63f13207" target="_blank" rel="noopener">https://support.office.com/ja-jp/article/2d2fa996-b760-411d-a5cc-190d63f13207</a></p><p>&nbsp;</p><p>今後も Office 365 サービスに関する有益な情報を発信してまいりますので、弊社サポート ブログをよろしくお願いいたします。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;こんにちは。いつも Office 365 を利用いただきまして、ありがとうございます。&lt;/p&gt;
&lt;p&gt;Office 365 にカスタムドメイン登録しようとしたときに、「ワンポイント アドバイス」といったメッセージが表示されることがあります。&lt;br&gt;多くのお客様よりお問い合わ
      
    
    </summary>
    
    
    
      <category term="O365Identity" scheme="https://jpmessaging.github.io/blog/tags/O365Identity/"/>
    
  </entry>
  
  <entry>
    <title>マルウェア検体の提出方法の変更のお知らせ
</title>
    <link href="https://jpmessaging.github.io/blog/%E3%83%9E%E3%83%AB%E3%82%A6%E3%82%A7%E3%82%A2%E6%A4%9C%E4%BD%93%E3%81%AE%E6%8F%90%E5%87%BA%E6%96%B9%E6%B3%95%E3%81%AE%E5%A4%89%E6%9B%B4%E3%81%AE%E3%81%8A%E7%9F%A5%E3%82%89%E3%81%9B/"/>
    <id>https://jpmessaging.github.io/blog/%E3%83%9E%E3%83%AB%E3%82%A6%E3%82%A7%E3%82%A2%E6%A4%9C%E4%BD%93%E3%81%AE%E6%8F%90%E5%87%BA%E6%96%B9%E6%B3%95%E3%81%AE%E5%A4%89%E6%9B%B4%E3%81%AE%E3%81%8A%E7%9F%A5%E3%82%89%E3%81%9B/</id>
    <published>2017-09-04T15:00:00.000Z</published>
    <updated>2020-06-03T03:05:04.082Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Exchange Server サポートの渡辺です。<br>今回は Exchange Online におけるマルウェア検体のご提供手順に変更がございましたので、ご紹介させていただきます。</p><p>これまで Exchange Online でマルウェアの可能性があるメールを受信した場合や、逆にマルウェアでは無いにも関わらずマルウェアとして判定されてしまった場合には、以下のブログでもご紹介しております Microsoft Malware Protection Center (MMPC) より、検体をご提出いただいておりました。</p><p>   Title : Exchange Online でマルウェアを受信した場合の対策について<br>   URL : <a href="https://blogs.technet.microsoft.com/exchangeteamjp/2015/11/16/exchange-online-7/" target="_blank" rel="noopener">https://blogs.technet.microsoft.com/exchangeteamjp/2015/11/16/exchange-online-7/</a></p><p>しかしながら、先月よりマルウェアの検体提出については、MMPC ではなく Windows Defender Security Intelligence を利用する形に変更されており、ご提供いただく際の手順等も変更されております。<br>基本的には入力いただく内容に大きな変更はございませんが、以下にご提供いただく際の手順をお纏めしておりますので、ご提供いただく際の参考としていただけますと幸いです。<br>&nbsp;<br>Windows Defender Security Intelligence でマルウェアのサンプルを提出する手順<br>=====================================</p><ol><li>以下の URL にアクセスします。</li></ol><p>&nbsp;&nbsp;<a href="https://www.microsoft.com/en-us/wdsi/filesubmission" target="_blank" rel="noopener">https://www.microsoft.com/en-us/wdsi/filesubmission</a></p><ol start="2"><li><p>検体をご提出いただくユーザーの種類を選択し、”Continue” をクリックします。<br>&nbsp;&nbsp;プライベートでご利用されているお客様 : Home customer<br>&nbsp;&nbsp;ビジネスでご利用されているお客様 : Enterprise customer<br>&nbsp;&nbsp;自社製品の開発等で検証を実施されたいお客様 : Software developer</p></li><li><p>Microsoft アカウントでログインします。</p></li><li><p>必要事項を入力し、”Continue” をクリックします。<br>&nbsp;&nbsp;基本的な入力項目は以下となりますので、ご参考ください。<br>&nbsp;&nbsp;※ (*) は入力必須の項目です</p></li></ol><p>&nbsp;&nbsp;Company Name (*) :<br>&nbsp;&nbsp;&nbsp;&nbsp;会社名を入力してください。</p><p>&nbsp;&nbsp;Do you have a Microsoft support case number? :<br>&nbsp;&nbsp;&nbsp;&nbsp;弊社にお問合せいただいている場合は、”Yes” を選択し、お問合せ番号を入力してください。<br>&nbsp;&nbsp;&nbsp;&nbsp;お問合せいただいてない場合は、”No” を選択してください。</p><p>&nbsp;&nbsp;Software Assurance ID :<br>&nbsp;&nbsp;&nbsp;&nbsp;Software Assurance ID (SAID) をお持ちの場合に入力してください。</p><p>&nbsp;&nbsp;Select the file (*) :<br>&nbsp;&nbsp;&nbsp;&nbsp;サンプルとしてご提供いただくファイルを選択してください。</p><p>&nbsp;&nbsp;Should this file be removed from our database at a certain date? :<br>&nbsp;&nbsp;&nbsp;&nbsp;弊社にご提供いただいたファイルを削除する日を指定する場合は “Yes” を選択し、日にちを指定してください。<br>&nbsp;&nbsp;&nbsp;&nbsp;特に指定が無い場合は、”No” を選択します。</p><p>&nbsp;&nbsp;Do you believe this file contains malware? :<br>&nbsp;&nbsp;&nbsp;&nbsp;マルウェアの可能性があるファイルをお寄せいただく場合は、”Yes” を選択します。<br>&nbsp;&nbsp;&nbsp;&nbsp;誤ってマルウェアとして検知されたファイルをお寄せいただく場合は、”No” を選択します。</p><p>&nbsp;&nbsp;Select the Microsoft security product used to scan the file (*) :<br>&nbsp;&nbsp;&nbsp;&nbsp;マルウェアを検知した製品・サービスを選択します。<br>&nbsp;&nbsp;&nbsp;&nbsp;Exchange Online の場合は、”Office 365 and Exchange Online Protection” を選択してください。</p><p>&nbsp;&nbsp;Detection name (*) :<br>&nbsp;&nbsp;&nbsp;&nbsp;マルウェアとして検知された際の名前を入力します。例 : X97M/Dropper</p><p>&nbsp;&nbsp;Additional information (*) :<br>&nbsp;&nbsp;&nbsp;&nbsp;その他に検知された内容に関する情報があれば、入力します。</p><ol start="5"><li>入力した内容の確認ページが表示されますので、問題が無ければ “Submit” をクリックして、アップロードしてください。<br>&nbsp;<br>引き続き Exchange Online では複数のマルウェア対策エンジンを使用することでセキュリティ強化と誤検知の削減に努めてまいりますが、万が一疑わしいメッセージを受信した場合には、安易にメッセージを開かず、上記手順に基づき早急な検体提出にご協力をいただけますようお願いいたします。<br>今後とも、弊社サポート ブログをよろしくお願いいたします。</li></ol><p>※本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;こんにちは、Exchange Server サポートの渡辺です。&lt;br&gt;今回は Exchange Online におけるマルウェア検体のご提供手順に変更がございましたので、ご紹介させていただきます。&lt;/p&gt;
&lt;p&gt;これまで Exchange Online でマルウェアの可能
      
    
    </summary>
    
    
    
      <category term="EXO" scheme="https://jpmessaging.github.io/blog/tags/EXO/"/>
    
  </entry>
  
  <entry>
    <title>Office 365 の言語設定について
</title>
    <link href="https://jpmessaging.github.io/blog/Office%20365%20%E3%81%AE%E8%A8%80%E8%AA%9E%E8%A8%AD%E5%AE%9A%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6/"/>
    <id>https://jpmessaging.github.io/blog/Office%20365%20%E3%81%AE%E8%A8%80%E8%AA%9E%E8%A8%AD%E5%AE%9A%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6/</id>
    <published>2017-07-13T15:00:00.000Z</published>
    <updated>2020-06-03T03:05:04.069Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。いつも Office 365 を利用いただきまして、ありがとうございます。<br>今回は、Office 365 での言語設定についてご説明します。<br>下記の設定が反映される箇所は、Office 365 ポータル / 各種管理センターです。</p><p>Office 365 を使用するユーザーは、2 種類があります。</p><ol><li>クラウドユーザー：Office 365 上で作成したユーザー</li><li>ディレクトリ同期ユーザー：オンプレミス AD で作成後、ディレクトリ同期によって Office 365 上に同期されたユーザー</li></ol><p>それぞれのユーザーについて、Office 365 で使用する言語の設定方法は下記の通りです。</p><h3><strong>1. クラウドユーザー</strong></h3>「言語とタイムゾーン」にて設定する言語が使用されます。<a href="media/2017/07/071401.png"><p><img src="071401.png" alt=""><br></a></p><h3><strong>2. ディレクトリ同期ユーザー</strong></h3>ディレクトリ同期ユーザーの場合、クラウドユーザーのような「言語とタイムゾーン」設定項目がありません。既定では、ブラウザの言語設定が Office 365 においても使用される動作となっています。<a href="media/2017/07/071402.png"><p><img src="071402.png" alt=""><br></a></p><p>ユーザーが使用しているブラウザーの言語設定に依存せずに、Office 365 を使用するときは必ず「日本語」を使用するように設定するには、<br>オンプレミス AD 側で対象ユーザーの PreferredLanguage 属性の値を ja-JP に設定し、ディレクトリ同期を実施します。<br>ディレクトリ同期が完了しますと、Office 365 側でもユーザーの PreferredLanguage 属性値が ja-JP となります。<br><a href="media/2017/07/071403.png"></p><p><img src="071403.png" alt=""><br></a></p><p>Office 365 側の確認方法は、下記の通りです。</p><p>&gt; Get-MsolUser -UserPrincipalName <a href="mailto:testuser@contoso.onmicrosoft.com">testuser@contoso.onmicrosoft.com</a> | fl</p><p>LastDirSyncTime                               : 2017/06/29 6:54:24<br>ImmutableId                                      : ZmfNKSV/gUu9PMAmXH3Stg==<br><span style="color: #0000ff">PreferredLanguage                           : ja-JP　＜＜＜こちらを確認します。</span><br>UserPrincipalName                          : <a href="mailto:testuser@contoso.onmicrosoft.com">testuser@contoso.onmicrosoft.com</a><br>UserType                                             : Member<br>ValidationStatus                                : Healthy<br>WhenCreated                                     : 2017/06/21 1:51:41<br>&nbsp;<br>2018 年4 月追記：<br>セキュリティ/コンプライアンスセンター（SCC）につきましては、PreferredLanguage  属性値が空白の場合、<br>ブラウザの言語設定に依存せず既定値である「英語」で表示されます。<br>SCC を日本語で表示させるには、PreferredLanguage  属性値を ja-JP に設定していただく方法が有効となりますので、<br>クラウドユーザー / ディレクトリ同期ユーザーそれぞれの手順にて設定を実施ください。</p><p>- 参考情報<br>Office 365 で言語および地域を設定する方法<br>URL：<a href="https://support.microsoft.com/ja-jp/help/4018959/how-to-set-language-and-region-settings-for-office-365" target="_blank" rel="noopener">https://support.microsoft.com/ja-jp/help/4018959/how-to-set-language-and-region-settings-for-office-365</a><br>&nbsp;<br>ロケール ID (LCID) の一覧<br>URL：<a href="https://msdn.microsoft.com/ja-jp/library/cc392381.aspx" target="_blank" rel="noopener">https://msdn.microsoft.com/ja-jp/library/cc392381.aspx</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;こんにちは。いつも Office 365 を利用いただきまして、ありがとうございます。&lt;br&gt;今回は、Office 365 での言語設定についてご説明します。&lt;br&gt;下記の設定が反映される箇所は、Office 365 ポータル / 各種管理センターです。&lt;/p&gt;
&lt;p&gt;Of
      
    
    </summary>
    
    
    
      <category term="O365Identity" scheme="https://jpmessaging.github.io/blog/tags/O365Identity/"/>
    
  </entry>
  
  <entry>
    <title>ハイブリッド環境でオンプレミスと Exchange Online の両方にメールボックスが作成される事象について
</title>
    <link href="https://jpmessaging.github.io/blog/%E3%83%8F%E3%82%A4%E3%83%96%E3%83%AA%E3%83%83%E3%83%89%E7%92%B0%E5%A2%83%E3%81%A7%E3%82%AA%E3%83%B3%E3%83%97%E3%83%AC%E3%83%9F%E3%82%B9%E3%81%A8%20Exchange%20Online%20%E3%81%AE%E4%B8%A1%E6%96%B9%E3%81%AB%E3%83%A1%E3%83%BC%E3%83%AB%E3%83%9C%E3%83%83%E3%82%AF%E3%82%B9%E3%81%8C%E4%BD%9C%E6%88%90%E3%81%95%E3%82%8C%E3%82%8B%E4%BA%8B%E8%B1%A1%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6/"/>
    <id>https://jpmessaging.github.io/blog/%E3%83%8F%E3%82%A4%E3%83%96%E3%83%AA%E3%83%83%E3%83%89%E7%92%B0%E5%A2%83%E3%81%A7%E3%82%AA%E3%83%B3%E3%83%97%E3%83%AC%E3%83%9F%E3%82%B9%E3%81%A8%20Exchange%20Online%20%E3%81%AE%E4%B8%A1%E6%96%B9%E3%81%AB%E3%83%A1%E3%83%BC%E3%83%AB%E3%83%9C%E3%83%83%E3%82%AF%E3%82%B9%E3%81%8C%E4%BD%9C%E6%88%90%E3%81%95%E3%82%8C%E3%82%8B%E4%BA%8B%E8%B1%A1%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6/</id>
    <published>2017-07-09T15:00:00.000Z</published>
    <updated>2020-06-03T03:05:04.082Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Exchange サポートの渡辺です。<br>今回はハイブリッド環境で同一ユーザーのメールボックスが “オンプレミス” と “Exchange Online” の両方に作成されてしまった際の対処方法についてご紹介します。</p><p>&nbsp;</p><h3><u><strong>そもそもなぜ両方にメールボックスが作成されてしまうのか</strong></u></h3>通常、オンプレミスと Exchange Online の双方にメールボックスが作成されることはありませんが、オンプレミスから Exchange Online のメールボックス移動に際して発生することが、過去のお問合せとして報告されています。&nbsp;具体的には、Exchange Online へのメールボックスの移動が終わり、その後のメールボックス移動の最終処理でオンプレミス側ではメールボックスからリモート メールボックスへの変換が行われます。それに伴ってオンプレミス側のディレクトリ情報も更新される動作となっていますが、この際に何らかの要因でディレクトリ情報の更新がスキップされる場合があり、この結果オンプレミスがのメールボックスが残ってしまい、両方にメールボックスが存在する状態が発生します。&nbsp;この際、以下のように移動要求自体は CompletedWithWarnings のステータスとなっており、Error 部分には移行の最終処理でクリーンアップ処理がスキップされたため、移動元 (オンプレミス) のメールボックスが残っている可能性がある旨が記録されます。なお、エラーは発生していますが、メールボックスの移動 (データの移動) 自体はステータス上 Completed で完了している状態となり、前述のとおり Exchange Online への移動自体は完了しているため、メールデータも移動できております。&nbsp;**********************Status                           : CompletedWithWarningsStatusSummary                 : FailedState                            : CompletedError                            : <font color="red">MigrationMRSPermanentException: <span style="background-color: #ffff00">Warning: The mailbox was already moved but failed to</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;update the job state during the final stages of the move. It is possible that the s&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ource mailbox could still be alive since post move cleanup operations were deliberat&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ely not executed.</font>Report                           : &lt;省略&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2017/06/08 2:10:38 [TY1PR0301MB1023] Move has completed and final cleanup has started.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2017/06/08 2:10:39 [TY1PR0301MB1023] Target mailbox 'contoso.onmicrosoft.com\121042ca-c198-4fe1-8d&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;25-0b1aefa7e1b5 (Primary)' was successfully reset after the move.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2017/06/08 2:10:40 [TY1PR0301MB1023] Waiting for mailbox changes to replicate.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2017/06/08 2:11:17 [TY1PR0301MB1023] Request is complete.**********************&nbsp;他にも、以下のような作業を実施した場合には、オンプレミス側でメールボックスが再作成されてしまう可能性がありますのでご注意ください。<p>・ オンプレミス側でユーザーのディレクトリ情報を、オンプレミスにメールボックスが存在していた時の情報に復元してしまった<br>・ Exchange Online にメールボックスがある状態で、オンプレミスで Enable-Mailbox を実行してしまった</p><p>&nbsp;</p><h3><u><strong>両方にメールボックスが作成されてしまった時の動作について</strong></u></h3>まず、この場合はオンプレミスと Exchange Online のメールボックス両方にログインすることが可能です。Outlook の場合、Autodiscover の構成次第とはなりますが、基本的にどちらかのメールボックスの情報しか接続できないため、ご注意ください。どうしてももう一つのメールボックスに接続する必要がある場合は、OWA (OotW) で接続します。なお、上述のとおりメールボックス データの移行は正常に行えているため、Exchange Online のメールボックスで以前に受信したメール等を確認することもできます。<p>次に気になるのが、新しいメッセージはどちらのメールボックスに配信されているのかという点です。<br>答えは、送信者が誰かによって違いがあり、基本的には以下の動作になっています。</p><p>   ・ オンプレミスのユーザーから送信されたメール : オンプレミス側のメールボックスに配信される<br>   ・ Exchange Online のユーザーから送信されたメール : Exchange Online 側のメールボックスに配信される<br>   ・ 外部から送信されたメッセージ : 最初に経由する環境側のメールボックスに配信される<br>      (外部からのメールを ExO が最初に受信するメールフローの場合は ExO のメールボックスに、オンプレ側が受信する場合はオンプレのメールボックスに配信される)</p><p>この状態では上記の動作となっているため、メールボックスの移動後に配信されたメッセージが、オンプレミスまたは、Exchange Online のどちらかにしか存在しない場合があるので注意が必要です。</p><p>&nbsp;<br><u><strong><h3>両方にメールボックスが作成されてしまった時の対処方法</strong></u></h3><br>メールボックスがオンプレミスと Exchange Online の両方に作成されてしまった場合の対処方法としては、オンプレミスのメールボックスを削除するか、Exchange Online のメールボックスを削除するかの二択となります。<br>この状況が発生するシナリオとしては、上述のとおり基本的に Exchange Online へ移動を試みている際に、オンプレミスのメールボックスが削除されなかった” というパターンが多いので、ここではオンプレミスのメールボックスを削除する方法をご案内します。<br>&nbsp;<br>基本的な流れとしては以下の通りですが、作業中 (2,3 の作業中) は対象のメールボックスに対するメッセージが配信されず、送信者に配信不能通知が応答される可能性がありますのでご注意ください。<br>&nbsp;<br><strong><big>0. オンプレミスのメールボックスに届くメールを Exchange Online に転送するように構成する</p><ol><li>削除対象のメールボックス内のメール アイテムを PST にエクスポートする</li><li>ディレクトリ同期の停止</li><li>メールボックスの削除 (無効化)</li><li>ディレクトリ同期の再開と、手順 1 でエクスポートした情報のインポート</strong></big><br>&nbsp;<br>以下、各手順の詳細です。</li></ol><p>&nbsp;<br><u><strong><big>0. オンプレミスのメールボックスに届くメールを Exchange Online に転送するように構成する</strong></u></big><br>この後の手順では、オンプレミスのメールボックス内のアイテムをエクスポートして、オンプレミス側を削除する手順となっているのですが、エクスポートしてから削除されるまでに受信したアイテムについては、Exchange Online に引き継ぐことができなくなってしまいます。<br>そのため、事前にオンプレミスのメールボックスに届いたメールは Exchange Online に転送されるように構成します。<br>転送する方法は様々あり、仕分けルールやトランスポート ルール、メールボックスの配信オプションなどが使用できます。<br>配信オプションを利用する場合は、オンプレミス側で以下のコマンドを実行することで、Exchange Online 側のメールボックスへの転送を設定できます。<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;Set-Mailbox -Identity &lt;対象のメールボックス&gt; -ForwardingSmtpAddress &lt;ExO のメールボックス固有 (onmicrosoft.com ドメイン等) のメール アドレス&gt;<br>&nbsp;<br>ここでポイントとなるのは、転送先が Exchange Online 固有のメールアドレスである必要があるという点です。<br>Exchange Online のメールボックスの場合は基本的に onmicrosoft.com ドメインなど Exchange Online 側にしか設定されていないメールアドレスがあるため転送するという方法が利用できますが、逆にオンプレミス側のメールボックスを残したいというシナリオの場合、オンプレミス側固有のメールアドレスが設定されているケースは少ないかもしれません。<br>&nbsp;<br>この場合は転送するという方法が利用できないため、必要に応じて Exchange Online 側で新しいメールを受信しない  (送信者には NDR を応答する) ように構成する必要があります。<br>こちらも方法は様々ですが、例えば Exchange Online 側のメールボックスが受信できるサイズの上限を 0 Byte とするのも 1 つの方法です。<br>※ ディレクトリ同期環境でも Exchange Online 側で以下のコマンドを実行して Exchange Onlinega 側のメールボックスだけに設定を行うことが可能です。<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;Set-Mailbox -Identity &lt;対象のメールボックス&gt; -MaxReceiveSize 0B<br>&nbsp;<br>もちろんオンプレミス固有のメールアドレスがある場合は、先に説明した方法と同じようにオンプレミスに対して転送する設定をいただければ問題ありません。</p><p>&nbsp;<br><u><strong><big>1. 削除対象のメールボックス内のメール アイテムを PST にエクスポートする</strong></u></big><br>削除を行うオンプレミスのメールボックス内に含まれるデータを PST ファイルにエクスポートします。<br>PST ファイルにエクスポートする方法はいくつかありますが、環境によって実施できないものなどがありますのでお気をつけください。<br>この手順はメールボックス移動を行った後に、オンプレミスのメールボックスに配信されたメッセージを取得するためのものですので、特に必要なデータが無い場合は、本手順を実施いただかなくても問題はありません。</p><p>&nbsp;<br>Outlook を使用して PST ファイルにエクスポートする<br>^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<br>上述の通り、構成によってはオンプレミスのメールボックスに接続できない場合がありますので注意が必要です。<br>手順は以下の公開情報をご確認ください。<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;Title : メール、連絡先、予定表を Outlook の .pst ファイルにエクスポートまたはバックアップする<br>&nbsp;&nbsp;&nbsp;&nbsp;URL : <a href="https://support.office.com/ja-jp/article/Export-or-backup-email-contacts-and-calendar-to-an-Outlook-pst-file-14252b52-3075-4e9b-be4e-ff9ef1068f91" target="_blank" rel="noopener">https://support.office.com/ja-jp/article/Export-or-backup-email-contacts-and-calendar-to-an-Outlook-pst-file-14252b52-3075-4e9b-be4e-ff9ef1068f91</a></p><p>&nbsp;<br>メールボックスのエクスポート要求を作成して、エクスポートする<br>^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<br>管理者によって実施する手順となります。<br>手順等は以下の公開情報をご確認ください。<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;Title : メールボックスのインポート要求とエクスポート要求<br>&nbsp;&nbsp;&nbsp;&nbsp;URL : <a href="https://technet.microsoft.com/ja-jp/library/ee633455(v=exchg.150).aspx" target="_blank" rel="noopener">https://technet.microsoft.com/ja-jp/library/ee633455(v=exchg.150).aspx</a></p><p>&nbsp;&nbsp;&nbsp;&nbsp;Title : メールボックスのエクスポート要求を作成する<br>&nbsp;&nbsp;&nbsp;&nbsp;URL : <a href="https://technet.microsoft.com/ja-jp/library/ff459227(v=exchg.141).aspx" target="_blank" rel="noopener">https://technet.microsoft.com/ja-jp/library/ff459227(v=exchg.141).aspx</a><br>&nbsp;&nbsp;&nbsp;&nbsp;※ Exchange 2010 の公開情報とはなりますが、Exchange 2013 や 2016 でも同様です。</p><p>&nbsp;<br>インプレース電子情報開示を使用して、エクスポートする<br>^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<br>こちらも管理者によって実施する手順となります。<br>手順等は以下の公開情報を参考にしていただければと思いますが、バージョンによって手順が異なるのでご注意ください。<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;Title : インプレース電子情報開示 (eDiscovery)<br>&nbsp;&nbsp;&nbsp;&nbsp;URL : <a href="https://technet.microsoft.com/ja-jp/library/dd298021(v=exchg.150).aspx" target="_blank" rel="noopener">https://technet.microsoft.com/ja-jp/library/dd298021(v=exchg.150).aspx</a></p><p>&nbsp;<br><u><strong><big>2. ディレクトリ同期の停止</strong></u></big><br>後続の手順でオンプレミスのメールボックスを削除することになりますが、作業途中でディレクトリ同期が行われた場合に、場合によっては Exchange Online のメールボックスまで削除されてしまう場合があります。<br>基本的には再接続されるため問題はありませんが、可能であればディレクトリ同期を一時的に停止して作業を実施いただければと思います。<br>※ 理論的にはディレクトリ同期の間隔 (既定では 30 分) 内で作業 (後述の手順 3 の 2,3,4 の手順) を実施いただければ影響はありませんので、必須ではありません。<br>&nbsp;<br>AAD Connect を利用している環境では、ディレクトリ同期を実行しているサーバーで Powerhsell を起動し、以下のコマンドを実行することで、定期的に実行されるディレクトリ同期を停止することができます。<br>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;Set-ADSyncScheduler -SyncCycleEnabled $False</p><p>&nbsp;<br>※補足<br>削除対象のメールボックスで訴訟ホールドが有効な場合は対象のメールボックスを削除できないため、事前にホールドを無効化する必要があります。<br>また、訴訟ホールドを無効化しても反映までに時間を要する (最大 60 分) ため、ディレクトリ同期を停止する前に事前に実施することをお勧めします。<br>なお、訴訟ホールドの有効/無効の設定はオンプレミスと Exchange Online で独立しているので、オンプレミス側で削除対象のメールボックスの設定を変更しても Exchange Online のメールボックスでは訴訟ホールドが有効なままとなりますのでご安心ください。<br>訴訟ホールドを無効にする場合は、以下のコマンドを実行します。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;Set-Mailbox -Identity &lt;対象のメールボックス&gt; -LitigationHoldEnabled $False</p><p>&nbsp;<br><u><strong><big>3. メールボックスの削除 (無効化)</strong></u></big><br>不要なメールボックスを削除 (無効化) します。<br>&nbsp;</p><ol><li>事前に EXO、オンプレ双方にて以下のコマンド実行し、現在の設定内容 (特に EmailAddresses の値) を控えます。<br>後述の手順で使用しますので、出力結果はテキスト ファイル等にコピーしておきます。</li></ol><p>&nbsp;&nbsp;&nbsp;&nbsp;Get-Mailbox &lt;対象のメールボックス&gt; | fl</p><p>※ 設定されている内容が多いパラメーターは出力が省略されてしまう場合がありますので、事前に以下のコマンドを実行してください。<br>　 これによって、出力結果が省略されなくなります。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;$FormatEnumerationLimit=-1<br>&nbsp;<br>2. オンプレミスで Exchange 管理シェルを起動し、以下のコマンドを実行して、オンプレミスのメールボックスを無効化します。<br>   これにより、対象のユーザーに付与されている Exchange 属性が削除されます。<br>   実行後は、メールボックスが存在している AD サイト内すべての DC に無効化された情報が複製されていることをご確認ください。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;Disable-Mailbox -Identity &lt;対象のメールボックス&gt;<br>&nbsp;<br>3. 続いて以下のコマンドを実行して、リモート メールボックスを有効化します。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;Enable-RemoteMailbox -Identity &lt;メールボックス&gt; -RemoteRoutingAddress &amp;ltmail.onmicrosoft.com ドメインのアドレス&gt;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;例 :<br>&nbsp;&nbsp;&nbsp;&nbsp;Enable-RemoteMailbox -Identity user01 -RemoteRoutingAddress <a href="mailto:user01@contoso.mail.onmicrosoft.com">user01@contoso.mail.onmicrosoft.com</a><br>&nbsp;<br>※ 補足<br>設定にも依存いたしますが、一般的には &lt;テナント&gt;.mail.onmicrosoft.com ドメインがオンプレミス/Exchange Online 間のハイブリッド関連機能 (空き時間情報の確認やメール転送等) で使用される SMTP ドメインとなるため、こちらを RemoteRoutingAddress として設定します。<br>mail.onmicrosoft.com を付与しない構成となっている場合は、代わりにハイブリッド関連機能で使用するドメインのアドレスを付与いただければと思います。</p><p>&nbsp;<br><u><strong><big>4. ディレクトリ同期の再開と、手順 1 でエクスポートした情報のインポート</strong></u></big><br>ディレクトリ同期を再開します。<br>&nbsp;</p><ol><li>ディレクトリ同期実行サーバーで以下のコマンドを実行し、スケジュールによる同期を有効化します。</li></ol><p>&nbsp;&nbsp;&nbsp;&nbsp;Set-ADSyncScheduler -SyncCycleEnabled $True<br>&nbsp;<br>2. 続いて以下のコマンドを実行し、手動で同期を開始します。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;Start-ADSyncSyncCycle<br>&nbsp;<br>3. ディレクトリ同期を再開後、組織外やオンプレミスからのメッセージ等が正常に Exchange Online 側のメールボックスに配信されるかご確認ください。<br>問題ないようでしたら、手順 1 でエクスポートした PST ファイルを基に、Exchange Online のメールボックスにインポートを実施します。<br>&nbsp;<br>手順はエクスポート時と同様に、Outlook から実施する方法と管理者で実施する方法があります。<br>詳細は以下の公開情報をご確認ください。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;Title : Outlook .pst ファイルからメール、連絡先、予定表をインポートする<br>&nbsp;&nbsp;&nbsp;&nbsp;URL : <a href="https://support.office.com/ja-jp/article/Import-email-contacts-and-calendar-from-an-Outlook-pst-file-431a8e9a-f99f-4d5f-ae48-ded54b3440ac" target="_blank" rel="noopener">https://support.office.com/ja-jp/article/Import-email-contacts-and-calendar-from-an-Outlook-pst-file-431a8e9a-f99f-4d5f-ae48-ded54b3440ac</a></p><p>&nbsp;&nbsp;&nbsp;&nbsp;Title : ネットワーク アップロードを使用して PST ファイルを Office 365 にインストールする<br>&nbsp;&nbsp;&nbsp;&nbsp;URL : <a href="https://support.office.com/ja-jp/article/Use-network-upload-to-import-PST-files-to-Office-365-103f940c-0468-4e1a-b527-cc8ad13a5ea6" target="_blank" rel="noopener">https://support.office.com/ja-jp/article/Use-network-upload-to-import-PST-files-to-Office-365-103f940c-0468-4e1a-b527-cc8ad13a5ea6</a><br>&nbsp;<br>手順は以上となります。<br>それほど頻繁に発生する事象ではありませんが、もし発生してしまった場合は、こちらの対処方法を参考としていただけますと幸いです。</p><p>&nbsp;<br>※本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;こんにちは、Exchange サポートの渡辺です。&lt;br&gt;今回はハイブリッド環境で同一ユーザーのメールボックスが “オンプレミス” と “Exchange Online” の両方に作成されてしまった際の対処方法についてご紹介します。&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;h
      
    
    </summary>
    
    
    
      <category term="Hybrid" scheme="https://jpmessaging.github.io/blog/tags/Hybrid/"/>
    
  </entry>
  
  <entry>
    <title>New-EdgeSubscription 実行時にスマート カード認証が求められる
</title>
    <link href="https://jpmessaging.github.io/blog/New-EdgeSubscription%20%E5%AE%9F%E8%A1%8C%E6%99%82%E3%81%AB%E3%82%B9%E3%83%9E%E3%83%BC%E3%83%88%20%E3%82%AB%E3%83%BC%E3%83%89%E8%AA%8D%E8%A8%BC%E3%81%8C%E6%B1%82%E3%82%81%E3%82%89%E3%82%8C%E3%82%8B/"/>
    <id>https://jpmessaging.github.io/blog/New-EdgeSubscription%20%E5%AE%9F%E8%A1%8C%E6%99%82%E3%81%AB%E3%82%B9%E3%83%9E%E3%83%BC%E3%83%88%20%E3%82%AB%E3%83%BC%E3%83%89%E8%AA%8D%E8%A8%BC%E3%81%8C%E6%B1%82%E3%82%81%E3%82%89%E3%82%8C%E3%82%8B/</id>
    <published>2016-12-20T15:00:00.000Z</published>
    <updated>2020-06-03T03:05:04.066Z</updated>
    
    <content type="html"><![CDATA[<p>今回は、Exchange 2013/2016 のエッジ トランスポート サーバーをご利用でコマンドレット実行時にスマート カード認証を求められる場合の回避策についてご紹介します。</p><h2 id="事象概要"><a href="#事象概要" class="headerlink" title="事象概要"></a>事象概要</h2><p>証明書の更新などに伴いエッジ サブスクリプションの再構成を行う際、Exchange エッジ トランスポート サーバー上で New-EdgeSubscription コマンドレットや Remove-EdgeSubscription コマンドレットを実行すると、スマート カードでの認証が求められる場合があります。<br>表示される画面には、以下の 2 つのパターンがあります。</p><p><img src="2016122101.png" alt=""></p><p><img src="2016122102.png" alt=""></p><p>Exchange エッジ トランスポート サーバーにおいて Exchange Management Shell から New-EdgeSubscription コマンドレットや Remove-EdgeSubscription コマンドレットを実行する際、認証を伴った LDAP Bind を試みますが、この認証時に環境によってはスマート カードでの認証が求められます。<br>そもそもスマート カード認証が設定されていない等で認証が通らない、またはスマート カード認証のダイアログをキャンセルすると、コマンドレットは実行されず以下のようにエラーになります。</p><p><img src="2016122103.png" alt=""></p><h2 id="対処策"><a href="#対処策" class="headerlink" title="対処策"></a>対処策</h2><p>この状況はローカル ログオン アカウントに紐づけられた認証情報により発生するため、回避するためには、以下 2 つの方法があります。</p><ul><li>当該 Exchange エッジ トランスポート サーバーに別の管理者アカウントを作成し、新しいユーザーでコマンドレットを実行する。</li><li>システム アカウントを使用してコマンドレットを実行する。</li></ul><p>システム アカウントを使用する場合には、以下の手順をご参照ください。</p><h3 id="手順"><a href="#手順" class="headerlink" title="手順"></a>手順</h3><ol><li><p>以下の URL にアクセスし、ツールをダウンロードします。</p><p> Title: PsExec<br> Url: <a href="https://technet.microsoft.com/ja-jp/sysinternals/bb897553" target="_blank" rel="noopener">https://technet.microsoft.com/ja-jp/sysinternals/bb897553</a></p></li><li><p>ダウンロードした zip ファイルを展開し、PsExec.exe をエッジ トランスポート サーバー上にコピーします。</p></li><li><p>コマンド プロンプトまたは Windows PowerShell を起動して PsExec.exe をコピーしたディレクトリへ移動し、以下のコマンドを実行します。</p><p> コマンド:</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PsExec.exe -s -i C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe -PSConsoleFile &quot;C:\Program Files\Microsoft\Exchange Server\V15\bin\exshell.psc1&quot; -noexit -command &quot;. &#39;C:\Program Files\Microsoft\Exchange Server\V15\bin\Exchange.ps1&#39;&quot;</span><br></pre></td></tr></table></figure><p>※ 上記は Exchange サーバーのインストール パスが既定のパスであることが前提の手順となっております。インストール パスが異なる場合には、適宜変更頂けますようお願い申し上げます。</p></li><li><p>手順 3 のコマンドにより起動し、Exchange に接続した PowerShell にて、実施したいコマンドレットを実行します。以下では、New-EdgeSubscription コマンドレットを実施する場合の例を記載します。</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">New-EdgeSubscription -FileName &lt;xml ファイル名&gt;</span><br></pre></td></tr></table></figure></li></ol><h2 id="補足情報"><a href="#補足情報" class="headerlink" title="補足情報"></a>補足情報</h2><p>この事象は Exchange エッジ トランスポート サーバーでのコマンドレット実行時に限らず、Windows PowerShell から LDAP 接続を試みた際にも発生する可能性があります。<br>Windows PowerShell にてサンプル スクリプトを実行することで、起き得る環境か否かを確認することができます。</p><p>サンプル スクリプト</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Add-Type</span> <span class="literal">-AssemblyName</span>:System.DirectoryServices.Protocols</span><br><span class="line"><span class="variable">$conn</span> = <span class="built_in">New-Object</span> System.DirectoryServices.Protocols.LdapConnection <span class="literal">-ArgumentList</span> <span class="string">'localhost:50636'</span></span><br><span class="line"><span class="variable">$conn</span>.AuthType = [<span class="type">System.DirectoryServices.Protocols.AuthType</span>]::Negotiate</span><br><span class="line"><span class="variable">$conn</span>.SessionOptions.VerifyServerCertificate = &#123;<span class="keyword">param</span>(<span class="variable">$connection</span>, <span class="variable">$cert</span>)&#123;<span class="variable">$true</span>&#125;&#125;</span><br><span class="line"><span class="variable">$conn</span>.SessionOptions.SecureSocketLayer = <span class="variable">$true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="variable">$conn</span>.Bind()</span><br><span class="line">  <span class="built_in">Write-Host</span> <span class="string">"Bind success"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span>&#123;</span><br><span class="line">  <span class="built_in">Write-Error</span> <span class="variable">$Error</span>[<span class="number">0</span>].Exception.Message</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>※ 本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;今回は、Exchange 2013/2016 のエッジ トランスポート サーバーをご利用でコマンドレット実行時にスマート カード認証を求められる場合の回避策についてご紹介します。&lt;/p&gt;
&lt;h2 id=&quot;事象概要&quot;&gt;&lt;a href=&quot;#事象概要&quot; class=&quot;header
      
    
    </summary>
    
    
    
      <category term="Exchange" scheme="https://jpmessaging.github.io/blog/tags/Exchange/"/>
    
  </entry>
  
  <entry>
    <title>NTFS の FAL サイズ制限に抵触してデータベースが FailedAndSuspended になる
</title>
    <link href="https://jpmessaging.github.io/blog/NTFS%20%E3%81%AE%20FAL%20%E3%82%B5%E3%82%A4%E3%82%BA%E5%88%B6%E9%99%90%E3%81%AB%E6%8A%B5%E8%A7%A6%E3%81%97%E3%81%A6%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E3%81%8C%20FailedAndSuspended%20%E3%81%AB%E3%81%AA%E3%82%8B/"/>
    <id>https://jpmessaging.github.io/blog/NTFS%20%E3%81%AE%20FAL%20%E3%82%B5%E3%82%A4%E3%82%BA%E5%88%B6%E9%99%90%E3%81%AB%E6%8A%B5%E8%A7%A6%E3%81%97%E3%81%A6%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E3%81%8C%20FailedAndSuspended%20%E3%81%AB%E3%81%AA%E3%82%8B/</id>
    <published>2016-12-13T15:00:00.000Z</published>
    <updated>2020-06-03T03:05:04.064Z</updated>
    
    <content type="html"><![CDATA[<p>Exchange Serverをご利用のお客様より、最近お問い合わせが増加傾向にある NTFS の FAL サイズ制限について事象と対処策についてご紹介します。</p><h2 id="事象概要"><a href="#事象概要" class="headerlink" title="事象概要"></a>事象概要</h2><p>NTFS では File Attribute List (FAL) と呼ばれるファイル毎のリストにてデータの実態がディスク上のどこに格納されているか等の情報を管理しています。この、FAL にはサイズ制限があり、使い続けている以上サイズが小さくなることはありません。<br>このため、長期にわたり運用されている環境や、非常に大きなデータベース ファイルを運用されている場合、フラグメントの進行とともに この FAL のサイズが大きくなり、最終的にサイズ制限に抵触することがあります。<br>この場合、NTFS としてデータベースへの書き込みができなくなるため、Exchange Server (主にメールボックス サーバー) では結果としてデータベースのマウントが解除される、または DAG  のデータベース コピーのレプリケーションが停止し、データベース コピーの状態が FailedAndSuspended になるなどの問題につながります。</p><p>このとき、以下のエラーがアプリケーション ログに記録され、該当のデータベース ファイルの NTFS の FAL サイズ制限に抵触したことがわかります。</p><blockquote><p>ソース: ESE<br>イベント ID: 482<br>レベル: エラー<br>説明:<br>Information Store - &lt;データベース名&gt; (13184) &lt;データベース名&gt;: ファイル “&lt;edb ファイル パス&gt;” のオフセット 4075655528448 (0x000003b4f0000000) に 0 (0x00000000) バイトを書き込めもうとしましたが、システム エラー 665 (0x00000299): “ファイル システム制限のため、要求された操作を完了できませんでした “ のため、0.000 秒経過しても書き込むことができませんでした。書き込み処理は、エラー -1022 (0xfffffc02) のため失敗します。このエラーが引き続き発生する場合は、ファイルが破損していて以前のバックアップからこのファイルを復元する必要がある可能性があります。</p></blockquote><p>上記のイベントにありますエラー コード 665 (0x00000299) は ERROR_FILE_SYSTEM_LIMITATION を意味し、イベントに記録されているデータベース ファイルが NTFS の FAL のサイズ制限に抵触しているため書き込みが行えなかったことを示しています。<br>また、Exchange 2010 環境の場合は以下の ESE 739 のエラーも記録されます。</p><blockquote><p>ソース: ESE<br>イベント ID: 739<br>レベル: エラー<br>説明:<br>Information Store (13184) &lt;データベース名&gt;: データベース ‘&lt;edb ファイル パス&gt;’ の NTFS ファイル属性サイズが 257216 バイトで、204800 バイトのしきい値を超えています。データベースのファイルを再シードするか、コピーまたはバックアップから復元して、データベース ファイルがファイル システム制限により拡張できなくなることを防ぐ必要があります。</p></blockquote><h2 id="対処策"><a href="#対処策" class="headerlink" title="対処策"></a>対処策</h2><p>この動作は NTFS の制限となるため、対処策としては DAG 環境の場合は再シードを実施する、あるいはバックアップ ファイルから復元する等して、データベース ファイルを作り直す必要ございます。<br>データベース コピーを再シードする場合は、以下の参考情報をご参照ください。</p><p>Title: メールボックス データベース コピーの更新<br>URL (Exchange 2010): <a href="https://technet.microsoft.com/ja-jp/library/dd351100(v=exchg.141).aspx" target="_blank" rel="noopener">https://technet.microsoft.com/ja-jp/library/dd351100(v=exchg.141).aspx</a><br>URL (Exchange 2013): <a href="https://technet.microsoft.com/ja-jp/library/dd351100(v=exchg.150).aspx" target="_blank" rel="noopener">https://technet.microsoft.com/ja-jp/library/dd351100(v=exchg.150).aspx</a></p><h2 id="補足情報"><a href="#補足情報" class="headerlink" title="補足情報"></a>補足情報</h2><p>Exchange 2010 は RTM を 2009 年 11 月にリリースしてから約 7 年が経過しました。<br>これまでの運用において、DAG 環境で再シードを実施する機会がなかった場合は、長い運用期間の中でファイルのフラグメントと共にデータベース ファイルの FAL が大きくなってきており、それが弊社サポートへの本事象のお問合せ増加の要因となっていると考えられます。<br>DAG 環境の場合は、データベースの再シードを実施することで本事象の発生を起きにくくすることが可能です。</p><p>その他に本事象で考慮が必要な点として、NTFS アロケーション ユニット サイズ (ディスク上でひとまとまりのブロックとして扱うサイズ) がございます。<br>Exchange 2010, Exchange 2013 での NTFS アロケーション ユニット サイズ は共に 64 KB が推奨値となっておりますが、推奨値以下で運用いただいている場合はこの事象が発生しやすくなります。<br>推奨値以下の場合は、データベースの 1 ページあたりの書き込みが複数に分けられて書き込まれることから、必ずしも隣り合わせのセクションに書き込まれるとは限らないため、断片化が生じやすく、FAL のサイズも増加しやすくなります。</p><p>現在の NTFS アロケーション ユニット サイズは以下のコマンドにて確認が可能です。</p><h3 id="手順"><a href="#手順" class="headerlink" title="手順"></a>手順</h3><ol><li><p>コマンド プロンプトを管理者権限で起動します。</p></li><li><p>以下のコマンドを実行します。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fsutil fsinfo ntfsinfo &lt;ドライブ レター&gt;:</span><br></pre></td></tr></table></figure><p>例) </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fsutil fsinfo ntfsinfo F:</span><br></pre></td></tr></table></figure></li><li><p>“クラスターあたりのバイト数” (英語の場合は Bytes Per Cluster) より現在の NTFS アロケーション ユニット サイズを確認します。</p><p><img src="2016121401.jpg" alt=""></p></li></ol><p>&nbsp;<br>また、以下のブログにて Exchange 2007 についてではありますが、本事象についての詳細をご紹介しています。</p><p>Title: How fragmentation on incorrectly formatted NTFS volumes affects Exchange<br>URL: <a href="https://blogs.technet.microsoft.com/mikelag/2011/02/09/how-fragmentation-on-incorrectly-formatted-ntfs-volumes-affects-exchange/" target="_blank" rel="noopener">https://blogs.technet.microsoft.com/mikelag/2011/02/09/how-fragmentation-on-incorrectly-formatted-ntfs-volumes-affects-exchange/</a></p><p>※ 本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Exchange Serverをご利用のお客様より、最近お問い合わせが増加傾向にある NTFS の FAL サイズ制限について事象と対処策についてご紹介します。&lt;/p&gt;
&lt;h2 id=&quot;事象概要&quot;&gt;&lt;a href=&quot;#事象概要&quot; class=&quot;headerlink&quot; tit
      
    
    </summary>
    
    
    
      <category term="Exchange" scheme="https://jpmessaging.github.io/blog/tags/Exchange/"/>
    
  </entry>
  
  <entry>
    <title>PowerShell の文字列について
</title>
    <link href="https://jpmessaging.github.io/blog/PowerShell%20%E3%81%AE%E6%96%87%E5%AD%97%E5%88%97%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6/"/>
    <id>https://jpmessaging.github.io/blog/PowerShell%20%E3%81%AE%E6%96%87%E5%AD%97%E5%88%97%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6/</id>
    <published>2016-10-11T15:00:00.000Z</published>
    <updated>2020-06-03T03:05:04.076Z</updated>
    
    <content type="html"><![CDATA[<p>日頃から PowerShell をご利用いただいている場合にはご存じかと思いますが、PowerShell では “ と ‘ はどちらも文字列を表現する際に利用されますが、これらは異なる動作をします。<br>具体的には “ (ダブル クォーテーション) はその中で $ 記号を見つけた場合にはそれを変数として評価しその値で置き換えますが、’ (シングル クォーテーション) はそういった動作はせずそのまま文字通り文字列として扱います。</p><p>例えば、以下のような場合 “hello $name” の値は、まず $name の値である ‘world’ に置きかえられるため、”hello world” となります。一方、’hello $name’ は文字通りの “hello $name” という文字列となります。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">　<span class="variable">$name</span> = <span class="string">'world'</span></span><br><span class="line">　<span class="string">"hello <span class="variable">$name</span>"</span>  <span class="comment"># hello world</span></span><br><span class="line">　<span class="string">'hello $name'</span>  <span class="comment"># hello $name</span></span><br></pre></td></tr></table></figure><p>なお、ドット (.) は変数名の一部とはならないため、オブジェクトのプロパティ値を評価させる場合には、$() で囲ってあげる必要があります。</p><p>例えば以下の例で、対象ユーザーの PrimarySmtpAddress の値に置き換えたい場合には $mailbox.PrimarySmtpAddress を評価させるために $($mailbox.PrimarySmtpAddress) と記載する必要があります。[意図した結果とならない例] のようにそのまま $mailbox.PrimarySmtpAddress と記載すると $mailbox のみが評価されてしまいます。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">　<span class="variable">$mailbox</span> = <span class="built_in">Get-Mailbox</span> <span class="string">"user01"</span></span><br><span class="line"></span><br><span class="line">　<span class="comment"># 意図した結果とならない例:</span></span><br><span class="line">　<span class="string">"PrimarySmtpAddress is <span class="variable">$mailbox</span>.PrimarySmtpAddress"</span> <span class="comment"># PrimarySmtpAddress is user01.PrimarySmtpAddress</span></span><br><span class="line"></span><br><span class="line">　<span class="comment"># 意図した結果となる例:</span></span><br><span class="line">　<span class="string">"PrimarySmtpAddress is <span class="variable">$</span>(<span class="variable">$mailbox</span>.PrimarySmtpAddress)"</span> <span class="comment"># PrimarySmtpAddress is user01@contoso.local</span></span><br></pre></td></tr></table></figure><p>上記の話は一般的な PowerShell の話ですが、Exchange にどのように関係するかというと、Message-ID には ‘$’ が含まれる場合があるということです。</p><p>例えば以下のように $ が含まれる Mesasage-ID を “” で囲んでコマンドレットを実行しても意図した結果は得られません。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">　<span class="built_in">Get-MessageTrackingLog</span> <span class="literal">-MessageId</span>:<span class="string">"&lt;9AEF1E3F63BB44C<span class="variable">$96149F133C253F20</span>@test&gt;"</span></span><br></pre></td></tr></table></figure><p>なぜなら <code>&quot;&lt;9AEF1E3F63BB44C$96149F133C253F20@test&gt;&quot;</code> の値は実際には、<code>&quot;&lt;9AEF1E3F63BB44C@test&gt;&quot;</code> となるためです (この例の場合、<code>$96149F133C253F20</code> が変数として評価されますがこのような変数は定義されていないので、値は $null となります)。</p><p>この場合には、’ ‘ を利用することで正しいコマンドとなります。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">　<span class="built_in">Get-MessageTrackingLog</span> <span class="literal">-MessageId</span>:<span class="string">'&lt;9AEF1E3F63BB44C$96149F133C253F20@test&gt;'</span></span><br></pre></td></tr></table></figure><p>上記のように文字列中に $ が含まれる可能性がある場合などには、” と ‘ を正しく使い分ける必要があるためご注意ください。<br>※本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;日頃から PowerShell をご利用いただいている場合にはご存じかと思いますが、PowerShell では “ と ‘ はどちらも文字列を表現する際に利用されますが、これらは異なる動作をします。&lt;br&gt;具体的には “ (ダブル クォーテーション) はその中で $ 記号を
      
    
    </summary>
    
    
    
      <category term="Exchange" scheme="https://jpmessaging.github.io/blog/tags/Exchange/"/>
    
  </entry>
  
  <entry>
    <title>Exchange Online と Outlook の認証キャッシュについて
</title>
    <link href="https://jpmessaging.github.io/blog/Exchange%20Online%20%E3%81%A8%20Outlook%20%E3%81%AE%E8%AA%8D%E8%A8%BC%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6/"/>
    <id>https://jpmessaging.github.io/blog/Exchange%20Online%20%E3%81%A8%20Outlook%20%E3%81%AE%E8%AA%8D%E8%A8%BC%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6/</id>
    <published>2016-07-13T15:00:00.000Z</published>
    <updated>2020-06-03T03:05:04.060Z</updated>
    
    <content type="html"><![CDATA[<p>ADFS (Active Directory Federation Services) やサード パーティーの ID プロバイダーを使用するシングル サインインの構成においては、Outlook クライアントから Exchange Online に接続をする際に、認証処理のためにこれらの認証サーバーに対して問い合わせが発生します。(シングル サインオンを利用しない場合は Office 365 の Azure AD にて認証処理が完結しています。)<br>しかしながら、クラウド サービス側やクライアント側で認証処理に成功したキャッシュが残っている場合は、認証サーバーへの問い合わせを省き、過去の認証キャッシュを利用して接続を完了させる動作がございます。</p><p>今回はこの認証キャッシュの動作について説明します。「従来の認証の場合」 そして 「先進認証 (Modern Authentication) の場合」 の 2 つに分けてご紹介します。</p><h2><strong>従来の認証の場合</strong></h2>Exchange Online の動作として、最大 24 時間キャッシュを保存します。サーバー側で保持できる容量を超えた場合に古いキャッシュから削除されることから、Exchange Online のサーバー側の使用状況によって保持時間は異なります。その他 Outlook と Exchange Online の接続において認証キャッシュが使用できる条件は複合的な要素を含むため、すべてのシナリオを標準化してご案内することは困難ですが、実際に認証キャッシュが使用できる期間は24 時間以内で前後します。<p>また、前述の通り Exchange Online 側で保持する認証キャッシュが有効な間は、認証サーバー (ADFS など) の認証なしでログインすることができます。</p><p>以下は認証フローの参考図となります。</p><p><strong>* クライアントからのアクセスを受けてトークンの要求と発行が行われる動作にフォーカスして簡略化した図となります。</strong></p><a href="media/2016/07/flow01_n.png"><p><img src="flow01_n.png" alt=""><br></a></p><h2><strong>先進認証 (Modern Authentication) の場合</strong></h2>下記の公開情報に記載があります 「先進認証 (Modern Authentication)」 を利用される場合は、認証成功時にクライアント側に保存されるトークン情報によって認証サーバーへの問い合わせをせずに、Exchange Online にアクセスすることができます。このトークンの有効期間については公開情報内の 「Azure Active Directory (先進認証が有効である Office 2013 Windows クライアントにより使用される)」 をご確認ください。<p style="padding-left: 2em">Title: Office 365 のセッション タイムアウト<br/>URL: <a href="https://support.office.com/ja-jp/article/37a5c116-5b07-4f70-8333-5b86fd2c3c40" target="_blank" rel="noopener">https://support.office.com/ja-jp/article/37a5c116-5b07-4f70-8333-5b86fd2c3c40</a></p>なお、先進認証においてクライアントが再認証なしでアクセスし続けられる期間の長さはアクセス トークン (リフレッシュ トークンによる再更新を含む) の有効性に依存し、Exchange Online や Office 365 側の認証キャッシュ期間は、このトークンの有効期間に対して影響しません。<p>以下は先進認証の認証フローの参考図となります。</p><p><strong>* 前項の図との比較のために、簡略化した図となります。実際には 「従来の認証」 と同様に 1 の前に Exchange Online へのアクセスが発生しますが、この図はその後のトークン取得の処理にフォーカスして記載しています。</strong><br><a href="media/2016/07/flow02_n.png"></p><p><img src="flow02_n.png" alt=""><br></a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ADFS (Active Directory Federation Services) やサード パーティーの ID プロバイダーを使用するシングル サインインの構成においては、Outlook クライアントから Exchange Online に接続をする際に、認証処理のた
      
    
    </summary>
    
    
    
      <category term="EXO" scheme="https://jpmessaging.github.io/blog/tags/EXO/"/>
    
  </entry>
  
  <entry>
    <title>トランザクション ログが削除されずにディスク領域が圧迫されたときの対処方法
</title>
    <link href="https://jpmessaging.github.io/blog/%E3%83%88%E3%83%A9%E3%83%B3%E3%82%B6%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%20%E3%83%AD%E3%82%B0%E3%81%8C%E5%89%8A%E9%99%A4%E3%81%95%E3%82%8C%E3%81%9A%E3%81%AB%E3%83%87%E3%82%A3%E3%82%B9%E3%82%AF%E9%A0%98%E5%9F%9F%E3%81%8C%E5%9C%A7%E8%BF%AB%E3%81%95%E3%82%8C%E3%81%9F%E3%81%A8%E3%81%8D%E3%81%AE%E5%AF%BE%E5%87%A6%E6%96%B9%E6%B3%95/"/>
    <id>https://jpmessaging.github.io/blog/%E3%83%88%E3%83%A9%E3%83%B3%E3%82%B6%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%20%E3%83%AD%E3%82%B0%E3%81%8C%E5%89%8A%E9%99%A4%E3%81%95%E3%82%8C%E3%81%9A%E3%81%AB%E3%83%87%E3%82%A3%E3%82%B9%E3%82%AF%E9%A0%98%E5%9F%9F%E3%81%8C%E5%9C%A7%E8%BF%AB%E3%81%95%E3%82%8C%E3%81%9F%E3%81%A8%E3%81%8D%E3%81%AE%E5%AF%BE%E5%87%A6%E6%96%B9%E6%B3%95/</id>
    <published>2016-06-29T15:00:00.000Z</published>
    <updated>2020-06-03T03:05:04.080Z</updated>
    
    <content type="html"><![CDATA[<p>Exchange Server ではデータベースへの変更が行われる際に、まず初めにトランザクション ログにその変更内容が記録され、その後、その内容がデータベースへ書き込まれます。このため、例えばあるタイミングで採取したバックアップ ファイルと、それ以降のトランザクション ログがあれば、トランザクション ログをバックアップしたデータベース ファイルに反映させることで、最新の状態にすることが可能です。</p><p>トランザクション ログはデータベースの更新があるたびに記録されるため、一般的に多くのログが出力されます。<br>日々 Exchange Server をご利用いただく中で、トランザクション ログによるディスクの空き容量が圧迫されることを防止するため、一般的には以下のいずれかを実行し、古いトランザクション ログを削除いただいているかと存じます。</p><ul><li>バックアップを採取する。</li><li>データベースの循環ログを有効にする。</li></ul><p>トランザクション ログの詳しい説明や上記を実施することでどのようにトランザクション ログが削除されるのかについての説明は割愛させていただきますが、何らかの要因でトランザクション ログの削除がされなくなり、気が付いた時にはディスクの空き領域が圧迫され、データベースがマウントできなくなった、というお問合せを多くいただきます。</p><p>今回のブログでは、データベースへ反映済みのトランザクション ログを確認し、別のディスクへ移動や削除しても問題ないトランザクション ログを判断する方法についてご案内いたします。</p><h2 id="データベースへ反映済みのトランザクション-ログの確認方法"><a href="#データベースへ反映済みのトランザクション-ログの確認方法" class="headerlink" title="データベースへ反映済みのトランザクション ログの確認方法"></a>データベースへ反映済みのトランザクション ログの確認方法</h2><p>トランザクション ログと同じフォルダにあるチェックポイント ファイル (.chk ファイル) を確認することで、データベースへ反映されているトランザクション ログを確認することが可能です。以下の手順は、Exchange 2007, Exchange 2010, Exchange 2013, Exchange 2016 といずれのバージョンでも同様となります。</p><p><strong>確認手順</strong></p><ol><li><p>Exchange サーバーで Exchange 管理シェルを起動します。</p></li><li><p>次のコマンドを実行し、チェックポイント ファイルの情報を表示します。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Eseutil &#x2F;mk &quot;chk ファイル名の絶対パス&quot;</span><br></pre></td></tr></table></figure><p>実行例:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Eseutil &#x2F;mk &quot;E:\Exchange Server\V15\Mailbox\MDB01\E01.chk&quot;</span><br></pre></td></tr></table></figure><p>※ チェックポイント ファイルは、トランザクション ログが格納されているフォルダにあります。</p></li><li><p>上記のコマンドを実行すると、以下のような出力が返されますので、”Checkpoint” の内容を確認します。</p><p>表示例 (Exchange 2013 の場合)</p><p><img src="0630.jpg" alt=""></p></li></ol><p>上述の例では、<code>Checkpoint: (0x1281, 1, 0)</code> となっており、トランザクション ログ番号の 0x1280 までデータベースに反映済みであることを示しています。トランザクション ログ ファイル名は、Exchange 2007 以降ではプレフィックス+ &lt;8桁のログ番号&gt; となります。上記の例ではプレフィックスが E01 であるため、E0100001280.log までがコミット済みであり、E0100001280.log までのログを別のディスクへ移動や削除をすることができます。</p><p>※ ログ番号とファイル名は 16 進数となっているため、ファイル名でソートするとログの順番どおりには並びません。ソートする場合は更新日時にてソートください。</p><p>なお、Exchange 2010 以降の DAG を構成されている場合、データベース コピーを持っている各サーバーで手動でトランザクション ログの退避・削除をする必要がありますのでご注意ください。Active なデータベースを保持しているサーバーで対処を実施しても、Passive データベースを保持しているサーバー上でトランザクション ログが自動的に削除されることはありません。また、トランザクション ログの削除や移動を実施した場合、データベースのコピー状態で不整合が起きる可能性がございます。この場合は、容量圧迫の問題解決後、データベース コピーの再シードを実施くださいますようお願いいたします。</p><p>※本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Exchange Server ではデータベースへの変更が行われる際に、まず初めにトランザクション ログにその変更内容が記録され、その後、その内容がデータベースへ書き込まれます。このため、例えばあるタイミングで採取したバックアップ ファイルと、それ以降のトランザクション ロ
      
    
    </summary>
    
    
    
      <category term="Exchange" scheme="https://jpmessaging.github.io/blog/tags/Exchange/"/>
    
  </entry>
  
  <entry>
    <title>よくわかる Exchange Online のメッセージ追跡 ～ Part 1 取得編 ～
</title>
    <link href="https://jpmessaging.github.io/blog/%E3%82%88%E3%81%8F%E3%82%8F%E3%81%8B%E3%82%8B%20Exchange%20Online%20%E3%81%AE%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E8%BF%BD%E8%B7%A1%20%EF%BD%9E%20Part%201%20%E5%8F%96%E5%BE%97%E7%B7%A8%20%EF%BD%9E/"/>
    <id>https://jpmessaging.github.io/blog/%E3%82%88%E3%81%8F%E3%82%8F%E3%81%8B%E3%82%8B%20Exchange%20Online%20%E3%81%AE%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E8%BF%BD%E8%B7%A1%20%EF%BD%9E%20Part%201%20%E5%8F%96%E5%BE%97%E7%B7%A8%20%EF%BD%9E/</id>
    <published>2016-02-22T15:00:00.000Z</published>
    <updated>2020-06-03T03:05:04.076Z</updated>
    
    <content type="html"><![CDATA[<p>みなさんこんにちは、Exchange Server サポートの 杉山 卓弥 です。Exchange Online で送受信されているメッセージを調査する場合、管理者にてメッセージ追跡を実行する機会は非常に多いかと思います。そこで、メッセージ追跡に役立つ情報を順次 Exchange Server サポートよりご紹介していきます。Part 1 では、Exchange Online のメッセージ追跡の実行方法、取得方法について使用頻度が高い順にご説明していきます。</p><p><span style="color: #3366ff">Exchange Server サポートからのお願い</span><br><span style="color: #3366ff"><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>****</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></span><br><span style="color: #3366ff">弊社サポートにメッセージ配信に関するお問い合わせをいただく際、メッセージ追跡ログをあらかじめ送付いただくことで、すぐに調査を開始することができます。また、事象の早期解決に結びつくことも多くございますので、事前の HistoricalSearch (詳細版) の取得にご協力をいただけますようお願いいたします。</span><br><span style="color: #3366ff"><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>****</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></span></p><p>&lt;取得方法&gt;<br>A. HistoricalSearch (詳細版)<br>B. MessageTrace (詳細版)<br>C. MessageTrace (要約版)<br>D. HistoricalSearch (要約版)</p><p>&lt;事前準備&gt;<br>Windows Powershell から Exchange Online に接続します。</p><p>Title: リモート PowerShell による Exchange への接続<br>URL: <a target="_blank" href="https://technet.microsoft.com/library/jj984289(v=exchg.160).aspx" rel="noopener">https://technet.microsoft.com/library/jj984289(v=exchg.160).aspx</a></p><p>==================<br>A. HistoricalSearch (詳細版)<br>==================<br>使用頻度 : ★★★<br>詳細度 : ★★★<br>実行時間 : ★☆☆ (長い)<br>取得可能期間 : ★★★ (過去 90 日)</p><p>特徴 :<br>過去 7 日以上経過した単一または複数のメッセージをイベント単位で最も詳細に調査する場合に有効です。弊社サポートで特定のメッセージを調査する際にもご依頼をしている方法です。</p><p>取得方法 :</p><ol><li>メッセージ追跡 (HistoricalSearch) を開始します。</li></ol><p>&lt;送信者、受信者を指定して実行する場合&gt;<br>Start-HistoricalSearch -ReportTitle &lt;任意の実行名&gt; -StartDate yyyy/mm/dd -EndDate yyyy/mm/dd -SenderAddress &lt;送信者メールアドレス&gt; -RecipientAddress &lt;受信者メールアドレス&gt; -ReportType MessageTraceDetail -NotifyAddress &lt;通知メールアドレス&gt;</p><p>&lt;メッセージ ID を指定して実行する場合&gt;<br>Start-HistoricalSearch -ReportTitle &lt;任意の実行名&gt; -StartDate yyyy/mm/dd -EndDate yyyy/mm/dd -MessageID “&lt;メッセージ ID&gt;” -ReportType MessageTraceDetail -NotifyAddress &lt;通知メールアドレス&gt;</p><p><span style="color: #ff0000"># パラメーターの StartDate および EndDate は協定世界時 (UTC) を基準としています。日本標準時 (JST) での受信時刻とは異なりますので、例えば、2016/02/22 (JST) に受信した場合は、StartDate を 2016/02/21、EndDate を 2016/02/23 と指定することをお勧めします。</span></p><ol start="2"><li>実行後に表示された JobId を控えておき、以下のコマンドを実行して Status が Done となっていることを確認します。<br>Status が Done となるまでには数時間かかる場合があるので、以下のコマンドは Start-HistoricalSearch でのメッセージ追跡開始後、しばらく時間が経ってから実行することをお勧めします。</li></ol><p>Get-HistoricalSearch -JobId “xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx” | FL</p><ol start="3"><li>該当の JobId の Status が Done となったら、FileUrl に記載されている URL より CSV 形式のメッセージ追跡ログをダウンロードします。<br>URL アクセス時に証明書の警告画面が表示された場合には、[キャンセル] を押して処理を進めます。</li></ol><p>注意点 :</p><p>1) 1 日経過しても Status が Done とならない場合には、再度新しく HistoricalSearch を作成、開始いただけますようお願いいたします。<br>2) 手順 3 にて CSV 形式のメッセージ追跡ログをダウンロードできる回数には制限があります。2018年3月時点では ダウンロード回数が20 回を超えると以下のエラーとなります。<br>—– ここから —-<br>503<br>サーバーがビジー状態です<br>サービスはビジー状態です。しばらくしてからもう一度やり直してください。<br>—– ここまで —-<br>エラーとなる場合は、再度手順 1 からメッセージ追跡の手順を実施ください。</p><p>&nbsp;</p><p>================<br>B. MessageTrace (詳細版)<br>================<br>使用頻度 : ★★☆<br>詳細度 : ★★☆<br>実行時間 : ★★★ (短い)<br>取得可能期間 : ★☆☆ (過去 7 日)</p><p>特徴 :<br>単一または複数のメッセージをイベント単位で調査する場合に有効です。管理者にてコネクタの経由状況やトランスポート ルールの適用状況を確認することができます。</p><p>取得方法 :<br>&lt;送信者、受信者を指定して実行する場合&gt;<br>Get-MessageTrace -StartDate yyyy/mm/dd -EndDate yyyy/mm/dd -SenderAddress &lt;送信者メールアドレス&gt; -RecipientAddress &lt;受信者メールアドレス&gt; | Get-MessageTraceDetail | Export-Csv -Path C:&amp;lt;フォルダー名&gt;&amp;lt;ファイル名&gt;.csv -Encoding UTF8 -NoTypeInformation</p><p>&lt;メッセージ ID を指定して実行する場合&gt;<br>Get-MessageTrace -StartDate yyyy/mm/dd -EndDate yyyy/mm/dd -MessageId “&lt;メッセージ ID&gt;” | Get-MessageTraceDetail | Export-Csv -Path C:&amp;lt;フォルダー名&gt;&amp;lt;ファイル名&gt;.csv -Encoding UTF8 -NoTypeInformation</p><p>注意点 :<br>パラメーターの StartDate および EndDate は協定世界時 (UTC) を基準としています。日本標準時 (JST) での受信時刻とは異なりますので、例えば、2016/02/22 (JST) に受信した場合は、StartDate を 2016/02/21、EndDate を 2016/02/23 と指定することをお勧めします。</p><p>================<br>C. MessageTrace (要約版)<br>================<br>使用頻度 : ★★☆<br>詳細度 : ★☆☆<br>実行時間 : ★★★ (短い)<br>取得可能期間 : ★☆☆ (過去 7 日)</p><p>特徴 :<br>多数のメッセージの最終配信ステータスや送信元 IP などを調査する場合に有効な方法です。管理者にてメッセージの配送状況を一覧形式で確認することができます。</p><p>取得方法 :<br>&lt;送信者、受信者を指定して実行する場合&gt;<br>Get-MessageTrace -StartDate yyyy/mm/dd -EndDate yyyy/mm/dd -SenderAddress &lt;送信者メールアドレス&gt; -RecipientAddress &lt;受信者メールアドレス&gt; | Export-Csv -Path C:&amp;lt;フォルダー名&gt;&amp;lt;ファイル名&gt;.csv -Encoding UTF8 -NoTypeInformation</p><p>&lt;メッセージ ID を指定して実行する場合&gt;<br>Get-MessageTrace -StartDate yyyy/mm/dd -EndDate yyyy/mm/dd -MessageId “&lt;メッセージ ID&gt;” | Export-Csv -Path C:&amp;lt;フォルダー名&gt;&amp;lt;ファイル名&gt;.csv -Encoding UTF8 -NoTypeInformation</p><p>注意点 :<br>パラメーターの StartDate および EndDate は協定世界時 (UTC) を基準としています。日本標準時 (JST) での受信時刻とは異なりますので、例えば、2016/02/22 (JST) に受信した場合は、StartDate を 2016/02/21、EndDate を 2016/02/23 と指定することをお勧めします。</p><p>================<br>D. HistoricalSearch (要約版)<br>==================<br>使用頻度 : ★☆☆<br>詳細度 : ★☆☆<br>実行時間 : ★☆☆ (長い)<br>取得可能期間 : ★★★ (過去 90 日)</p><p>特徴 :<br>過去 7 日以上経過した多数のメッセージのイベント概要や送信元 IP を調査する場合に有効な方法です。管理者にてメッセージの配送状況を一覧形式で確認することができます。</p><p>取得方法 :</p><ol><li>メッセージ追跡 (HistoricalSearch) を開始します。</li></ol><p>&lt;送信者、受信者を指定して実行する場合&gt;<br>Start-HistoricalSearch -ReportTitle &lt;任意の実行名&gt; -StartDate yyyy/mm/dd -EndDate yyyy/mm/dd -SenderAddress &lt;送信者メールアドレス&gt; -RecipientAddress &lt;受信者メールアドレス&gt; -ReportType MessageTrace  -NotifyAddress &lt;通知メールアドレス&gt;</p><p>&lt;メッセージ ID を指定して実行する場合&gt;<br>Start-HistoricalSearch -ReportTitle &lt;任意の実行名&gt; -StartDate yyyy/mm/dd -EndDate yyyy/mm/dd -MessageID “&lt;メッセージ ID&gt;” -ReportType MessageTrace -NotifyAddress &lt;通知メールアドレス&gt;</p><p><span style="color: #ff0000"># パラメーターの StartDate および EndDate は協定世界時 (UTC) を基準としています。日本標準時 (JST) での受信時刻とは異なりますので、例えば、2016/02/22 (JST) に受信した場合は、StartDate を 2016/02/21、EndDate を 2016/02/23 と指定することをお勧めします。</span></p><ol start="2"><li>実行後に表示された JobId を控えておき、以下のコマンドを実行して Status が Done となっていることを確認します。<br>Status が Done となるまでには数時間かかる場合があるので、以下のコマンドは Start-HistoricalSearch でのメッセージ追跡開始後、しばらく時間が経ってから実行することをお勧めします。</li></ol><p>Get-HistoricalSearch -JobId “xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx” | FL</p><ol start="3"><li>該当の JobId の Status が Done となったら、FileUrl に記載されている URL より CSV 形式のメッセージ追跡ログをダウンロードします。<br>URL アクセス時に証明書の警告画面が表示された場合には、[キャンセル] を押して処理を進めます。</li></ol><p>注意点 :</p><p>1) 1 日経過しても Status が Done とならない場合には、再度新しく HistoricalSearch を作成、開始いただけますようお願いいたします。<br>2) 手順 3 にて CSV 形式のメッセージ追跡ログをダウンロードできる回数には制限があります。2018年3月時点では ダウンロード回数が20 回を超えると以下のエラーとなります。<br>—– ここから —-<br>503<br>サーバーがビジー状態です<br>サービスはビジー状態です。しばらくしてからもう一度やり直してください。<br>—– ここまで —-<br>エラーとなる場合は、再度手順 1 からメッセージ追跡の手順を実施ください。</p><p>&nbsp;</p><p>&lt;参考リンク&gt;<br>Title: メッセージの追跡を実行し、結果を表示する<br>URL: <a target="_blank" href="https://technet.microsoft.com/ja-jp/library/jj200712(v=exchg.160).aspx" rel="noopener">https://technet.microsoft.com/ja-jp/library/jj200712(v=exchg.160).aspx</a></p><p>Title: Start-HistoricalSearch<br>URL: <a target="_blank" href="https://technet.microsoft.com/ja-jp/library/dn621132(v=exchg.160).aspx" rel="noopener">https://technet.microsoft.com/ja-jp/library/dn621132(v=exchg.160).aspx</a></p><p>Title: Get-MessageTrace<br>URL: <a target="_blank" href="https://technet.microsoft.com/ja-jp/library/jj200704(v=exchg.160).aspx" rel="noopener">https://technet.microsoft.com/ja-jp/library/jj200704(v=exchg.160).aspx</a></p><p>Title: Get-MessageTraceDetail<br>URL: <a target="_blank" href="https://technet.microsoft.com/ja-jp/library/jj200681(v=exchg.160).aspx" rel="noopener">https://technet.microsoft.com/ja-jp/library/jj200681(v=exchg.160).aspx</a></p><hr><p>本記事は 2016 年 2 月 22 日時点で執筆されたものであり、ご紹介したコマンドの動作、機能は今後変更される場合がございます。</p><hr>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;みなさんこんにちは、Exchange Server サポートの 杉山 卓弥 です。Exchange Online で送受信されているメッセージを調査する場合、管理者にてメッセージ追跡を実行する機会は非常に多いかと思います。そこで、メッセージ追跡に役立つ情報を順次 Excha
      
    
    </summary>
    
    
    
      <category term="EXO" scheme="https://jpmessaging.github.io/blog/tags/EXO/"/>
    
  </entry>
  
  <entry>
    <title>Exchange 2013 を強制的にアンインストールする
</title>
    <link href="https://jpmessaging.github.io/blog/Exchange%202013%20%E3%82%92%E5%BC%B7%E5%88%B6%E7%9A%84%E3%81%AB%E3%82%A2%E3%83%B3%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B/"/>
    <id>https://jpmessaging.github.io/blog/Exchange%202013%20%E3%82%92%E5%BC%B7%E5%88%B6%E7%9A%84%E3%81%AB%E3%82%A2%E3%83%B3%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B/</id>
    <published>2016-02-16T15:00:00.000Z</published>
    <updated>2020-06-03T03:05:04.058Z</updated>
    
    <content type="html"><![CDATA[<p><br>&#12371;&#12435;&#12395;&#12385;&#12399;&#12290;Exchange &#12469;&#12509;&#12540;&#12488; &#12481;&#12540;&#12512;&#12398;&#23567;&#38291;&#12391;&#12377;&#12290;<br>&#20170;&#22238;&#12399;&#12289;&#12420;&#12416;&#12434;&#12360;&#12394;&#12356;&#20107;&#24773;&#12395;&#12424;&#12387;&#12390; Exchange 2013 &#12434;&#24375;&#21046;&#30340;&#12395;&#12450;&#12531;&#12452;&#12531;&#12473;&#12488;&#12540;&#12523;&#12377;&#12427;&#24517;&#35201;&#12364;&#29983;&#12376;&#12383;&#22580;&#21512;&#12398;&#23550;&#20966;&#26041;&#27861;&#12434;&#12372;&#26696;&#20869;&#12356;&#12383;&#12375;&#12414;&#12377;&#12290;<p>&#12371;&#12398;&#12502;&#12525;&#12464;&#35352;&#20107;&#12399;&#12289;2014&#24180; 9&#26376;30&#26085;&#12395;&#20844;&#38283;&#12373;&#12428;&#12390;&#12356;&#12383;&#20197;&#19979;&#12398;&#35352;&#20107;&#12398;&#26356;&#26032;&#29256;&#12391;&#12377;&#12290;</p><p>TITLE: Exchange 2013 &#12391;&#20877;&#12475;&#12483;&#12488;&#12450;&#12483;&#12503; (&#12450;&#12531;&#12452;&#12531;&#12473;&#12488;&#12540;&#12523;&#24460;&#12398;&#12452;&#12531;&#12473;&#12488;&#12540;&#12523;) &#12395;&#22833;&#25943;&#12377;&#12427;<br>URL: <a href="/b/exchangeteamjp/archive/2014/09/30/3638445.aspx" target="_blank">http://blogs.technet.com/b/exchangeteamjp/archive/2014/09/30/3638445.aspx<span> </span></a></p><p style="margin:0mm 0mm 0pt;">Exchange &#12469;&#12540;&#12496;&#12540;&#12434;&#12450;&#12531;&#12452;&#12531;&#12473;&#12488;&#12540;&#12523;&#12377;&#12427;&#22580;&#21512;&#12289;&#12469;&#12509;&#12540;&#12488;&#12373;&#12428;&#12427;&#26041;&#27861;&#12399;&#12289;&#12467;&#12531;&#12488;&#12525;&#12540;&#12523; &#12497;&#12493;&#12523;&#12363;&#12425;&#12454;&#12451;&#12470;&#12540;&#12489;&#12434;&#20351;&#29992;&#12375;&#12390;&#23550;&#35441;&#30340;&#12395;&#12450;&#12531;&#12452;&#12531;&#12473;&#12488;&#12540;&#12523;&#12377;&#12427;&#12363;&#12289;setup.exe &#12434;&#20351;&#29992;&#12375;&#12390;&#12467;&#12510;&#12531;&#12489;&#12521;&#12452;&#12531;&#12391;&#12450;&#12531;&#12452;&#12531;&#12473;&#12488;&#12540;&#12523;&#12434;&#12377;&#12427;&#26041;&#27861;&#12398; 2 &#12388;&#12392;&#12394;&#12426;&#12414;&#12377;&#12290;<br>&#12375;&#12363;&#12375;&#12394;&#12364;&#12425;&#12289;&#20363;&#12360;&#12400;&#12495;&#12540;&#12489;&#12454;&#12455;&#12450;&#38556;&#23475;&#12394;&#12393;&#12391; Exchange &#12469;&#12540;&#12496;&#12540;&#12398; OS &#12364;&#36215;&#21205;&#12391;&#12365;&#12394;&#12356;&#29366;&#27841;&#12398;&#22580;&#21512;&#12399;&#36890;&#24120;&#12398;&#12450;&#12531;&#12452;&#12531;&#12473;&#12488;&#12540;&#12523;&#25163;&#38918;&#12399;&#23455;&#26045;&#12391;&#12365;&#12394;&#12356;&#12383;&#12417;&#12289;&#24375;&#21046;&#30340;&#12395; Active Directory &#19978;&#12363;&#12425; Exchange &#12469;&#12540;&#12496;&#12540;&#12398;&#24773;&#22577;&#12434;&#21066;&#38500;&#12377;&#12427;&#24517;&#35201;&#12364;&#29983;&#12376;&#12414;&#12377;&#12290;</p><p>&#12381;&#12398;&#20182;&#12395;&#12418;&#12289;&#36942;&#21435;&#12395; Exchange &#12469;&#12540;&#12496;&#12540;&#12434;&#12452;&#12531;&#12473;&#12488;&#12540;&#12523;&#12375;&#12390;&#12356;&#12390;&#19968;&#24230;&#12450;&#12531;&#12452;&#12531;&#12473;&#12488;&#12540;&#12523;&#12375;&#12383;&#29872;&#22659;&#12395;&#25913;&#12417;&#12390; Exchange &#12469;&#12540;&#12496;&#12540;&#12434;&#12452;&#12531;&#12473;&#12488;&#12540;&#12523;&#12377;&#12427;&#12392;&#12365;&#12395;&#12289;&#20197;&#21069;&#12398;&#24773;&#22577;&#12364;&#27531;&#12387;&#12390;&#12362;&#12426;&#12452;&#12531;&#12473;&#12488;&#12540;&#12523;&#12395;&#22833;&#25943;&#12377;&#12427;&#22580;&#21512;&#12364;&#12354;&#12426;&#12414;&#12377;&#12290;<br>&#12381;&#12398;&#22580;&#21512;&#12395;&#12418;&#12289;&#24375;&#21046;&#30340;&#12395; Active Directory &#19978;&#12363;&#12425;&#27531;&#12387;&#12390;&#12356;&#12427; Exchange &#12469;&#12540;&#12496;&#12540;&#12398;&#24773;&#22577;&#12434;&#21066;&#38500;&#12377;&#12427;&#24517;&#35201;&#12364;&#29983;&#12376;&#12414;&#12377;&#12290;</p><p>&#12371;&#12428;&#12363;&#12425;&#29305;&#23450;&#12398; Exchange &#12469;&#12540;&#12496;&#12540;&#12434;&#24375;&#21046;&#30340;&#12395;&#12450;&#12531;&#12452;&#12531;&#12473;&#12488;&#12540;&#12523;&#12377;&#12427;&#26041;&#27861;&#12392;&#12289;Exchange &#32068;&#32340;&#12418;&#21547;&#12417;&#12390;&#20840;&#12390;&#12398; Exchange &#12469;&#12540;&#12496;&#12540;&#12434;&#24375;&#21046;&#30340;&#12395;&#12450;&#12531;&#12452;&#12531;&#12473;&#12488;&#12540;&#12523;&#12377;&#12427;&#26041;&#27861;&#12398; 2 &#12388;&#12434;&#12372;&#26696;&#20869;&#12356;&#12383;&#12375;&#12414;&#12377;&#12364;&#12289;&#12393;&#12385;&#12425;&#12418;&#36890;&#24120;&#12398;&#36939;&#29992;&#12391;&#34892;&#12358;&#25163;&#38918;&#12391;&#12399;&#12394;&#12356;&#12371;&#12392;&#12395;&#12372;&#27880;&#24847;&#12367;&#12384;&#12373;&#12356;&#12290;<br>&#29305;&#12395;&#36939;&#29992;&#29872;&#22659;&#12391;&#29305;&#23450;&#12398; Exchange &#12469;&#12540;&#12496;&#12540;&#12434;&#24375;&#21046;&#30340;&#12395;&#12450;&#12531;&#12452;&#12531;&#12473;&#12488;&#12540;&#12523;&#12377;&#12427;&#22580;&#21512;&#12399;&#12289;&#26082;&#23384;&#12398; Exchange &#12469;&#12540;&#12496;&#12540;&#12398;&#21205;&#20316;&#12395;&#24433;&#38911;&#12434;&#19982;&#12360;&#12427;&#21487;&#33021;&#24615;&#12364;&#12354;&#12427;&#12383;&#12417;&#12289;&#26908;&#35388;&#29872;&#22659;&#12391;&#21313;&#20998;&#12395;&#26908;&#35388;&#12375;&#12390;&#12356;&#12383;&#12384;&#12365;&#12414;&#12377;&#12424;&#12358;&#12362;&#39000;&#12356;&#12356;&#12383;&#12375;&#12414;&#12377;&#12290;<br>&#12414;&#12383;&#12289;&#20316;&#26989;&#12398;&#21069;&#12395;&#12399;&#24517;&#12378; Active Directory &#12398;&#12496;&#12483;&#12463;&#12450;&#12483;&#12503;&#12434;&#34892;&#12387;&#12390;&#12367;&#12384;&#12373;&#12356;&#12290;&#23455;&#26045;&#12375;&#12383;&#20316;&#26989;&#12398;&#20999;&#12426;&#25147;&#12375;&#12395;&#12399; Active Directory &#12398;&#12522;&#12473;&#12488;&#12450;&#12364;&#24517;&#35201;&#12392;&#12394;&#12426;&#12414;&#12377;&#12290;</p><p><span style="text-decoration:underline;">&#29305;&#23450;&#12398; Exchange &#12469;&#12540;&#12496;&#12540;&#12434;&#24375;&#21046;&#30340;&#12395;&#12450;&#12531;&#12452;&#12531;&#12473;&#12488;&#12540;&#12523;&#12377;&#12427;</span></p><p>&#12371;&#12398;&#25163;&#38918;&#12391;&#12399;&#12289;&#29305;&#23450;&#12398; Exchange &#12469;&#12540;&#12496;&#12540;&#12398;&#24773;&#22577;&#12434; Active Directory &#12363;&#12425;&#21066;&#38500;&#12375;&#12390;&#12289;&#24375;&#21046;&#30340;&#12395;&#12450;&#12531;&#12452;&#12531;&#12473;&#12488;&#12540;&#12523;&#12375;&#12414;&#12377;&#12290;<br>&#20316;&#26989;&#12434;&#38283;&#22987;&#12377;&#12427;&#21069;&#12395;&#12289;&#21487;&#33021;&#12394;&#38480;&#12426;&#20316;&#26989;&#23550;&#35937;&#12398;&#12469;&#12540;&#12496;&#12540;&#12364;&#20351;&#29992;&#12373;&#12428;&#12394;&#12356;&#12424;&#12358;&#12395;&#27083;&#25104;&#12434;&#34892;&#12387;&#12390;&#12367;&#12384;&#12373;&#12356;&#12290;<br>&#20363;&#12360;&#12400;&#12513;&#12540;&#12523;&#12508;&#12483;&#12463;&#12473;&#12434;&#21029;&#12398;&#12469;&#12540;&#12496;&#12540;&#12395;&#31227;&#21205;&#12375;&#12383;&#12426;&#12289;DAG &#12513;&#12531;&#12496;&#12540;&#12363;&#12425;&#21066;&#38500;&#12375;&#12383;&#12426;&#12289;&#36865;&#20449;&#12467;&#12493;&#12463;&#12479;&#12398;&#12477;&#12540;&#12473; &#12469;&#12540;&#12496;&#12540;&#12363;&#12425;&#21066;&#38500;&#12377;&#12427;&#12394;&#12393;&#12398;&#20316;&#26989;&#12364;&#24517;&#35201;&#12392;&#12394;&#12426;&#12414;&#12377;&#12290;</p><p>1.&nbsp;&#12450;&#12531;&#12452;&#12531;&#12473;&#12488;&#12540;&#12523;&#23550;&#35937;&#12398;&#12469;&#12540;&#12496;&#12540;&#12434;&#12471;&#12515;&#12483;&#12488;&#12480;&#12454;&#12531;&#12375;&#12414;&#12377;&#12290;<br>2.&nbsp;&#12489;&#12513;&#12452;&#12531; &#12467;&#12531;&#12488;&#12525;&#12540;&#12521;&#12540;&#12391;&#12300;ADSI &#12456;&#12487;&#12451;&#12479;&#12540;&#12301;&#12434;&#36215;&#21205;&#12375;&#12289;&#12300;&#27083;&#25104;&#12301;&#12497;&#12540;&#12486;&#12451;&#12471;&#12519;&#12531;&#12395;&#25509;&#32154;&#12375;&#12414;&#12377;&#12290;<br>3.&nbsp;&#27083;&#25104;&#12497;&#12540;&#12486;&#12451;&#12471;&#12519;&#12531;&#12395;&#23384;&#22312;&#12377;&#12427;&#20197;&#19979;&#12398;&#12458;&#12502;&#12472;&#12455;&#12463;&#12488;&#12434;&#21066;&#38500;&#12375;&#12414;&#12377;&#12290;Servers &#12467;&#12531;&#12486;&#12490;&#12395;&#12399;&#12450;&#12531;&#12452;&#12531;&#12473;&#12488;&#12540;&#12523;&#23550;&#35937;&#20197;&#22806;&#12398;&#12469;&#12540;&#12496;&#12540;&#12398;&#24773;&#22577;&#12418;&#12354;&#12427;&#12383;&#12417;&#12289;&#12450;&#12531;&#12452;&#12531;&#12473;&#12488;&#12540;&#12523;&#23550;&#35937;&#12398;&#12469;&#12540;&#12496;&#12540;&#12398;&#24773;&#22577;&#12398;&#12415;&#12434;&#21066;&#38500;&#12375;&#12414;&#12377;&#12290;</p><p>&nbsp; CN=Configuration,DC=&lt;domain&gt;,DC=&lt;com&gt;<br>&nbsp;&nbsp;&nbsp; CN=Services<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CN=Microsoft Exchange<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CN=&lt;&#32068;&#32340;&#21517;&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CN=Administrative Groups<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CN=Exchange Administrative Group (&lt;&#31649;&#29702;&#12464;&#12523;&#12540;&#12503;&#21517;&gt;)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CN=Servers<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CN=&lt;&#24375;&#21046;&#30340;&#12395;&#12450;&#12531;&#12452;&#12531;&#12473;&#12488;&#12540;&#12523;&#12377;&#12427;&#12469;&#12540;&#12496;&#12540;&gt;&nbsp; &lt;--- &#12371;&#12398;&#12458;&#12502;&#12472;&#12455;&#12463;&#12488;&#12434;&#21066;&#38500;&#12375;&#12414;&#12377;&#12290;</p><p><a href="media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/77/42/2350.1.png" original-url="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-77-42/2350.1.png"><p><img src="2350.1.png" alt=""><br></a>&nbsp;</p><p>4.&nbsp;&#12300;Active Directory &#12518;&#12540;&#12470;&#12540;&#12392;&#12467;&#12531;&#12500;&#12517;&#12540;&#12479;&#12540;&#12301;&#12434;&#36215;&#21205;&#12375;&#12414;&#12377;&#12290;<br>5.&nbsp;&#23550;&#35937;&#12469;&#12540;&#12496;&#12540;&#12398;&#12467;&#12531;&#12500;&#12517;&#12540;&#12479;&#12540; &#12458;&#12502;&#12472;&#12455;&#12463;&#12488;&#12434;&#21066;&#38500;&#12375;&#12414;&#12377;&#12290;&#26082;&#23450;&#12391;&#12399; Computers &#37197;&#19979;&#12395;&#23384;&#22312;&#12375;&#12414;&#12377;&#12290;<br>6.&nbsp;&#12300;DNS &#12510;&#12493;&#12540;&#12472;&#12515;&#12540;&#12301;&#12434;&#36215;&#21205;&#12375;&#12414;&#12377;&#12290;<br>7.&nbsp;&#23550;&#35937;&#12469;&#12540;&#12496;&#12540;&#12398;&#12524;&#12467;&#12540;&#12489; (A &#12524;&#12467;&#12540;&#12489;&#12392;&#12289;&#20316;&#25104;&#12375;&#12390;&#12356;&#12427;&#22580;&#21512;&#12399; PTR &#12524;&#12467;&#12540;&#12489;) &#12434;&#21066;&#38500;&#12375;&#12414;&#12377;&#12290;<br>8.&nbsp;&#12371;&#12398;&#20316;&#26989;&#12398;&#24433;&#38911;&#12391;&#12471;&#12473;&#12486;&#12512; &#12513;&#12540;&#12523;&#12508;&#12483;&#12463;&#12473;&#12364;&#30772;&#25613;&#12377;&#12427;&#21487;&#33021;&#24615;&#12364;&#12354;&#12427;&#12383;&#12417;&#12289;Exchange &#12469;&#12540;&#12496;&#12540;&#12398;&#26368;&#21021;&#12398;&#12452;&#12531;&#12473;&#12488;&#12540;&#12523;&#26178;&#12395;&#34892;&#12431;&#12428;&#12390;&#12356;&#12427; PrepareAD &#12434;&#24565;&#12398;&#12383;&#12417;&#20877;&#23455;&#34892;&#12375;&#12414;&#12377;&#12290;&#12467;&#12510;&#12531;&#12489; &#12503;&#12525;&#12531;&#12503;&#12488;&#12434;&#31649;&#29702;&#32773;&#27177;&#38480;&#12391;&#36215;&#21205;&#12375;&#12414;&#12377;&#12290;<br>9.&nbsp;cd &#12467;&#12510;&#12531;&#12489;&#12391;&#12289;Exchange &#12469;&#12540;&#12496;&#12540;&#12398;&#12452;&#12531;&#12473;&#12488;&#12540;&#12521;&#12540;&#12364;&#20445;&#23384;&#12373;&#12428;&#12390;&#12356;&#12427;&#12501;&#12457;&#12523;&#12480;&#12540;&#12408;&#31227;&#21205;&#12375;&#12414;&#12377;&#12290;<br>10.&nbsp;&#27425;&#12398;&#12467;&#12510;&#12531;&#12489;&#12434;&#23455;&#34892;&#12375;&#12414;&#12377;&#12290;<br>Setup.exe /PrepareAD /IAcceptExchangeServerLicenseTerms</p><p>&#20316;&#26989;&#12399;&#20197;&#19978;&#12391;&#23436;&#20102;&#12391;&#12377;&#12290;&#26082;&#23384;&#12398; Exchange &#12469;&#12540;&#12496;&#12540;&#12398;&#21033;&#29992;&#12395;&#24433;&#38911;&#12364;&#29983;&#12376;&#12390;&#12356;&#12394;&#12356;&#12363;&#12289;&#21205;&#20316;&#12434;&#12372;&#30906;&#35469;&#12367;&#12384;&#12373;&#12356;&#12290;</p><p><br><span style="text-decoration:underline;">&#12377;&#12409;&#12390;&#12398; Exchange &#12469;&#12540;&#12496;&#12540;&#12434;&#24375;&#21046;&#30340;&#12395;&#12450;&#12531;&#12452;&#12531;&#12473;&#12488;&#12540;&#12523;&#12377;&#12427;</span></p><p>&#12371;&#12398;&#25163;&#38918;&#12391;&#12399;&#12289;Exchange &#32068;&#32340;&#12418;&#21547;&#12417;&#12390;&#12377;&#12409;&#12390;&#12398; Exchange &#12469;&#12540;&#12496;&#12540;&#12398;&#24773;&#22577;&#12434; Active Directory &#12363;&#12425;&#21066;&#38500;&#12375;&#12390;&#12289;&#24375;&#21046;&#30340;&#12395;&#12450;&#12531;&#12452;&#12531;&#12473;&#12488;&#12540;&#12523;&#12375;&#12414;&#12377;&#12290;<br>&#20316;&#26989;&#12434;&#38283;&#22987;&#12377;&#12427;&#21069;&#12395;&#12289;&#21487;&#33021;&#12394;&#38480;&#12426; Exchange &#12469;&#12540;&#12496;&#12540;&#12364;&#20351;&#29992;&#12373;&#12428;&#12394;&#12356;&#12424;&#12358;&#12395;&#27083;&#25104;&#12434;&#34892;&#12387;&#12390;&#12367;&#12384;&#12373;&#12356;&#12290;&#20170;&#24460; Exchange &#12469;&#12540;&#12496;&#12540;&#12434;&#20877;&#12452;&#12531;&#12473;&#12488;&#12540;&#12523;&#12375;&#12383;&#22580;&#21512;&#12395;&#21839;&#38988;&#12364;&#29983;&#12376;&#12427;&#21487;&#33021;&#24615;&#12364;&#12354;&#12426;&#12414;&#12377;&#12290;<br>&#20363;&#12360;&#12400;&#12518;&#12540;&#12470;&#12540;&#12420;&#37197;&#24067;&#12464;&#12523;&#12540;&#12503;&#12398;&#12513;&#12540;&#12523;&#12434;&#12377;&#12409;&#12390;&#28961;&#21177;&#12395;&#12375;&#12390;&#12367;&#12384;&#12373;&#12356;&#12290;</p><p>1.&nbsp;&#12377;&#12409;&#12390;&#12398; Exchange &#12469;&#12540;&#12496;&#12540;&#12434;&#12471;&#12515;&#12483;&#12488;&#12480;&#12454;&#12531;&#12375;&#12414;&#12377;&#12290;<br>2.&nbsp;&#12489;&#12513;&#12452;&#12531; &#12467;&#12531;&#12488;&#12525;&#12540;&#12521;&#12540;&#12391;&#12300;ADSI &#12456;&#12487;&#12451;&#12479;&#12540;&#12301;&#12434;&#36215;&#21205;&#12375;&#12289;&#12300;&#27083;&#25104;&#12301;&#12497;&#12540;&#12486;&#12451;&#12471;&#12519;&#12531;&#12392;&#12300;&#26082;&#23450;&#12398;&#21517;&#21069;&#20184;&#12369;&#12467;&#12531;&#12486;&#12461;&#12473;&#12488;&#12301;&#12395;&#25509;&#32154;&#12375;&#12414;&#12377;&#12290;<br>3.&nbsp;&#27083;&#25104;&#12497;&#12540;&#12486;&#12451;&#12471;&#12519;&#12531;&#12363;&#12425;&#12289;Services &#12467;&#12531;&#12486;&#12490;&#37197;&#19979;&#12395;&#23384;&#22312;&#12377;&#12427; [Microsoft Exchange] &#12392; [Microsoft Exchange Autodiscover] &#12398; 2 &#12388;&#12434;&#21066;&#38500;&#12375;&#12414;&#12377;&#12290;</p><p>&nbsp; CN=Configuration,DC=&lt;domain&gt;,DC=&lt;com&gt;<br>&nbsp;&nbsp;&nbsp; CN=Services<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CN=Microsoft Exchange&nbsp; &lt;— &#12371;&#12398;&#12458;&#12502;&#12472;&#12455;&#12463;&#12488;&#12434;&#21066;&#38500;&#12375;&#12414;&#12377;&#12290;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CN=Microsoft Exchange Autodiscover&nbsp; &lt;— &#12371;&#12398;&#12458;&#12502;&#12472;&#12455;&#12463;&#12488;&#12434;&#21066;&#38500;&#12375;&#12414;&#12377;&#12290;</p><p><a href="media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/77/42/2642.2.png" original-url="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-77-42/2642.2.png"></p><p><img src="2642.2.png" alt=""><br></a>&nbsp;</p><p>4.&nbsp;&#24341;&#12365;&#32154;&#12365;&#12289;&#26082;&#23450;&#12398;&#21517;&#21069;&#20184;&#12369;&#12467;&#12531;&#12486;&#12461;&#12473;&#12488; (Users &#12467;&#12531;&#12486;&#12490;&#12394;&#12393;&#12364;&#12354;&#12427;&#22580;&#25152;) &#12363;&#12425;&#12289;&#12523;&#12540;&#12488;&#37197;&#19979;&#12395;&#23384;&#22312;&#12377;&#12427; [Microsoft Exchange Security Groups] &#12392; [Microsoft Exchange System Objects] &#12398; 2 &#12388;&#12434;&#21066;&#38500;&#12375;&#12414;&#12377;&#12290;</p><p>&nbsp; DC=&lt;domain&gt;,DC=&lt;com&gt;<br>&nbsp;&nbsp;&nbsp; (&#30465;&#30053;)<br>&nbsp;&nbsp;&nbsp; OU=Microsoft Exchange Security Groups&nbsp; &lt;— &#12371;&#12398;&#12458;&#12502;&#12472;&#12455;&#12463;&#12488;&#12434;&#21066;&#38500;&#12375;&#12414;&#12377;&#12290;<br>&nbsp;&nbsp;&nbsp; CN=Microsoft Exchange Security Objects&nbsp; &lt;— &#12371;&#12398;&#12458;&#12502;&#12472;&#12455;&#12463;&#12488;&#12434;&#21066;&#38500;&#12375;&#12414;&#12377;&#12290;</p><p><a href="media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/77/42/8132.3.png" original-url="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-77-42/8132.3.png"></p><p><img src="8132.3.png" alt=""><br></a>&nbsp;</p><p>5.&nbsp;&#12300;Active Directory &#12518;&#12540;&#12470;&#12540;&#12392;&#12467;&#12531;&#12500;&#12517;&#12540;&#12479;&#12540;&#12301;&#12434;&#36215;&#21205;&#12375;&#12414;&#12377;&#12290;<br>6.&nbsp;&#12471;&#12473;&#12486;&#12512; &#12513;&#12540;&#12523;&#12508;&#12483;&#12463;&#12473;&#12434;&#12377;&#12409;&#12390;&#21066;&#38500;&#12375;&#12414;&#12377;&#12290;&#21066;&#38500;&#23550;&#35937;&#12399; Users &#12467;&#12531;&#12486;&#12490;&#12395;&#12354;&#12427;&#20197;&#19979;&#12398;&#12450;&#12459;&#12454;&#12531;&#12488;&#12391;&#12377;&#12290;</p><p>-&nbsp;DiscoverySearchMailbox &#12391;&#22987;&#12414;&#12427;&#12450;&#12459;&#12454;&#12531;&#12488;<br>-&nbsp;FederatedEmail &#12391;&#22987;&#12414;&#12427;&#12450;&#12459;&#12454;&#12531;&#12488;<br>-&nbsp;Migration &#12391;&#22987;&#12414;&#12427;&#12450;&#12459;&#12454;&#12531;&#12488;<br>-&nbsp;SystemMailbox &#12391;&#22987;&#12414;&#12427;&#12450;&#12459;&#12454;&#12531;&#12488;</p><p>7.&nbsp;&#12377;&#12409;&#12390;&#12398; Exchange &#12469;&#12540;&#12496;&#12540;&#12398;&#12467;&#12531;&#12500;&#12517;&#12540;&#12479;&#12540; &#12458;&#12502;&#12472;&#12455;&#12463;&#12488;&#12434;&#21066;&#38500;&#12375;&#12414;&#12377;&#12290;&#26082;&#23450;&#12391;&#12399; Computers &#37197;&#19979;&#12395;&#23384;&#22312;&#12375;&#12414;&#12377;&#12290;<br>8.&nbsp;&#12300;DNS &#12510;&#12493;&#12540;&#12472;&#12515;&#12540;&#12301;&#12434;&#36215;&#21205;&#12375;&#12414;&#12377;&#12290;<br>9.&nbsp;&#12377;&#12409;&#12390;&#12398; Exchange &#12469;&#12540;&#12496;&#12540;&#12398;&#12524;&#12467;&#12540;&#12489; (A &#12524;&#12467;&#12540;&#12489;&#12392;&#12289;&#20316;&#25104;&#12375;&#12390;&#12356;&#12427;&#22580;&#21512;&#12399; PTR &#12524;&#12467;&#12540;&#12489;) &#12434;&#21066;&#38500;&#12375;&#12414;&#12377;&#12290;</p><p>&#20197;&#19978;&#12391;&#20316;&#26989;&#12399;&#23436;&#20102;&#12391;&#12377;&#12290;</p><p>&#12394;&#12362;&#12289;&#12377;&#12409;&#12390;&#12398; Exchange &#12469;&#12540;&#12496;&#12540;&#12434;&#24375;&#21046;&#30340;&#12395;&#12450;&#12531;&#12452;&#12531;&#12473;&#12488;&#12540;&#12523;&#12375;&#12383;&#24460;&#12391;&#12381;&#12398;&#32068;&#32340;&#12395; Exchange &#12469;&#12540;&#12496;&#12540;&#12434;&#20877;&#12452;&#12531;&#12473;&#12488;&#12540;&#12523;&#12377;&#12427;&#22580;&#21512;&#12289;&#21021;&#12417;&#12395; PrepareAD &#12434;&#24565;&#12398;&#12383;&#12417;&#25163;&#21205;&#12391;&#23455;&#34892;&#12377;&#12427;&#12371;&#12392;&#12434;&#25512;&#22888;&#12356;&#12383;&#12375;&#12414;&#12377;&#12290;<br>&#12371;&#12428;&#12395;&#12424;&#12426;&#12289;Exchange &#12469;&#12540;&#12496;&#12540;&#12434;&#12452;&#12531;&#12473;&#12488;&#12540;&#12523;&#12377;&#12427;&#12383;&#12417;&#12395;&#24517;&#35201;&#12394;&#12458;&#12502;&#12472;&#12455;&#12463;&#12488;&#12364;&#20877;&#20316;&#25104;&#12373;&#12428;&#12414;&#12377;&#12290;<br>&#25163;&#38918;&#12399;&#20197;&#19979;&#12398;&#36890;&#12426;&#12391;&#12377;&#12290;</p><p>1.&nbsp;&#12467;&#12510;&#12531;&#12489; &#12503;&#12525;&#12531;&#12503;&#12488;&#12434;&#31649;&#29702;&#32773;&#27177;&#38480;&#12391;&#36215;&#21205;&#12375;&#12414;&#12377;&#12290;<br>2.&nbsp;cd &#12467;&#12510;&#12531;&#12489;&#12391;&#12289;Exchange &#12469;&#12540;&#12496;&#12540;&#12398;&#12452;&#12531;&#12473;&#12488;&#12540;&#12521;&#12540;&#12364;&#20445;&#23384;&#12373;&#12428;&#12390;&#12356;&#12427;&#12501;&#12457;&#12523;&#12480;&#12540;&#12408;&#31227;&#21205;&#12375;&#12414;&#12377;&#12290;<br>3.&nbsp;&#27425;&#12398;&#12467;&#12510;&#12531;&#12489;&#12434;&#23455;&#34892;&#12375;&#12414;&#12377;&#12290;<br>Setup.exe /PrepareAD /IAcceptExchangeServerLicenseTerms</p><p><br>&#20170;&#24460;&#12418;&#24403;&#12502;&#12525;&#12464;&#12362;&#12424;&#12403;&#12469;&#12509;&#12540;&#12488; &#12481;&#12540;&#12512;&#12434;&#12424;&#12429;&#12375;&#12367;&#12362;&#39000;&#12356;&#12356;&#12383;&#12375;&#12414;&#12377;&#12290;</p></p></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;br&gt;&amp;#12371;&amp;#12435;&amp;#12395;&amp;#12385;&amp;#12399;&amp;#12290;Exchange &amp;#12469;&amp;#12509;&amp;#12540;&amp;#12488; &amp;#12481;&amp;#12540;&amp;#12512;&amp;#12398;&amp;#23567;&amp;#3
      
    
    </summary>
    
    
    
      <category term="Exchange" scheme="https://jpmessaging.github.io/blog/tags/Exchange/"/>
    
  </entry>
  
</feed>
